(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2748,8033],{33196:function(){},88608:function(t,e,n){"use strict";n.d(e,{IpfsPrefixProvider:function(){return u},y:function(){return c}});var r=n(27573),a=n(7653),o=n(68571);let i=(0,a.createContext)({ipfsPrefix:"https://ipfs.io/ipfs/",findIpfsPrefix:()=>{}}),c=()=>(0,a.useContext)(i),s=o.env.NEXT_PUBLIC_IPFS_PROVIDER||"https://pump.mypinata.cloud/ipfs/",u=t=>{let{children:e}=t,[n,o]=(0,a.useState)(s),c=async()=>{let t="QmXeG5tTjC63hjTF7a4GcUyetE6yPcsR4rBzX7wb8mmpzg",e=["https://pump.mypinata.cloud/ipfs/","https://ipfs.io/ipfs/","https://gateway.pinata.cloud/ipfs/"];await fetch("".concat(s).concat(t)).then(t=>t.json()).then(t=>{o(s)}).catch(n=>{console.error(n),e.forEach(async e=>{let n=await fetch("".concat(e).concat(t)).then(t=>t.json());(null==n?void 0:n.name)&&o(t=>t!==s?t:e)})})};return(0,a.useEffect)(()=>{c()},[]),(0,r.jsx)(i.Provider,{value:{ipfsPrefix:n,findIpfsPrefix:c},children:e})}},22932:function(t,e,n){"use strict";n.d(e,{O:function(){return s},SolPriceProvider:function(){return l}});var r=n(27573),a=n(93069),o=n(7653),i=n(5068);let c=(0,o.createContext)({solPrice:0}),s=()=>(0,o.useContext)(c),u=async()=>{let t=await fetch("".concat((0,a.oW)(),"/sol-price"));return(await t.json()).solPrice},l=t=>{let{children:e}=t,{data:n=0}=(0,i.a)({queryKey:["solPrice"],queryFn:u,refetchInterval:12e4,staleTime:6e4});return(0,r.jsx)(c.Provider,{value:{solPrice:n},children:e})}},96350:function(t,e,n){"use strict";n.d(e,{z0:function(){return h},yF:function(){return y},n1:function(){return w},S0:function(){return f},Fe:function(){return d},n_:function(){return p},F:function(){return g},YT:function(){return m},RZ:function(){return v},ep:function(){return D},Og:function(){return J},rq:function(){return G},t5:function(){return X},iy:function(){return z},oi:function(){return S},LH:function(){return j}});var r=n(93069),a=n(70531),o=n(88830),i=n(1787),c=n(18119),s=n(55041);let u=t=>{let e=/Program (\w+) failed: (.+)/,n=/custom program error: (0x[0-9a-fA-F]+)/;for(let r of t){let a=r.match(e);if(a&&"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P"===a[1])switch(parseInt(a[2].match(n)[1])){case 6002:case 6003:return Error("Transaction failed due to high slippage - please increase max slippage");case 40:return Error("Raydium insufficient funds: ".concat(t[t.indexOf(r)-2]))}}return null};var l=n(87376).Buffer;let f="confirmed",d=1e8,p=35e4,m=1e5,h=2e5,y=1.05,w=1e5,g=1,v=1;function b(t,e,n){return new s.VersionedTransaction(new s.TransactionMessage({payerKey:t,instructions:e,recentBlockhash:n}).compileToV0Message())}async function P(t,e){if(e.some(t=>t.programId.equals(s.ComputeBudgetProgram.programId)))throw Error("ComputeBudgetInstructions present in simulatedInstructions");let n=[Q({units:14e5,frontRunningProtection:!1}),s.ComputeBudgetProgram.setComputeUnitPrice({microLamports:1})];return n.push(...e),b(t,n,"11111111111111111111111111111111")}let T=(0,a.parseIdlErrors)(i.AK);function k(t){var e;if("AccountNotFound"===t.err)return Error("Your account has 0 SOL. Please transfer some SOL to your account.");if((null===(e=t.err)||void 0===e?void 0:e.InstructionError)===void 0)return Error(JSON.stringify(t.err));let n=t.logs;if(!n)throw Error("Missing tx simulation logs on failure");let r=(0,a.translateError)(t,T),o=u(n);return o?o:r instanceof a.AnchorError||r instanceof a.ProgramError?r:function(t){let e=/Program (\w+) failed: (.+)/,n=/custom program error: (0x[0-9a-fA-F]+)/;for(let r of t){let a=r.match(e);if(a)switch(a[1]){case"11111111111111111111111111111111":switch(parseInt(a[2].match(n)[1])){case 0:return Error("Account already exists: ".concat(t[t.indexOf(r)-1]));case 1:return Error("Insufficient funds: ".concat(t[t.indexOf(r)-1]))}break;case"675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8":switch(parseInt(a[2].match(n)[1])){case 30:return Error("Raydium exceeded slippage: ".concat(t[t.indexOf(r)-2]));case 40:return Error("Raydium insufficient funds: ".concat(t[t.indexOf(r)-2]))}break;case"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL":if("Provided owner is not allowed"===a[2])return Error("Illegal owner: ".concat(r))}}return null}(n)||(n[n.length-1].includes("exceeded CUs meter at BPF instruction")?Error("Exhausted compute units: ".concat(n[n.length-2])):n.length>=4?Error([n[n.length-4],n[n.length-3]].join(" ")):Error(n.join(" ")))}async function C(t,e,n){var r;let a=await t.simulateTransaction(e,{sigVerify:!1,replaceRecentBlockhash:!0,commitment:f}),o=a.value;if(o.err)throw console.error("failed to simulate transaction",a),k(o);return null!==(r=o.unitsConsumed)&&void 0!==r?r:n}async function E(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"High";try{var r;let a=await fetch(t.rpcEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:"1",method:"getPriorityFeeEstimate",params:[{transaction:K(e),options:{priorityLevel:n,transactionEncoding:"base64"}}]})}).then(t=>t.json());if(a.error)throw Error(a.error.message);return Math.floor(Math.min(Math.max((null==a?void 0:null===(r=a.result)||void 0===r?void 0:r.priorityFeeEstimate)||0,1e5),d))}catch(t){console.error("failed to fetch priority fee",t)}return 1e5}async function x(t,e,n,r,a,o,i){let c=await P(e,n),[u,l]=await Promise.all([C(t,c,r),E(t,c,o)]);return[Q({units:u*a,frontRunningProtection:i}),s.ComputeBudgetProgram.setComputeUnitPrice({microLamports:l}),...n]}async function S(t){let{connection:e,blockhashWithExpiryBlockHeight:n,payer:r,wallet:a,instructions:o,defaultUnits:i,unitsScaleFactor:c,priorityLevel:s,frontRunningProtection:u,captchaToken:l,batchId:f,signBlock:d=async t=>t}=t,p=await x(e,r,o,i,c,s,u);return await z({connection:e,blockhashWithExpiryBlockHeight:n,payer:r,allInstructions:p,wallet:a,frontRunningProtection:u,captchaToken:l,batchId:f,signBlock:d})}async function j(t){let{connection:e,blockhashWithExpiryBlockHeight:n,payer:r,wallet:a,instructions:o,defaultUnits:i,unitsScaleFactor:c,priorityLevel:s,frontRunningProtection:u,tipAmount:l,captchaToken:f,batchId:d}=t,p=await A(o,i,u,l,r);return await z({connection:e,blockhashWithExpiryBlockHeight:n,payer:r,allInstructions:p,wallet:a,frontRunningProtection:u,captchaToken:f,batchId:d})}async function z(t){let{connection:e,blockhashWithExpiryBlockHeight:n,payer:r,allInstructions:a,wallet:i,frontRunningProtection:c,captchaToken:s,batchId:u,signBlock:l=async t=>t}=t,{blockhash:f,lastValidBlockHeight:d}=n,p=b(r,a,f),m=await l(p),h=await i.signTransaction(m),y=performance.now(),w=o.bs58.encode(h.signatures[0]),g=M(e,w,d);return function(t){let{connection:e,signature:n,signedTx:r,frontRunningProtection:a,captchaToken:o,lastValidBlockHeight:i,batchId:c}=t;(function(t,e,n,r){if(r){O(e,n);return}(function(t,e){let n=L(e);W.map(e=>fetch(e,n).then(t=>t.json()).then(n=>console.log("temporal send-transaction submission tx=".concat(t," endpoint=").concat(e),n)).catch(n=>console.error("failed to temporal send-transaction tx=".concat(t," endpoint=").concat(e),n)))})(e,n),O(e,n),t.sendTransaction(n,{skipPreflight:!0,maxRetries:0})})(e,n,r,a),R(n,r,a,o,c,i)}({connection:e,signature:w,signedTx:h,frontRunningProtection:c,captchaToken:s,lastValidBlockHeight:d,batchId:u}),{signature:w,confirmTxPromise:g,signedTimestamp:y}}let F=["96gYZGLnJYVFmbjzopPSU6QiEV5fGqZNyN9nmNhvrZU5","HFqU5x63VTqvQss8hp11i4wVV8bD44PvwucfZ2bU7gRe","Cw8CFyM9FkoMi7K7Crf6HNQqf4uEMzpKw6QNghXLvLkY","ADaUMid9yfUytqMBgopwjb2DTLSokTSzL1zt6iGPaS49","DfXygSm4jCyNCybVYYK6DwvWqjKee8pbDmJGcLWNDXjh","ADuUkR4vqLUMWXxW9gh6D6L8pMSawimctcNZ5pGwDcEt","DttWaMuVvTiduZRnguLF7jNxTgiMBZ1hyAumKUiL2KRL","3AVi9Tg9Uo68tJfuvoKvqKNWKkC5wPdSSdeBnizKZ6jT"].map(t=>new s.PublicKey(t)),N=["pfnP85qobXv2wETniKjXBhxKvgivpfT8EGAcS8sb3bq","pfnSAoQWtJCDKnjmR8oduqbZYXr69Q4cFQ6VhgFkvgT","pfnntQ8jDjE6aP9uPVYBsTEnzwFZuQqBx9XZ7wpzXNC","pfn2d1g6xkwhykkyjtoccFbC7r19ADf5dGB2YnT1Hgw","pfnXi2FdpFUUn6VyoxUohNyWk2Nup3ruguTgK8jaZaF","pfnKWwarhjuKKg3WV3nw3wAE8zuymigT3vuJHwZeL4s","pfngGVVQLiVRFbLWw3Ektiv17ef9NiRZbcgdAhh4ZEW","pfnSbG36fCGpT8WsB1NEbQ2BH11iog6qjFqMEVCZZgV","pfnaxrmMoemfvbhXek6offTNXas11GtepGQMN9UF3gk","pfn9b35be4L7xh7G8P2jUzWsJAigrKDSoBeRMiyg75p","pfnaZXdkjJq26auzzFKeQm7YKphuNCdDGcJVqqb6awr","pfnUxCuZcfP6yidkG3EsqyR5DTbyie3R74fGoA5oB3J","pfnTcJ1i4mRYzbqGduF71RsooUCFkPSpk8UE7drCkjh","pfnEJvqLGddJxQTA9DcYLTbVwiFdT3KmLXo6UcnmcgC","pfn6dyanKiTTinHs887D7qe2S4727wzK7xi7ERGaizC","pfnSbziLrSSVNqPBD9tpx3Ud4VtbxwsXjdfYv9SmBDx"].map(t=>new s.PublicKey(t));async function A(t,e,n,r,a){return[Q({units:e,frontRunningProtection:n}),s.ComputeBudgetProgram.setComputeUnitPrice({microLamports:Math.floor(1e12/e)}),n?s.SystemProgram.transfer({fromPubkey:a,toPubkey:F[Math.floor(Math.random()*F.length)],lamports:Math.floor(1e9*r)}):s.SystemProgram.transfer({fromPubkey:a,toPubkey:N[Math.floor(Math.random()*N.length)],lamports:1e6}),...t]}function B(t){let e=t.serialize();return o.bs58.encode(e)}function K(t){return l.from(t.serialize()).toString("base64")}async function M(t,e,n){let r=(await t.confirmTransaction({signature:e,blockhash:"",lastValidBlockHeight:n},f)).value;if(null!==r.err)throw await I(t,e);return r}async function I(t,e){let n=await t.getTransaction(e,{maxSupportedTransactionVersion:0,commitment:f});if(null===n)return Error("transaction not found");let r=n.meta;if(null===r)return Error("transaction meta not found");let{err:a,logMessages:o}=r;return k({err:a,logs:o})}let U="4ce4ba59-0216-4d12-9530-0ff85cef47c6",W=["https://ams1.secure.nozomi.temporal.xyz/?c=".concat(U),"https://ash1.secure.nozomi.temporal.xyz/?c=".concat(U),"https://ewr1.secure.nozomi.temporal.xyz/?c=".concat(U),"https://fra2.secure.nozomi.temporal.xyz/?c=".concat(U),"https://pit1.secure.nozomi.temporal.xyz/?c=".concat(U),"https://sgp1.secure.nozomi.temporal.xyz/?c=".concat(U),"https://tyo1.secure.nozomi.temporal.xyz/?c=".concat(U)];function L(t){return{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"sendTransaction",params:[K(t),{encoding:"base64"}]})}}let q=["https://mainnet.block-engine.jito.wtf/api/v1/transactions","https://amsterdam.mainnet.block-engine.jito.wtf/api/v1/transactions","https://frankfurt.mainnet.block-engine.jito.wtf/api/v1/transactions","https://london.mainnet.block-engine.jito.wtf/api/v1/transactions","https://ny.mainnet.block-engine.jito.wtf/api/v1/transactions","https://slc.mainnet.block-engine.jito.wtf/api/v1/transactions","https://singapore.mainnet.block-engine.jito.wtf/api/v1/transactions","https://tokyo.mainnet.block-engine.jito.wtf/api/v1/transactions"];function O(t,e){let n=L(e);q.map(e=>fetch(e,n).then(t=>t.json()).then(n=>console.log("jito send-transaction submission tx=".concat(t," endpoint=").concat(e),n)).catch(n=>console.error("failed to jito send-transaction tx=".concat(t," endpoint=").concat(e),n)))}async function R(t,e,n,a,o,i){let c=await fetch("".concat((0,r.oW)(),"/send-transaction"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({serializedTransaction:K(e),retries:5,frontRunningProtection:n,captchaToken:encodeURIComponent(a),batchId:o,lastValidBlockHeight:i,encoding:"base64"})}).then(t=>t.json()).catch(e=>console.error("failed to sendTxToClientServer tx=".concat(t),e));console.log("sendTxToClientServer tx=".concat(t),c)}async function G(t){let{pumpSdk:e,name:n,symbol:r,uri:a,creator:o,user:i,global:c,amount:u,solAmount:l,connection:f,wallet:d,captchaToken:p,priorityLevel:m,blockhashWithExpiryBlockHeight:h}=t,y=s.Keypair.generate(),w=!0,g=await Z();g||(g=y.publicKey,w=!1,console.log("Using a random keypair for the mint"));let v=await e.createAndBuyInstructions({global:c,mint:g,name:n,symbol:r,uri:a,creator:o,user:i,amount:u,solAmount:l}),{signature:b,confirmTxPromise:P}=await S({connection:f,blockhashWithExpiryBlockHeight:h,payer:i,wallet:d,instructions:v,defaultUnits:37e4,unitsScaleFactor:1,priorityLevel:m,frontRunningProtection:!1,captchaToken:p,signBlock:async t=>w?await _({serializedTx:B(t),mint:g.toString(),isFreeCoinCreation:!1}):(t.sign([y]),t)});return{mint:g,signature:b,confirmTxPromise:P}}let Z=async()=>{try{let t=await fetch("".concat((0,r.oW)(),"/vanity/random-mint-public-key")),e=await t.json();return new s.PublicKey(e.pubkey)}catch(t){return console.error("Failed to fetch a vanity key: ".concat(t)),null}};async function V(t){let{pumpSdk:e,coin:n,user:r,global:a,tokensToBuy:o,solRequired:i,connection:c,wallet:u,priorityLevel:l,captchaToken:f,batchId:d,blockhashWithExpiryBlockHeight:p}=t,m=await e.createAndBuyInstructions({global:a,mint:new s.PublicKey(n.mint),name:n.name,symbol:n.symbol,uri:n.raw_metadata_uri||n.metadata_uri,creator:new s.PublicKey(n.creator),user:r,amount:o,solAmount:i});return await S({connection:c,blockhashWithExpiryBlockHeight:p,payer:r,wallet:u,instructions:m,defaultUnits:37e4,unitsScaleFactor:1,priorityLevel:l,frontRunningProtection:!1,captchaToken:f,batchId:d,signBlock:async t=>await _({serializedTx:B(t),mint:n.mint,isFreeCoinCreation:!0})})}async function D(t){let{frontRunningProtection:e,user:n,tipAmount:r,pumpSdk:a,global:o,bondingCurveAccountInfo:i,bondingCurve:u,associatedUserAccountInfo:l,mint:f,tokensToBuy:d,solRequired:p,slippage:m,connection:h,wallet:y,priorityLevel:w,captchaToken:g,batchId:v,blockhashWithExpiryBlockHeight:b}=t;console.log("buy getAccountInfo(ata=".concat((0,c.MO)(new s.PublicKey(f),n,!0),", mint=").concat(f,", user=").concat(n.toBase58(),")"));let P=await a.buyInstructions({global:o,bondingCurveAccountInfo:i,bondingCurve:u,associatedUserAccountInfo:l,mint:new s.PublicKey(f),user:n,amount:d,solAmount:p,slippage:m});return await j({connection:h,blockhashWithExpiryBlockHeight:b,payer:n,wallet:y,instructions:P,defaultUnits:1e5,unitsScaleFactor:1.05,priorityLevel:w,frontRunningProtection:e,tipAmount:r,captchaToken:g,batchId:v})}async function J(t){let{bondingCurveAccountInfo:e,bondingCurve:n,pumpSdk:r,coin:a,user:o,global:i,tokensToBuy:c,solRequired:s,connection:u,wallet:l,priorityLevel:f,captchaToken:d,batchId:p,frontRunningProtection:m,tipAmount:h,slippage:y,blockhashWithExpiryBlockHeight:w,associatedUserAccountInfo:g}=t;return e&&n?await D({frontRunningProtection:m,user:o,tipAmount:h,pumpSdk:r,global:i,bondingCurveAccountInfo:e,bondingCurve:n,associatedUserAccountInfo:g,mint:a.mint,tokensToBuy:c,solRequired:s,slippage:y,connection:u,wallet:l,priorityLevel:f,captchaToken:d,batchId:p,blockhashWithExpiryBlockHeight:w}):await V({pumpSdk:r,coin:a,user:o,global:i,tokensToBuy:c,solRequired:s,connection:u,wallet:l,priorityLevel:f,captchaToken:d,batchId:p,blockhashWithExpiryBlockHeight:w})}async function X(t){let{pumpSdk:e,global:n,bondingCurveAccountInfo:r,bondingCurve:a,mint:o,user:i,wallet:c,amountToSell:s,quote:u,slippage:l,frontRunningProtection:f,tipAmount:d,connection:p,priorityLevel:m,captchaToken:h,blockhashWithExpiryBlockHeight:y}=t,w=await e.sellInstructions({global:n,bondingCurveAccountInfo:r,bondingCurve:a,mint:o,user:i,amount:s,solAmount:u,slippage:l});return await j({connection:p,payer:i,wallet:c,instructions:w,defaultUnits:1e5,unitsScaleFactor:1.05,priorityLevel:m,frontRunningProtection:f,tipAmount:d,captchaToken:h,blockhashWithExpiryBlockHeight:y})}async function _(t){let{serializedTx:e}=await fetch("".concat((0,r.oW)(),"/coins/sign-create-tx"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(t=>t.json());return s.VersionedTransaction.deserialize(o.bs58.decode(e))}function Q(t){let{frontRunningProtection:e,...n}=t,r=new s.PublicKey("jitodontfront11111111111111111111111111pump"),a=s.ComputeBudgetProgram.setComputeUnitLimit(n);return e&&a.keys.push({pubkey:r,isSigner:!1,isWritable:!1}),a}},93069:function(t,e,n){"use strict";n.d(e,{cN:function(){return o},fs:function(){return a},oW:function(){return r}});let r=()=>"https://frontend-api-v3.pump.fun",a=()=>"https://advanced-api-v2.pump.fun",o=()=>"https://swap-api.pump.fun/v1"},40416:function(t,e,n){"use strict";n.d(e,{BK:function(){return f},Py:function(){return u},WE:function(){return i},b0:function(){return l},cn:function(){return o},ek:function(){return s},w:function(){return c}});var r=n(10607),a=n(68523);function o(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return(0,a.m)((0,r.W)(e))}let i="https://pump.mypinata.cloud/ipfs/QmeSzchzEPqCU1jwTnsipwcBAeH7S4bmVvFGfF65iA1BY1",c=()=>{let t=localStorage.getItem("walletName");return t?JSON.parse(t):localStorage.getItem("privy:token")?"privy":void 0},s=()=>"SquadsX"===c(),u=(t,e)=>{let n=function(t){let e=t.match(/(Qm[a-zA-Z0-9]{44}|b[a-zA-Z0-9]{58})/);return e&&e[1]?"https://ipfs.io/ipfs/".concat(e[1]):t}(t||i);return n.includes("ipfs.io/ipfs/")?n.replace(/https:\/\/[^/]+\/ipfs\//,e):i},l=(t,e)=>{if(!(9===e?/^\d*([.,]\d{0,9})?$/:/^\d*([.,]\d{0,6})?$/).test(t))return!1;try{let n=BigInt(Math.floor(Number(t)*10**e)),r=(BigInt(1)<<BigInt(64))-BigInt(1);return n<=r}catch(t){return!1}},f={telegram:/^(https?:\/\/)(t\.me|telegram\.me)\/[a-zA-Z0-9_]+$/,website:/^https:\/\/(www\.)?[-a-zA-Z0-9@:%._~#=]{1,256}\.[a-zA-Z]{2,20}\b([-a-zA-Z0-9()@:%_.~#?&/=]*)$/,twitter:/^(https?:\/\/)?(www\.)?(twitter\.com|x\.com)\/.+/i}},22988:function(t,e,n){"use strict";n.d(e,{a:function(){return i}});var r=n(70790),a=n(93069);let o=t=>fetch(t).then(t=>t.json()),i=function(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{data:n,error:i,mutate:c,isLoading:s}=(0,r.ZP)(e&&t?"".concat((0,a.oW)(),"/users/").concat(t):null,o,{revalidateOnFocus:!1,dedupingInterval:3e5});return{user:n,error:i,fetchUser:c,isLoading:s}}},65634:function(t,e,n){"use strict";n.d(e,{a:function(){return A},U:function(){return N}});var r=n(27573),a=n(46081),o=n(33825),i=n(19543),c=n(36787),s=n(8873),u=n(52661),l=n(93069),f=n(40416),d=n(39808),p=n(40879),m=n(78186),h=n(12753),y=n(55041),w=n(92858),g=n.n(w),v=n(7653),b=n(77879),P=n(68889);async function T(t,e){if(!(0,a.dk)())return;let n={...e,env:"prod"};(0,a.u8)("setIdentity",{uid:t,properties:n}),P.Z.identify(t),P.Z.people.set(n)}var k=n(22988),C=n(87376).Buffer;let E=()=>{let t=Date.now();return{message:"Sign in to pump.fun: ".concat(t),timestamp:t}},x=async(t,e,n)=>{try{let r=new y.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),a=new y.TransactionInstruction({keys:[],programId:r,data:C.from(n,"utf8")}),o=new y.Transaction().add(a),{blockhash:i}=await t.getLatestBlockhash("finalized");return o.recentBlockhash=i,o.feePayer=new y.PublicKey(e),o}catch(t){return console.error("Error creating memo transaction:",t),null}},S="LOGIN_NOT_ALLOWED",j="LOGIN_FAILED";class z extends Error{constructor(t,e,n){super(),this.errorName=t,this.message=e,this.cause=n}}let F=(0,v.createContext)({}),N=()=>(0,v.useContext)(F),A=t=>{let{children:e}=t,[n,w]=(0,v.useState)(!1),[P,C]=(0,v.useState)(!1),[N,A]=(0,v.useState)(!1),{connection:B}=(0,d.R)(),{signMessage:K,publicKey:M,disconnect:I,signTransaction:U}=(0,p.O)(),W=(0,m.z)(),{logout:L,authenticated:q,ready:O}=(0,i.s)(),{createWallet:R,wallets:G,ready:Z}=(0,c.p)(),{login:V}=(0,s.f)({onComplete:async t=>{let{user:e}=t;C(!1);let n=e.linkedAccounts.find(t=>"wallet"===t.type&&"privy"===t.walletClientType&&"solana"===t.chainType);if(n)try{await tc(n.address)}catch(t){if(t instanceof z&&t.errorName===S)throw await to(),C(!0),t;throw new z(j,"Failed to login",t)}n||await R()}}),[D,J]=(0,h._)("decoded-jwt",null),[,X]=(0,b._)("last-sort-update",0),_=(0,v.useMemo)(()=>G.find(t=>"privy"===t.walletClientType),[G]),Q=(0,v.useMemo)(()=>{if(!(O&&Z)){console.log("ProfileProvider Privy not ready");return}return q?null==_?void 0:_.address:null==D?void 0:D.address},[O,Z,q,null==_?void 0:_.address,null==D?void 0:D.address]),Y=(0,v.useMemo)(()=>!q&&!!(M&&!D),[D,q,M]),{user:H,fetchUser:$}=(0,k.a)(Q),[tt,te]=(0,v.useState)(!1),tn=async(t,e)=>{let n=[];for(let r of e)n.push(await t.signTransaction(r));return n},tr=(0,v.useMemo)(()=>_?{publicKey:new y.PublicKey(_.address),signAllTransactions:async t=>await tn(_,t),..._}:void 0,[_]),ta=(0,v.useMemo)(()=>q?tr:W,[W,tr,q]),to=(0,v.useCallback)(async()=>{q&&await L(),await I(),await fetch("".concat((0,l.oW)(),"/auth/logout"),{method:"POST",credentials:"include"}).then(t=>t.json()),u.kg.clearUserAddress(),J(null),X(0)},[I,L,q]),ti=(0,v.useCallback)(async()=>{try{let t=await fetch("".concat((0,l.oW)(),"/auth/my-profile"),{method:"GET",credentials:"include",headers:{"Cache-Control":"no-cache"}});if(304===t.status&&console.log("ProfileProvider: Received 304 from server ok = ",t.ok),!t.ok&&304!==t.status){X(0),J(null);return}let e=await t.json();JSON.stringify(D)!==JSON.stringify(e)&&J(e)}catch(t){console.error(t),X(0),J(null)}},[D]),tc=(0,v.useCallback)(async t=>{if(405===(await fetch("".concat((0,l.oW)(),"/check/").concat(t),{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then(t=>t.json()).catch(()=>({statusCode:405}))).statusCode)throw new z(S,"Wallet connection unsuccessful")},[]),ts=(0,v.useCallback)(async(t,e,n,r)=>{let a={address:t,signature:e,timestamp:n};r&&(a.transaction=r);let o=await fetch("".concat((0,l.oW)(),"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)});if(!o.ok&&405==o.status)throw q&&(C(!0),await L()),await I(),new z(S,"Wallet connection unsuccessful")},[q,C,L,I]),tu=(0,v.useCallback)(async(t,e)=>{if(!e||!t)throw Error("Wallet not connected");let{message:n,timestamp:r}=E(),a=await e(new TextEncoder().encode(n)),o=g().encode(a);await ts(t,o,r)},[ts]),tl=(0,v.useCallback)(async t=>{if(t&&U)try{let{message:e,timestamp:n}=E(),r=await x(B,t,e);if(!r)throw Error("Failed to create transaction");let a=await U(r),o=Array.from(a.serialize());if(!a.signature)throw Error("Transaction signature is missing");let i=g().encode(a.signature);await ts(t,i,n,o)}catch(t){console.error("error signing for squads",t)}},[U,B,ts]),tf=(0,v.useCallback)(async()=>{w(!0);try{(0,f.ek)()?await tl(null==M?void 0:M.toBase58()):await tu(null==M?void 0:M.toBase58(),K),await ti()}catch(t){if(t instanceof z)throw t;throw new z(j,"Failed to login",t)}finally{w(!1)}},[M,ti,tu,tl,K]);(0,v.useEffect)(()=>{(async()=>{if(P)console.error("Privy Wallet got disconnected - not signing in");else{let t=G.find(t=>"privy"===t.walletClientType);t&&(!D||D.address!==t.address)&&(await tu(t.address,t.signMessage),await ti())}})()},[G,P,D,tu,ti]);let td=(0,v.useRef)(!1);return(0,v.useEffect)(()=>{!td.current&&Q&&(async()=>{try{await ti(),td.current=!0}catch(t){console.error("Error refreshing JWT:",t)}})()},[Q]),(0,v.useEffect)(()=>{let t=()=>{let t=(0,a.dk)();return t&&te(!0),t};t();let e=setInterval(()=>{t()&&clearInterval(e)},2e3);return()=>clearInterval(e)},[]),(0,v.useEffect)(()=>{Q&&((0,o.sendGTMEvent)({user_id:Q}),u.kg.setUserAddress(Q),tt&&T(Q))},[Q,tt]),(0,v.useEffect)(()=>{if(D){if(1e3*D.exp<Date.now()){X(0),J(null);return}fetch("".concat((0,l.oW)(),"/users/register"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({address:D.address})})}},[D]),(0,r.jsx)(F.Provider,{value:{decodedJwt:D,login:tf,privyLogin:V,privyLoginFailed:P,loginLoading:n,XAccountConnected:N,setXAccountConnected:A,address:Q,user:H,roles:null==D?void 0:D.roles,fetchUser:$,logout:to,requiresLogin:Y,wallet:ta,shouldUsePrivy:q},children:e})}}}]);