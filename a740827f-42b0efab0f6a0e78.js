"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2475],{52661:function(e,t,r){let s,n,i;r.d(t,{Tu:function(){return ob},_h:function(){return oy},ii:function(){return cw},jf:function(){return cj},jt:function(){return lu},kg:function(){return e8},pm:function(){return ls},r8:function(){return lo},tZ:function(){return rT},vP:function(){return l9}});var a,o,l,c,d,u,m,p,h,g,f,x,v,b,y,w,j,k=r(50410),N=r(77930),C=r(7653),S=r(27573),I=r(5068),E=r(88172),M=r(60284),T=r(52529),_=r(68321),L=r(48688),A=r(90095),P=r(15969),R=r(25189),D=r(45254),F=r.n(D);r(73482);var U=r(43489),B=r(81685),O=r(93221),$=r(42915),V=r(15671),q=r(37331),H=r(64645),Q=r(44687),z=r(26795),G=r(88001),Z=r(83551),W=r(85281),K=r(50604),J=r(95730),Y=r(29660),X=r(95313),ee=r(21303),et=r(72069),er=r(67221),es=r(80001),en=r(61563),ei=r(94300),ea=r(76736),eo=r.n(ea),el=r(82499),ec=r(13495),ed=r(1226),eu=r(41963),em=r(33287),ep=r(73809),eh=r(28757),eg=r(15632),ef=r(83853),ex=r(63995),ev=r(21761),eb=r(97048),ey=r(64452),ew=r(64357),ej=r(74913),ek=r(53810),eN=r(76516),eC=r(11329),eS=r(39092),eI=r(72768),eE=r(38774),eM=r(62949),eT=r(62546),e_=r(41864),eL=r(92287),eA=r(18962),eP=r(41632),eR=r(14020),eD=r(38741),eF=r(2766),eU=r(73235),eB=r(73876),eO=r(2380),e$=r(69757),eV=r(6937),eq=r(28803),eH=r(7411),eQ=r(84232),ez=r(40244),eG=r(45530),eZ=r(68571),eW=r(87376).Buffer,eK=Object.create,eJ=Object.defineProperty,eY=Object.getOwnPropertyDescriptor,eX=Object.getOwnPropertyNames,e0=Object.getPrototypeOf,e1=Object.prototype.hasOwnProperty,e2=(s={"node_modules/loglevel/lib/loglevel.js"(e,t){var s;s=function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),s=["trace","debug","info","warn","error"],n={},i=null;function a(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(){for(var r=this.getLevel(),n=0;n<s.length;n++){var i=s[n];this[i]=n<r?e:this.methodFactory(i,r,this.name)}if(this.log=this.debug,typeof console===t&&r<this.levels.SILENT)return"No console available for logging"}function c(e){return function(){typeof console!==t&&(l.call(this),this[e].apply(this,arguments))}}function d(s,n,i){var l;return"debug"===(l=s)&&(l="log"),typeof console!==t&&("trace"===l&&r?o:void 0!==console[l]?a(console,l):void 0!==console.log?a(console,"log"):e)||c.apply(this,arguments)}function u(e,r){var a,o,c,u=this,m="loglevel";function p(){var e;if(typeof window!==t&&m){try{e=window.localStorage[m]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,s=encodeURIComponent(m),n=r.indexOf(s+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n+s.length+1))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}function h(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?m+=":"+e:"symbol"==typeof e&&(m=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=r||d,u.getLevel=function(){return null!=c?c:null!=o?o:a},u.setLevel=function(e,r){return c=h(e),!1!==r&&function(e){var r=(s[e]||"silent").toUpperCase();if(typeof window!==t&&m){try{window.localStorage[m]=r;return}catch(e){}try{window.document.cookie=encodeURIComponent(m)+"="+r+";"}catch(e){}}}(c),l.call(u)},u.setDefaultLevel=function(e){o=h(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){c=null,function(){if(typeof window!==t&&m){try{window.localStorage.removeItem(m)}catch(e){}try{window.document.cookie=encodeURIComponent(m)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),l.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(i!==u&&(a=h(i.getLevel())),l.call(u),i===u)for(var e in n)n[e].rebuild()},a=h(i?i.getLevel():"WARN");var g=p();null!=g&&(c=h(g)),l.call(u)}(i=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw TypeError("You must supply a name when creating a logger.");var t=n[e];return t||(t=n[e]=new u(e,i.methodFactory)),t};var m=typeof window!==t?window.log:void 0;return i.noConflict=function(){return typeof window!==t&&window.log===i&&(window.log=m),i},i.getLoggers=function(){return n},i.default=i,i},"function"==typeof define&&r.amdO?define(s):"object"==typeof t&&t.exports?t.exports=s():e.log=s()}},function(){return n||(0,s[eX(s)[0]])((n={exports:{}}).exports,n),n.exports}),e4=(0,C.createContext)({onTrackEvent:()=>{}}),e3=()=>(0,C.useContext)(e4),e5=({children:e,onTrackEvent:t})=>{let r=(0,C.useMemo)(()=>({onTrackEvent:t||(()=>{})}),[t]);return(0,S.jsx)(e4.Provider,{value:r,children:e})},e6="undefined"!=typeof window&&void 0!==window.document,e8=new class{constructor(){this.consoleLoggingEnabled=!1,this.sourcePackage="livestream-components"}setUserAddress(e){this.userAddress=e}clearUserAddress(){this.userAddress=void 0}init(e){e.forwardConsoleLogs?.length&&(this.consoleLoggingEnabled=!1),e6&&(E.fy.init(e),(0,M.qt)((e,t,r)=>{let s=this.getEnrichedContext({...r,livekitLogLevel:M.in[e]});switch(e){case M.in.debug:E.fy.logger.debug(t,s);break;case M.in.info:E.fy.logger.info(t,s);break;case M.in.warn:E.fy.logger.warn(t,s);break;case M.in.error:E.fy.logger.error(t,s)}}))}getEnrichedContext(e){return{...e,source:this.sourcePackage,...this.userAddress?{userAddress:this.userAddress}:{}}}getConsoleArgs(e,t,r){let s=[`[${e.toUpperCase()}] ${t}`];return r&&Object.keys(r).length>0&&s.push(r),s}log(e,t,r){let s=this.getEnrichedContext(r);if(this.consoleLoggingEnabled){let s=this.getConsoleArgs(e,t,r);console.log(s[0],...s.slice(1))}let n="*"===e?s:{...s,logGroup:e};e6&&E.fy.logger.info(t,n)}info(e,t){let r=this.getEnrichedContext(t);if(this.consoleLoggingEnabled){let r=this.getConsoleArgs("info",e,t);console.info(r[0],...r.slice(1))}e6&&E.fy.logger.info(e,r)}warn(e,t){let r=this.getEnrichedContext(t);if(this.consoleLoggingEnabled){let r=this.getConsoleArgs("warn",e,t);console.warn(r[0],...r.slice(1))}e6&&E.fy.logger.warn(e,r)}error(e,t){let r=this.getEnrichedContext(t);if(this.consoleLoggingEnabled){let r=this.getConsoleArgs("error",e,t);console.error(r[0],...r.slice(1))}e6&&E.fy.logger.error(e,r)}debug(e,t){let r=this.getEnrichedContext(t);if(this.consoleLoggingEnabled){let r=this.getConsoleArgs("debug",e,t);console.debug(r[0],...r.slice(1))}e6&&E.fy.logger.debug(e,r)}},e7=()=>{let{onTrackEvent:e}=e3();return{trackEvent:(0,C.useCallback)((t,r)=>{try{return e(t,r),!0}catch(e){return e8.error("[Analytics Error] Error in onTrackEvent callback",{eventName:t,properties:r,error:e}),!1}},[e])}},e9={local:{mainFrontendUrl:"http://localhost:3000",apiUrl:"http://localhost:8008",livekitUrl:"wss://pump-local-qgdi2cvi.livekit.cloud",livechatUrl:"wss://livechat-devnet.pump.fun",clientServerUrl:"http://localhost:8081",featureFlags:{RTMP_CREDENTIALS_ENABLED:!0,REACTIONS_ENABLED:!0,CLIPS_ENABLED:!0,EDIT_CLIPS_ENABLED:!0}},prod:{mainFrontendUrl:"https://pump.fun",apiUrl:"https://livestream-api.pump.fun",livekitUrl:"wss://pump-prod-tg2x8veh.livekit.cloud",livechatUrl:"wss://livechat.pump.fun",clientServerUrl:"https://frontend-api-v3.pump.fun",featureFlags:{RTMP_CREDENTIALS_ENABLED:!0,REACTIONS_ENABLED:!1,CLIPS_ENABLED:!0,EDIT_CLIPS_ENABLED:!0}}},te=e9.prod||e9.local,tt=te.featureFlags,tr=te.livechatUrl.replace(/^wss?:/,"https://");f=te.apiUrl,x=te.clientServerUrl;var ts=T.ZP.create({prefixUrl:f,credentials:"include"}),tn=T.ZP.create({prefixUrl:x,credentials:"include"}),ti=T.ZP.create({prefixUrl:tr,credentials:"include"}),ta="get-coin",to=({mintId:e,enabled:t,onSuccess:r,initialData:s})=>{let{trackEvent:n}=e7();return(0,I.a)({queryKey:[ta,e],queryFn:async()=>{n("common_fetch_coin_data_attempt");try{let t=await tn.get(`coins/${e}`).json();return e8.debug("[useGetCoin] Fetch coin data successful",{mintId:e,coinName:t?.name,hasData:!!t}),r?.(t),n("common_fetch_coin_data_success",{single:!0,mints:[e],count:t?1:0}),t}catch(r){let t=r instanceof Error?r.message:String(r);throw e8.error("[useGetCoin] Fetch coin data failed",{mintId:e,error:t}),n("common_fetch_coin_data_failure",{error:t,mints:[e]}),r}},enabled:t,refetchInterval:25e3,refetchIntervalInBackground:!0,initialData:s})},tl=(e,t)=>{let r={style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0,...t,minimumFractionDigits:0,maximumFractionDigits:0};try{return new Intl.NumberFormat("en-US",r).format(e)}catch(t){return e?.toString()??"0"}},tc=({mintId:e,enabled:t,initialCoinData:r,onSuccess:s})=>{let n=to({mintId:e,enabled:t&&!!e&&!r,initialData:r,onSuccess:s});return{coinInfo:(0,C.useMemo)(()=>{let t=n.data??r;if(e8.debug("[useLivestreamCoinInfo] Recalculating coinInfo",{mintId:e,hasCoinQueryData:!!n.data,hasInitialData:!!r,sourceDataExists:!!t}),t)return{coinName:t.name||"",coinSymbol:t.symbol||"",marketCap:tl(t.usd_market_cap||0),usdMarketCap:t.usd_market_cap,creatorAddress:t.creator,creatorUsername:t.username,creatorAvatar:t.profile_image,isKingOfTheHill:!!t.king_of_the_hill_timestamp}},[n.data,r,e]),coinQuery:n}},td="get-livestream",tu=({mintId:e,enabled:t,onSuccess:r})=>{let{trackEvent:s}=e7();return(0,I.a)({queryKey:[td,e],queryFn:async()=>{s("livestream_fetch_attempt",{mintId:e}),e8.debug("[useGetLivestream] Attempting to fetch livestream data",{mintId:e});let t=new URLSearchParams;t.set("mintId",e);try{let n=await ts.get(`livestream?${t.toString()}`).json();return r?.(n),s("livestream_fetch_success",{mintId:e}),n}catch(r){let t=r instanceof Error?r.message:String(r);throw e8.error("[useGetLivestream] Fetch failed",{mintId:e,error:t}),s("livestream_fetch_failure",{error:t,mintId:e}),r}},enabled:t})};function tm(e,t){if(!e)throw Error(t)}function tp(e){if("number"!=typeof e)throw Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw Error("invalid int 32: "+e)}function th(e){if("number"!=typeof e)throw Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw Error("invalid uint 32: "+e)}function tg(e){if("number"!=typeof e)throw Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw Error("invalid float 32: "+e)}var tf=Symbol("@bufbuild/protobuf/enum-type");function tx(e,t,r,s){e[tf]=tv(t,r.map(t=>({no:t.no,name:t.name,localName:e[t.no]})),s)}function tv(e,t,r){let s=Object.create(null),n=Object.create(null),i=[];for(let e of t){let t=tb(e);i.push(t),s[e.name]=t,n[e.no]=t}return{typeName:e,values:i,findName:e=>s[e],findNumber:e=>n[e]}}function tb(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}var ty=class{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){let r=this.getType().runtime.bin,s=r.makeReadOptions(t);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,t){let r=this.getType(),s=r.runtime.json,n=s.makeReadOptions(t);return s.readMessage(r,e,n,this),this}fromJsonString(e,t){let r;try{r=JSON.parse(e)}catch(e){throw Error(`cannot decode ${this.getType().typeName} from JSON: ${e instanceof Error?e.message:String(e)}`)}return this.fromJson(r,t)}toBinary(e){let t=this.getType().runtime.bin,r=t.makeWriteOptions(e),s=r.writerFactory();return t.writeMessage(this,s,r),s.finish()}toJson(e){let t=this.getType().runtime.json,r=t.makeWriteOptions(e);return t.writeMessage(this,r)}toJsonString(e){var t;return JSON.stringify(this.toJson(e),null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}};function tw(){let e=0,t=0;for(let r=0;r<28;r+=7){let s=this.buf[this.pos++];if(e|=(127&s)<<r,(128&s)==0)return this.assertBounds(),[e,t]}let r=this.buf[this.pos++];if(e|=(15&r)<<28,t=(112&r)>>4,(128&r)==0)return this.assertBounds(),[e,t];for(let r=3;r<=31;r+=7){let s=this.buf[this.pos++];if(t|=(127&s)<<r,(128&s)==0)return this.assertBounds(),[e,t]}throw Error("invalid varint")}function tj(e,t,r){for(let s=0;s<28;s+=7){let n=e>>>s,i=!(n>>>7==0&&0==t),a=(i?128|n:n)&255;if(r.push(a),!i)return}let s=e>>>28&15|(7&t)<<4,n=t>>3!=0;if(r.push((n?128|s:s)&255),n){for(let e=3;e<31;e+=7){let s=t>>>e,n=s>>>7!=0,i=(n?128|s:s)&255;if(r.push(i),!n)return}r.push(t>>>31&1)}}function tk(e){let t="-"===e[0];t&&(e=e.slice(1));let r=0,s=0;function n(t,n){let i=Number(e.slice(t,n));s*=1e6,(r=1e6*r+i)>=4294967296&&(s+=r/4294967296|0,r%=4294967296)}return n(-24,-18),n(-18,-12),n(-12,-6),n(-6),t?tS(r,s):tC(r,s)}function tN(e,t){if({lo:e,hi:t}={lo:e>>>0,hi:t>>>0},t<=2097151)return String(4294967296*t+e);let r=16777215&e,s=(e>>>24|t<<8)&16777215,n=t>>16&65535,i=r+6777216*s+6710656*n,a=s+8147497*n,o=2*n;return i>=1e7&&(a+=Math.floor(i/1e7),i%=1e7),a>=1e7&&(o+=Math.floor(a/1e7),a%=1e7),o.toString()+tI(a)+tI(i)}function tC(e,t){return{lo:0|e,hi:0|t}}function tS(e,t){return t=~t,e?e=~e+1:t+=1,tC(e,t)}var tI=e=>{let t=String(e);return"0000000".slice(t.length)+t};function tE(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let r=0;r<9;r++)t.push(127&e|128),e>>=7;t.push(1)}}function tM(){let e=this.buf[this.pos++],t=127&e;if((128&e)==0||(t|=(127&(e=this.buf[this.pos++]))<<7,(128&e)==0)||(t|=(127&(e=this.buf[this.pos++]))<<14,(128&e)==0)||(t|=(127&(e=this.buf[this.pos++]))<<21,(128&e)==0))return this.assertBounds(),t;t|=(15&(e=this.buf[this.pos++]))<<28;for(let t=5;(128&e)!=0&&t<10;t++)e=this.buf[this.pos++];if((128&e)!=0)throw Error("invalid varint");return this.assertBounds(),t>>>0}var tT=function(){let e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof eZ||"object"!=typeof eZ.env||"1"!==eZ.env.BUF_BIGINT_DISABLE)){let t=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),s=BigInt("0"),n=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){let s="bigint"==typeof e?e:BigInt(e);if(s>r||s<t)throw Error(`int64 invalid: ${e}`);return s},uParse(e){let t="bigint"==typeof e?e:BigInt(e);if(t>n||t<s)throw Error(`uint64 invalid: ${e}`);return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,r)=>(e.setInt32(0,t,!0),e.setInt32(4,r,!0),e.getBigInt64(0,!0)),uDec:(t,r)=>(e.setInt32(0,t,!0),e.setInt32(4,r,!0),e.getBigUint64(0,!0))}}let t=e=>tm(/^-?[0-9]+$/.test(e),`int64 invalid: ${e}`),r=e=>tm(/^[0-9]+$/.test(e),`uint64 invalid: ${e}`);return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),r(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),tk(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),r(e),tk(e)),dec:(e,t)=>(function(e,t){let r=tC(e,t),s=2147483648&r.hi;s&&(r=tS(r.lo,r.hi));let n=tN(r.lo,r.hi);return s?"-"+n:n})(e,t),uDec:(e,t)=>tN(e,t)}}();function t_(e,t,r){if(t===r)return!0;if(e==v.BYTES){if(!(t instanceof Uint8Array)||!(r instanceof Uint8Array)||t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==r[e])return!1;return!0}switch(e){case v.UINT64:case v.FIXED64:case v.INT64:case v.SFIXED64:case v.SINT64:return t==r}return!1}function tL(e,t){switch(e){case v.BOOL:return!1;case v.UINT64:case v.FIXED64:case v.INT64:case v.SFIXED64:case v.SINT64:return 0==t?tT.zero:"0";case v.DOUBLE:case v.FLOAT:return 0;case v.BYTES:return new Uint8Array(0);case v.STRING:return"";default:return 0}}function tA(e,t){switch(e){case v.BOOL:return!1===t;case v.STRING:return""===t;case v.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}(a=v||(v={}))[a.DOUBLE=1]="DOUBLE",a[a.FLOAT=2]="FLOAT",a[a.INT64=3]="INT64",a[a.UINT64=4]="UINT64",a[a.INT32=5]="INT32",a[a.FIXED64=6]="FIXED64",a[a.FIXED32=7]="FIXED32",a[a.BOOL=8]="BOOL",a[a.STRING=9]="STRING",a[a.BYTES=12]="BYTES",a[a.UINT32=13]="UINT32",a[a.SFIXED32=15]="SFIXED32",a[a.SFIXED64=16]="SFIXED64",a[a.SINT32=17]="SINT32",a[a.SINT64=18]="SINT64",(o=b||(b={}))[o.BIGINT=0]="BIGINT",o[o.STRING=1]="STRING",(l=y||(y={}))[l.Varint=0]="Varint",l[l.Bit64=1]="Bit64",l[l.LengthDelimited=2]="LengthDelimited",l[l.StartGroup=3]="StartGroup",l[l.EndGroup=4]="EndGroup",l[l.Bit32=5]="Bit32";var tP=class{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),r=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],r),r+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(th(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return tp(e),tE(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){tg(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){th(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){tp(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return tp(e),tE(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=tT.enc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=tT.uEnc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=tT.enc(e);return tj(t.lo,t.hi,this.buf),this}sint64(e){let t=tT.enc(e),r=t.hi>>31;return tj(t.lo<<1^r,(t.hi<<1|t.lo>>>31)^r,this.buf),this}uint64(e){let t=tT.uEnc(e);return tj(t.lo,t.hi,this.buf),this}},tR=class{constructor(e,t){this.varint64=tw,this.uint32=tM,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,r=7&e;if(t<=0||r<0||r>5)throw Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e,t){let r=this.pos;switch(e){case y.Varint:for(;128&this.buf[this.pos++];);break;case y.Bit64:this.pos+=4;case y.Bit32:this.pos+=4;break;case y.LengthDelimited:let s=this.uint32();this.pos+=s;break;case y.StartGroup:for(;;){let[e,r]=this.tag();if(r===y.EndGroup){if(void 0!==t&&e!==t)throw Error("invalid end group tag");break}this.skip(r,e)}break;default:throw Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return tT.dec(...this.varint64())}uint64(){return tT.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(1&e);return e=(e>>>1|(1&t)<<31)^r,t=t>>>1^r,tT.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return tT.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return tT.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}};function tD(e){let t=e.field.localName,r=Object.create(null);return r[t]=function(e){let t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return tL(t.T,t.L);case"message":let r=t.T,s=new r;return r.fieldWrapper?r.fieldWrapper.unwrapField(s):s;case"map":throw"map fields are not allowed to be extensions"}}(e),[r,()=>r[t]]}var tF="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),tU=[];for(let e=0;e<tF.length;e++)tU[tF[e].charCodeAt(0)]=e;tU["-".charCodeAt(0)]=tF.indexOf("+"),tU["_".charCodeAt(0)]=tF.indexOf("/");var tB={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let r=new Uint8Array(t),s=0,n=0,i,a=0;for(let t=0;t<e.length;t++){if(void 0===(i=tU[e.charCodeAt(t)]))switch(e[t]){case"=":n=0;case"\n":case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(n){case 0:a=i,n=1;break;case 1:r[s++]=a<<2|(48&i)>>4,a=i,n=2;break;case 2:r[s++]=(15&a)<<4|(60&i)>>2,a=i,n=3;break;case 3:r[s++]=(3&a)<<6|i,n=0}}if(1==n)throw Error("invalid base64 string.");return r.subarray(0,s)},enc(e){let t="",r=0,s,n=0;for(let i=0;i<e.length;i++)switch(s=e[i],r){case 0:t+=tF[s>>2],n=(3&s)<<4,r=1;break;case 1:t+=tF[n|s>>4],n=(15&s)<<2,r=2;break;case 2:t+=tF[n|s>>6]+tF[63&s],r=0}return r&&(t+=tF[n]+"=",1==r&&(t+="=")),t}};function tO(e,t){let r=e.getType();return t.extendee.typeName===r.typeName&&!!r.runtime.bin.listUnknownFields(e).find(e=>e.no==t.field.no)}function t$(e,t){tm(e.extendee.typeName==t.getType().typeName,`extension ${e.typeName} can only be applied to message ${e.extendee.typeName}`)}function tV(e,t){let r=e.localName;if(e.repeated)return t[r].length>0;if(e.oneof)return t[e.oneof.localName].case===r;switch(e.kind){case"enum":case"scalar":if(e.opt||e.req)return void 0!==t[r];if("enum"==e.kind)return t[r]!==e.T.values[0].no;return!tA(e.T,t[r]);case"message":return void 0!==t[r];case"map":return Object.keys(t[r]).length>0}}function tq(e,t){let r=e.localName,s=!e.opt&&!e.req;if(e.repeated)t[r]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[r]={};break;case"enum":t[r]=s?e.T.values[0].no:void 0;break;case"scalar":t[r]=s?tL(e.T,e.L):void 0;break;case"message":t[r]=void 0}}function tH(e,t){if(null===e||"object"!=typeof e||!Object.getOwnPropertyNames(ty.prototype).every(t=>t in e&&"function"==typeof e[t]))return!1;let r=e.getType();return null!==r&&"function"==typeof r&&"typeName"in r&&"string"==typeof r.typeName&&(void 0===t||r.typeName==t.typeName)}function tQ(e,t){return tH(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}v.DOUBLE,v.FLOAT,v.INT64,v.UINT64,v.INT32,v.UINT32,v.BOOL,v.STRING,v.BYTES;var tz={ignoreUnknownFields:!1},tG={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},tZ=Symbol(),tW=Symbol();function tK(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":`"${e.split('"').join('\\"')}"`;default:return String(e)}}function tJ(e,t,r,s,n){let i=r.localName;if(r.repeated){if(tm("map"!=r.kind),null===t)return;if(!Array.isArray(t))throw Error(`cannot decode field ${n.typeName}.${r.name} from JSON: ${tK(t)}`);let a=e[i];for(let e of t){if(null===e)throw Error(`cannot decode field ${n.typeName}.${r.name} from JSON: ${tK(e)}`);switch(r.kind){case"message":a.push(r.T.fromJson(e,s));break;case"enum":let t=tX(r.T,e,s.ignoreUnknownFields,!0);t!==tW&&a.push(t);break;case"scalar":try{a.push(tY(r.T,e,r.L,!0))}catch(s){let t=`cannot decode field ${n.typeName}.${r.name} from JSON: ${tK(e)}`;throw s instanceof Error&&s.message.length>0&&(t+=`: ${s.message}`),Error(t)}}}}else if("map"==r.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw Error(`cannot decode field ${n.typeName}.${r.name} from JSON: ${tK(t)}`);let a=e[i];for(let[e,i]of Object.entries(t)){let o;if(null===i)throw Error(`cannot decode field ${n.typeName}.${r.name} from JSON: map value null`);try{o=function(e,t){if(e===v.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return tY(e,t,b.BIGINT,!0).toString()}(r.K,e)}catch(s){let e=`cannot decode map key for field ${n.typeName}.${r.name} from JSON: ${tK(t)}`;throw s instanceof Error&&s.message.length>0&&(e+=`: ${s.message}`),Error(e)}switch(r.V.kind){case"message":a[o]=r.V.T.fromJson(i,s);break;case"enum":let l=tX(r.V.T,i,s.ignoreUnknownFields,!0);l!==tW&&(a[o]=l);break;case"scalar":try{a[o]=tY(r.V.T,i,b.BIGINT,!0)}catch(s){let e=`cannot decode map value for field ${n.typeName}.${r.name} from JSON: ${tK(t)}`;throw s instanceof Error&&s.message.length>0&&(e+=`: ${s.message}`),Error(e)}}}}else switch(r.oneof&&(e=e[r.oneof.localName]={case:i},i="value"),r.kind){case"message":let a=r.T;if(null===t&&"google.protobuf.Value"!=a.typeName)return;let o=e[i];tH(o)?o.fromJson(t,s):(e[i]=o=a.fromJson(t,s),a.fieldWrapper&&!r.oneof&&(e[i]=a.fieldWrapper.unwrapField(o)));break;case"enum":let l=tX(r.T,t,s.ignoreUnknownFields,!1);switch(l){case tZ:tq(r,e);break;case tW:break;default:e[i]=l}break;case"scalar":try{let s=tY(r.T,t,r.L,!1);s===tZ?tq(r,e):e[i]=s}catch(s){let e=`cannot decode field ${n.typeName}.${r.name} from JSON: ${tK(t)}`;throw s instanceof Error&&s.message.length>0&&(e+=`: ${s.message}`),Error(e)}}}function tY(e,t,r,s){if(null===t)return s?tL(e,r):tZ;switch(e){case v.DOUBLE:case v.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t||"string"==typeof t&&t.trim().length!==t.length||"string"!=typeof t&&"number"!=typeof t)break;let n=Number(t);if(Number.isNaN(n)||!Number.isFinite(n))break;return e==v.FLOAT&&tg(n),n;case v.INT32:case v.FIXED32:case v.SFIXED32:case v.SINT32:case v.UINT32:let i;if("number"==typeof t?i=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(i=Number(t)),void 0===i)break;return e==v.UINT32||e==v.FIXED32?th(i):tp(i),i;case v.INT64:case v.SFIXED64:case v.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;let a=tT.parse(t);return r?a.toString():a;case v.FIXED64:case v.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;let o=tT.uParse(t);return r?o.toString():o;case v.BOOL:if("boolean"!=typeof t)break;return t;case v.STRING:if("string"!=typeof t)break;try{encodeURIComponent(t)}catch(e){throw Error("invalid UTF8")}return t;case v.BYTES:if(""===t)return new Uint8Array(0);if("string"!=typeof t)break;return tB.dec(t)}throw Error()}function tX(e,t,r,s){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:s?e.values[0].no:tZ;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":let n=e.findName(t);if(void 0!==n)return n.no;if(r)return tW}throw Error(`cannot decode enum ${e.typeName} from JSON: ${tK(t)}`)}function t0(e,t,r){if("map"==e.kind){tm("object"==typeof t&&null!=t);let s={},n=Object.entries(t);switch(e.V.kind){case"scalar":for(let[t,r]of n)s[t.toString()]=t2(e.V.T,r);break;case"message":for(let[e,t]of n)s[e.toString()]=t.toJson(r);break;case"enum":let i=e.V.T;for(let[e,t]of n)s[e.toString()]=t1(i,t,r.enumAsInteger)}return r.emitDefaultValues||n.length>0?s:void 0}if(e.repeated){tm(Array.isArray(t));let s=[];switch(e.kind){case"scalar":for(let r=0;r<t.length;r++)s.push(t2(e.T,t[r]));break;case"enum":for(let n=0;n<t.length;n++)s.push(t1(e.T,t[n],r.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)s.push(t[e].toJson(r))}return r.emitDefaultValues||s.length>0?s:void 0}switch(e.kind){case"scalar":return t2(e.T,t);case"enum":return t1(e.T,t,r.enumAsInteger);case"message":return tQ(e.T,t).toJson(r)}}function t1(e,t,r){var s;if(tm("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(r)return t;let n=e.findNumber(t);return null!==(s=null==n?void 0:n.name)&&void 0!==s?s:t}function t2(e,t){switch(e){case v.INT32:case v.SFIXED32:case v.SINT32:case v.FIXED32:case v.UINT32:return tm("number"==typeof t),t;case v.FLOAT:case v.DOUBLE:if(tm("number"==typeof t),Number.isNaN(t))return"NaN";if(t===Number.POSITIVE_INFINITY)return"Infinity";if(t===Number.NEGATIVE_INFINITY)return"-Infinity";return t;case v.STRING:return tm("string"==typeof t),t;case v.BOOL:return tm("boolean"==typeof t),t;case v.UINT64:case v.FIXED64:case v.INT64:case v.SFIXED64:case v.SINT64:return tm("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case v.BYTES:return tm(t instanceof Uint8Array),tB.enc(t)}}var t4=Symbol("@bufbuild/protobuf/unknown-fields"),t3={readUnknownFields:!0,readerFactory:e=>new tR(e)},t5={writeUnknownFields:!0,writerFactory:()=>new tP};function t6(e,t,r,s,n){let{repeated:i,localName:a}=r;switch(r.oneof&&((e=e[r.oneof.localName]).case!=a&&delete e.value,e.case=a,a="value"),r.kind){case"scalar":case"enum":let o="enum"==r.kind?v.INT32:r.T,l=t9;if("scalar"==r.kind&&r.L>0&&(l=t7),i){let r=e[a];if(s==y.LengthDelimited&&o!=v.STRING&&o!=v.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)r.push(l(t,o))}else r.push(l(t,o))}else e[a]=l(t,o);break;case"message":let c=r.T;i?e[a].push(t8(t,new c,n,r)):tH(e[a])?t8(t,e[a],n,r):(e[a]=t8(t,new c,n,r),!c.fieldWrapper||r.oneof||r.repeated||(e[a]=c.fieldWrapper.unwrapField(e[a])));break;case"map":let[d,u]=function(e,t,r){let s,n;let i=t.uint32(),a=t.pos+i;for(;t.pos<a;){let[i]=t.tag();switch(i){case 1:s=t9(t,e.K);break;case 2:switch(e.V.kind){case"scalar":n=t9(t,e.V.T);break;case"enum":n=t.int32();break;case"message":n=t8(t,new e.V.T,r,void 0)}}}if(void 0===s&&(s=tL(e.K,b.BIGINT)),"string"!=typeof s&&"number"!=typeof s&&(s=s.toString()),void 0===n)switch(e.V.kind){case"scalar":n=tL(e.V.T,b.BIGINT);break;case"enum":n=e.V.T.values[0].no;break;case"message":n=new e.V.T}return[s,n]}(r,t,n);e[a][d]=u}}function t8(e,t,r,s){let n=t.getType().runtime.bin,i=null==s?void 0:s.delimited;return n.readMessage(t,e,i?s.no:e.uint32(),r,i),t}function t7(e,t){let r=t9(e,t);return"bigint"==typeof r?r.toString():r}function t9(e,t){switch(t){case v.STRING:return e.string();case v.BOOL:return e.bool();case v.DOUBLE:return e.double();case v.FLOAT:return e.float();case v.INT32:return e.int32();case v.INT64:return e.int64();case v.UINT64:return e.uint64();case v.FIXED64:return e.fixed64();case v.BYTES:return e.bytes();case v.FIXED32:return e.fixed32();case v.SFIXED32:return e.sfixed32();case v.SFIXED64:return e.sfixed64();case v.SINT64:return e.sint64();case v.UINT32:return e.uint32();case v.SINT32:return e.sint32()}}function re(e,t,r,s){tm(void 0!==t);let n=e.repeated;switch(e.kind){case"scalar":case"enum":let i="enum"==e.kind?v.INT32:e.T;if(n){if(tm(Array.isArray(t)),e.packed)!function(e,t,r,s){if(!s.length)return;e.tag(r,y.LengthDelimited).fork();let[,n]=rs(t);for(let t=0;t<s.length;t++)e[n](s[t]);e.join()}(r,i,e.no,t);else for(let s of t)rr(r,i,e.no,s)}else rr(r,i,e.no,t);break;case"message":if(n)for(let n of(tm(Array.isArray(t)),t))rt(r,s,e,n);else rt(r,s,e,t);break;case"map":for(let[n,i]of(tm("object"==typeof t&&null!=t),Object.entries(t)))!function(e,t,r,s,n){e.tag(r.no,y.LengthDelimited),e.fork();let i=s;switch(r.K){case v.INT32:case v.FIXED32:case v.UINT32:case v.SFIXED32:case v.SINT32:i=Number.parseInt(s);break;case v.BOOL:tm("true"==s||"false"==s),i="true"==s}switch(rr(e,r.K,1,i),r.V.kind){case"scalar":rr(e,r.V.T,2,n);break;case"enum":rr(e,v.INT32,2,n);break;case"message":tm(void 0!==n),e.tag(2,y.LengthDelimited).bytes(n.toBinary(t))}e.join()}(r,s,e,n,i)}}function rt(e,t,r,s){let n=tQ(r.T,s);r.delimited?e.tag(r.no,y.StartGroup).raw(n.toBinary(t)).tag(r.no,y.EndGroup):e.tag(r.no,y.LengthDelimited).bytes(n.toBinary(t))}function rr(e,t,r,s){tm(void 0!==s);let[n,i]=rs(t);e.tag(r,n)[i](s)}function rs(e){let t=y.Varint;switch(e){case v.BYTES:case v.STRING:t=y.LengthDelimited;break;case v.DOUBLE:case v.FIXED64:case v.SFIXED64:t=y.Bit64;break;case v.FIXED32:case v.SFIXED32:case v.FLOAT:t=y.Bit32}return[t,v[e].toLowerCase()]}function rn(e){if(void 0===e)return e;if(tH(e))return e.clone();if(e instanceof Uint8Array){let t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function ri(e){return e instanceof Uint8Array?e:new Uint8Array(e)}var ra=class{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){let e={};for(let t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){let e={};for(let t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){let e;this.members=[];let t=this.members;for(let r of this.list())r.oneof?r.oneof!==e&&(e=r.oneof,t.push(e)):t.push(r)}return this.members}};function ro(e,t){let r=rc(e);return t?r:rh(rp(r))}var rl=rc;function rc(e){let t=!1,r=[];for(let s=0;s<e.length;s++){let n=e.charAt(s);switch(n){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r.push(n),t=!1;break;default:t&&(t=!1,n=n.toUpperCase()),r.push(n)}}return r.join("")}var rd=new Set(["constructor","toString","toJSON","valueOf"]),ru=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),rm=e=>`${e}$`,rp=e=>ru.has(e)?rm(e):e,rh=e=>rd.has(e)?rm(e):e,rg=class{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=ro(e,!1)}addField(e){tm(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}},rf=(c=e=>new ra(e,e=>(function(e,t){var r,s,n,i,a,o;let l;let c=[];for(let d of"function"==typeof e?e():e){if(d.localName=ro(d.name,void 0!==d.oneof),d.jsonName=null!==(r=d.jsonName)&&void 0!==r?r:rl(d.name),d.repeated=null!==(s=d.repeated)&&void 0!==s&&s,"scalar"==d.kind&&(d.L=null!==(n=d.L)&&void 0!==n?n:b.BIGINT),d.delimited=null!==(i=d.delimited)&&void 0!==i&&i,d.req=null!==(a=d.req)&&void 0!==a&&a,d.opt=null!==(o=d.opt)&&void 0!==o&&o,void 0===d.packed&&(t?d.packed="enum"==d.kind||"scalar"==d.kind&&d.T!=v.BYTES&&d.T!=v.STRING:d.packed=!1),void 0!==d.oneof){let e="string"==typeof d.oneof?d.oneof:d.oneof.name;l&&l.name==e||(l=new rg(e)),d.oneof=l,l.addField(d)}c.push(d)}return c})(e,!0)),d=e=>{for(let t of e.getType().fields.byMember()){if(t.opt)continue;let r=t.localName;if(t.repeated){e[r]=[];continue}switch(t.kind){case"oneof":e[r]={case:void 0};break;case"enum":e[r]=0;break;case"map":e[r]={};break;case"scalar":e[r]=tL(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:function(e){return e?Object.assign(Object.assign({},tz),e):tz},makeWriteOptions:function(e){return e?Object.assign(Object.assign({},tG),e):tG},readMessage(e,t,r,s){if(null==t||Array.isArray(t)||"object"!=typeof t)throw Error(`cannot decode message ${e.typeName} from JSON: ${tK(t)}`);s=null!=s?s:new e;let n=new Map,i=r.typeRegistry;for(let[a,o]of Object.entries(t)){let t=e.fields.findJsonName(a);if(t){if(t.oneof){if(null===o&&"scalar"==t.kind)continue;let r=n.get(t.oneof);if(void 0!==r)throw Error(`cannot decode message ${e.typeName} from JSON: multiple keys for oneof "${t.oneof.name}" present: "${r}", "${a}"`);n.set(t.oneof,a)}tJ(s,o,t,r,e)}else{let t=!1;if((null==i?void 0:i.findExtension)&&a.startsWith("[")&&a.endsWith("]")){let n=i.findExtension(a.substring(1,a.length-1));if(n&&n.extendee.typeName==e.typeName){t=!0;let[e,i]=tD(n);tJ(e,o,n.field,r,n),function(e,t,r,s){t$(t,e);let n=t.runtime.bin.makeReadOptions(s),i=t.runtime.bin.makeWriteOptions(s);if(tO(e,t)){let r=e.getType().runtime.bin.listUnknownFields(e).filter(e=>e.no!=t.field.no);for(let t of(e.getType().runtime.bin.discardUnknownFields(e),r))e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}let a=i.writerFactory(),o=t.field;o.opt||o.repeated||"enum"!=o.kind&&"scalar"!=o.kind||(o=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(o,r,a,i);let l=n.readerFactory(a.finish());for(;l.pos<l.len;){let[t,r]=l.tag(),s=l.skip(r,t);e.getType().runtime.bin.onUnknownField(e,t,r,s)}}(s,n,i(),r)}}if(!t&&!r.ignoreUnknownFields)throw Error(`cannot decode message ${e.typeName} from JSON: key "${a}" is unknown`)}}return s},writeMessage(e,t){let r;let s=e.getType(),n={};try{for(r of s.fields.byNumber()){if(!tV(r,e)){var i;if(r.req)throw"required field not set";if(!t.emitDefaultValues||!((i=r).repeated||"map"==i.kind||!i.oneof&&"message"!=i.kind&&!i.opt&&!i.req))continue}let s=r.oneof?e[r.oneof.localName].value:e[r.localName],a=t0(r,s,t);void 0!==a&&(n[t.useProtoFieldName?r.name:r.jsonName]=a)}let a=t.typeRegistry;if(null==a?void 0:a.findExtensionFor)for(let r of s.runtime.bin.listUnknownFields(e)){let i=a.findExtensionFor(s.typeName,r.no);if(i&&tO(e,i)){let r=function(e,t,r){t$(t,e);let s=t.runtime.bin.makeReadOptions(r),n=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let r=e.length-1;r>=0;--r)if(e[r].no==t.no)return[e[r]];return[]}return e.filter(e=>e.no===t.no)}(e.getType().runtime.bin.listUnknownFields(e),t.field),[i,a]=tD(t);for(let e of n)t.runtime.bin.readField(i,s.readerFactory(e.data),t.field,e.wireType,s);return a()}(e,i,t),s=t0(i.field,r,t);void 0!==s&&(n[i.field.jsonName]=s)}}}catch(n){let e=r?`cannot encode field ${s.typeName}.${r.name} to JSON`:`cannot encode message ${s.typeName} to JSON`,t=n instanceof Error?n.message:String(n);throw Error(e+(t.length>0?`: ${t}`:""))}return n},readScalar:(e,t,r)=>tY(e,t,null!=r?r:b.BIGINT,!0),writeScalar(e,t,r){if(void 0!==t&&(r||tA(e,t)))return t2(e,t)},debug:tK},bin:{makeReadOptions:function(e){return e?Object.assign(Object.assign({},t3),e):t3},makeWriteOptions:function(e){return e?Object.assign(Object.assign({},t5),e):t5},listUnknownFields(e){var t;return null!==(t=e[t4])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[t4]},writeUnknownFields(e,t){let r=e[t4];if(r)for(let e of r)t.tag(e.no,e.wireType).raw(e.data)},onUnknownField(e,t,r,s){Array.isArray(e[t4])||(e[t4]=[]),e[t4].push({no:t,wireType:r,data:s})},readMessage(e,t,r,s,n){let i,a;let o=e.getType(),l=n?t.len:t.pos+r;for(;t.pos<l&&([i,a]=t.tag(),!0!==n||a!=y.EndGroup);){let r=o.fields.find(i);if(!r){let r=t.skip(a,i);s.readUnknownFields&&this.onUnknownField(e,i,a,r);continue}t6(e,t,r,a,s)}if(n&&(a!=y.EndGroup||i!==r))throw Error("invalid end group tag")},readField:t6,writeMessage(e,t,r){let s=e.getType();for(let n of s.fields.byNumber()){if(!tV(n,e)){if(n.req)throw Error(`cannot encode field ${s.typeName}.${n.name} to binary: required field not set`);continue}let i=n.oneof?e[n.oneof.localName].value:e[n.localName];re(n,i,t,r)}return r.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,r,s){void 0!==t&&re(e,t,r,s)}},util:Object.assign(Object.assign({},{setEnumType:tx,initPartial(e,t){if(void 0!==e)for(let r of t.getType().fields.byMember()){let s=r.localName;if(null!=e[s])switch(r.kind){case"oneof":let n=e[s].case;if(void 0===n)continue;let i=r.findField(n),a=e[s].value;i&&"message"==i.kind&&!tH(a,i.T)?a=new i.T(a):i&&"scalar"===i.kind&&i.T===v.BYTES&&(a=ri(a)),t[s]={case:n,value:a};break;case"scalar":case"enum":let o=e[s];r.T===v.BYTES&&(o=r.repeated?o.map(ri):ri(o)),t[s]=o;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===v.BYTES)for(let[r,n]of Object.entries(e[s]))t[s][r]=ri(n);else Object.assign(t[s],e[s]);break;case"message":let l=r.V.T;for(let r of Object.keys(e[s])){let n=e[s][r];l.fieldWrapper||(n=new l(n)),t[s][r]=n}}break;case"message":let c=r.T;if(r.repeated)t[s]=e[s].map(e=>tH(e,c)?e:new c(e));else{let r=e[s];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?t[s]=ri(r):t[s]=r:t[s]=tH(r,c)?r:new c(r)}}}},equals:(e,t,r)=>t===r||!!t&&!!r&&e.fields.byMember().every(e=>{let s=t[e.localName],n=r[e.localName];if(e.repeated){if(s.length!==n.length)return!1;switch(e.kind){case"message":return s.every((t,r)=>e.T.equals(t,n[r]));case"scalar":return s.every((t,r)=>t_(e.T,t,n[r]));case"enum":return s.every((e,t)=>t_(v.INT32,e,n[t]))}throw Error(`repeated cannot contain ${e.kind}`)}switch(e.kind){case"message":let i=s,a=n;return e.T.fieldWrapper&&(void 0===i||tH(i)||(i=e.T.fieldWrapper.wrapField(i)),void 0===a||tH(a)||(a=e.T.fieldWrapper.wrapField(a))),e.T.equals(i,a);case"enum":return t_(v.INT32,s,n);case"scalar":return t_(e.T,s,n);case"oneof":if(s.case!==n.case)return!1;let o=e.findField(s.case);if(void 0===o)return!0;switch(o.kind){case"message":return o.T.equals(s.value,n.value);case"enum":return t_(v.INT32,s.value,n.value);case"scalar":return t_(o.T,s.value,n.value)}throw Error(`oneof cannot contain ${o.kind}`);case"map":let l=Object.keys(s).concat(Object.keys(n));switch(e.V.kind){case"message":let c=e.V.T;return l.every(e=>c.equals(s[e],n[e]));case"enum":return l.every(e=>t_(v.INT32,s[e],n[e]));case"scalar":let d=e.V.T;return l.every(e=>t_(d,s[e],n[e]))}}}),clone(e){let t=e.getType(),r=new t;for(let s of t.fields.byMember()){let t;let n=e[s.localName];if(s.repeated)t=n.map(rn);else if("map"==s.kind)for(let[e,i]of(t=r[s.localName],Object.entries(n)))t[e]=rn(i);else t="oneof"==s.kind?s.findField(n.case)?{case:n.case,value:rn(n.value)}:{case:void 0}:rn(n);r[s.localName]=t}for(let s of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(r,s.no,s.wireType,s.data);return r}}),{newFieldList:c,initFields:d}),makeMessageType(e,t,r){return function(e,t,r,s){var n;let i=null!==(n=null==s?void 0:s.localName)&&void 0!==n?n:t.substring(t.lastIndexOf(".")+1),a={[i]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[i];return Object.setPrototypeOf(a.prototype,new ty),Object.assign(a,{runtime:e,typeName:t,fields:e.util.newFieldList(r),fromBinary:(e,t)=>new a().fromBinary(e,t),fromJson:(e,t)=>new a().fromJson(e,t),fromJsonString:(e,t)=>new a().fromJsonString(e,t),equals:(t,r)=>e.util.equals(a,t,r)}),a}(this,e,t,r)},makeEnum:function(e,t,r){let s={};for(let e of t){let t=tb(e);s[t.localName]=t.no,s[t.no]=t.localName}return tx(s,e,t,r),s},makeEnumType:tv,getEnumType:function(e){let t=e[tf];return tm(t,"missing enum type on enum object"),t},makeExtension(e,t,r){var s;let n;return s=this,{typeName:e,extendee:t,get field(){if(!n){let t="function"==typeof r?r():r;t.name=e.split(".").pop(),t.jsonName=`[${e}]`,n=s.util.newFieldList([t]).list()[0]}return n},runtime:s}}}).makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),rx="https://pump.mypinata.cloud/ipfs/QmeSzchzEPqCU1jwTnsipwcBAeH7S4bmVvFGfF65iA1BY1",rv=["ipfs.io","cf-ipfs.com","pump.mypinata.cloud"],rb=e=>{try{let t=new URL(e);return rv.includes(t.hostname)&&t.pathname.startsWith("/ipfs/")&&t.pathname.length>6}catch(e){return!1}},ry=e=>{try{let t=new URL(e);return"https:"===t.protocol}catch(e){return!1}},rw=(e,t)=>e?rb(e)?(!(e=e.includes("https://cf-ipfs.com/ipfs/")?e.replace(/https:\/\/cf-ipfs\.com\/ipfs\//,"https://ipfs.io/ipfs/"):e.replace(/https:\/\/[^/]+\/ipfs\//,t)).startsWith(t)&&e.includes("ipfs/")&&(e=t+e.substring(e.indexOf("ipfs/")+5)),e):ry(e)?e:rx:rx,rj=e=>{try{let t=JSON.parse(e.metadata||"{}");return{...t,avatar_image:t.avatar_image||rx}}catch{return{}}},rk=(e,t)=>{let r;let s=rj(e);return r=e.kind===rf.AGENT?e.identity.slice(e.identity.length-6,e.identity.length):e.kind===rf.INGRESS?s.username||e.identity.split("-")[0].slice(0,6):e.name||s.username||e.identity.split("-")[0].slice(0,6),t?`${r} (screensharing)`:r},rN=e=>!!e?.publication?.track&&!e.publication.track.isMuted,rC=(e,t)=>e===t||!!e&&!!t&&["id","mintId","creatorAddress","streamStartTimestamp","streamEndTimestamp","numParticipants","isLive","thumbnail","downrankScore"].every(r=>e[r]===t[r]);function rS(e){return!!e&&(!!e&&"host"===rj(e)?.role||!!e&&rj(e)?.role==="co-host")}var rI=(0,_.U)((e,t)=>({livestreamsByMintId:{},getLivestream:e=>t().livestreamsByMintId[e]??null,setLivestream:(t,r)=>e(e=>rC(e.livestreamsByMintId[t],r)?e:{livestreamsByMintId:{...e.livestreamsByMintId,[t]:r}}),clearLivestream:t=>e(e=>{let{[t]:r,...s}=e.livestreamsByMintId;return{livestreamsByMintId:s}})})),rE=({mintId:e,enabled:t=!0})=>{let{getLivestream:r,setLivestream:s}=rI(),n=r(e),{isLoading:i,error:a}=tu({mintId:e,enabled:t,onSuccess:t=>{let r=!t||t?.isLive===!1,n=t?.isLive===!0;r?s(e,null):n&&s(e,t),e8.debug("[useLivestreamData] Query response",{mintId:e,action:r?"clear":n?"update":"keep",isLive:t?.isLive})}});return{livestream:n,isLoading:i,error:a}},rM=(0,C.createContext)(void 0),rT=({children:e,mint:t,showControls:r=!0,isMobile:s,enableCoinQuery:n=!1,initialCoinData:i,onTrackEvent:a,onBuyReaction:o})=>{let[l,c]=(0,C.useState)(null),[d,u]=(0,C.useState)(!1),[m,p]=(0,C.useState)(!1),[h,g]=(0,C.useState)(!1),[f,x]=(0,C.useState)(!1),v=(0,C.useRef)(null),b=void 0!==s?s:f,y=(0,N.NL)();rE({mintId:t}),(0,C.useEffect)(()=>{if(void 0!==s)return;let e=()=>x(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[s]);let{coinInfo:w}=tc({mintId:t,enabled:n,initialCoinData:i,onSuccess:e=>{let r=Date.now(),s=e?.livestream_ban_expiry,n=!!s&&s>r;e8.debug("[LivestreamProvider] useLivestreamCoinInfo onSuccess",{mintId:t,dataExists:!!e,calculatedIsBanned:n}),g(n)}}),j=(0,C.useCallback)(e=>{e8.info("[LivestreamProvider] resetContext called.",{mintId:t}),c(null),u(!1),p(e??!1),rI.getState().clearLivestream(t),y.invalidateQueries({queryKey:[ta,t]})},[t,y]),I=(0,C.useMemo)(()=>(e8.debug("[LivestreamProvider] Recalculating LivestreamContext value.",{mintId:t}),{mintId:t,token:l,setToken:c,coinInfo:w,showBackstage:d,setShowBackstage:u,isDisconnected:m,setIsDisconnected:p,resetContext:j,isBanned:h,showControls:r,isMobile:b,roomRef:v,onBuyReaction:o}),[t,l,c,w,d,u,m,j,h,r,b,v,o]);return(0,S.jsx)(e5,{onTrackEvent:a,children:(0,S.jsx)(rM.Provider,{value:I,children:(0,S.jsx)(k.zt,{children:e})})})};function r_(){let e=(0,C.useContext)(rM);if(void 0===e)throw Error("useLivestreamContext must be used within a LivestreamProvider");return e}var rL="get-banned-users",rA=(e,t={})=>{let{enabled:r=!0}=t;return(0,I.a)({queryKey:[rL,e],queryFn:async()=>{if(!e)return e8.debug("[useGetBannedUsers] Skipping fetch: roomId is missing"),[];e8.debug(`[useGetBannedUsers] Fetching banned users for room: ${e}`);try{let t=await ti.get(`chat/moderation/rooms/${e}/bans`).json();return e8.debug(`[useGetBannedUsers] Fetched ${t.length} banned users for room: ${e}`),t}catch(r){let t=r instanceof Error?r.message:String(r);throw e8.error(`[useGetBannedUsers] Failed to fetch banned users for room: ${e}`,{error:t}),r}},enabled:!!e&&r,staleTime:6e4})},rP=(0,_.U)((e,t)=>({roomModeratorsByRoom:{},setModerators:(t,r)=>e(e=>({roomModeratorsByRoom:{...e.roomModeratorsByRoom,[t]:new Set(r.map(e=>e.toLowerCase()))}})),addModerator:(t,r)=>e(e=>{let s=new Set(e.roomModeratorsByRoom[t]||new Set);return s.add(r.toLowerCase()),{roomModeratorsByRoom:{...e.roomModeratorsByRoom,[t]:s}}}),removeModerator:(t,r)=>e(e=>{let s=new Set(e.roomModeratorsByRoom[t]||new Set);return s.delete(r.toLowerCase()),{roomModeratorsByRoom:{...e.roomModeratorsByRoom,[t]:s}}}),isRoomModerator:(e,r)=>{let s=t().roomModeratorsByRoom[e];return!!s&&s.has(r.toLowerCase())},clearModerators:t=>e(e=>{if(t){let{[t]:r,...s}=e.roomModeratorsByRoom;return{roomModeratorsByRoom:s}}return{roomModeratorsByRoom:{}}})})),rR="get-room-moderators",rD=(e,t={})=>{let{enabled:r=!0}=t;return(0,I.a)({queryKey:[rR,e],queryFn:async()=>{if(!e)return e8.debug("[useGetRoomModerators] Skipping fetch: roomId is missing"),[];e8.debug(`[useGetRoomModerators] Fetching room moderators for room: ${e}`);try{let t=await ti.get(`chat/moderation/rooms/${e}/moderators`).json();return e8.debug(`[useGetRoomModerators] Fetched ${t.length} room moderators for room: ${e}`),(0,rP.getState().setModerators)(e,t.map(e=>e.userAddress)),t}catch(r){let t=r instanceof Error?r.message:String(r);throw e8.error(`[useGetRoomModerators] Failed to fetch room moderators for room: ${e}`,{error:t}),r}},enabled:!!e&&r,staleTime:6e4})},rF=()=>{if("undefined"==typeof document)return null;for(let e of document.cookie.split(";")){let[t,r]=e.trim().split("=");if("auth_token"===t&&r)return r}return null},rU=()=>{let e=rF();return!(!e||0===e.length||3!==e.split(".").length||rO(e))},rB=e=>{try{let t=e.split(".");if(3!==t.length)return null;let r=t[1],s=atob(r.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(s)}catch(e){return null}},rO=e=>{let t=rB(e);if(!t||!t.exp)return!0;let r=Math.floor(Date.now()/1e3);return t.exp<r},r$=()=>{let[e,t]=(0,C.useState)(null),[r,s]=(0,C.useState)(!1),[n,i]=(0,C.useState)(!1),[a,o]=(0,C.useState)(null),[l,c]=(0,C.useState)(0),d=(0,C.useRef)(null),{trackEvent:u}=e7(),m=(0,C.useRef)(),p=(0,C.useRef)(""),h=(0,C.useRef)(""),g=(0,C.useRef)(5),f=(0,C.useRef)(null),x=(0,C.useCallback)(()=>{f.current&&(clearTimeout(f.current),f.current=null)},[]),v=(0,C.useCallback)(e=>Math.min(1e3*Math.pow(2,e),3e4)+1e3*Math.random(),[]),b=(0,C.useCallback)(()=>{if(l>=g.current){e8.error("[useSocketConnection] Max retry attempts reached",{retryCount:l,maxRetries:g.current}),o("Max retry attempts reached. Please refresh the page."),i(!1);return}let e=v(l);e8.info("[useSocketConnection] Scheduling reconnect attempt",{retryCount:l+1,delayMs:e}),x(),f.current=setTimeout(()=>{p.current&&h.current&&(c(e=>e+1),y(p.current,h.current,m.current))},e)},[l,v,x]),y=(0,C.useCallback)((e,r,n)=>{if(p.current=e,h.current=r,m.current=n,d.current){e8.warn("[useSocketConnection] Connect skipped (already have socket)",{url:e,socketId:d.current.id});return}u("common_generic_socket_connection_attempt",{url:e,namespace:n}),e8.info("[useSocketConnection] Attempting to connect",{url:e,origin:r,namespace:n,retryCount:l,hasAuthToken:rU(),authTokenInPayload:!!rF()}),i(!0),o(null),s(!1);let a={path:"/socket.io/",reconnection:!1,timeout:3e4,autoConnect:!0,transports:["websocket"],upgrade:!0,forceNew:!0,auth:{origin:r,timestamp:Date.now(),token:rF()},withCredentials:!0};try{let r=(0,L.io)(e,a);d.current=r,t(r),e8.debug("[useSocketConnection] Socket instance created",{url:e,socketId:r.id,authToken:rF()?.substring(0,20)+"...",authPayloadHasToken:!!rF()})}catch(s){let r=s instanceof Error?s.message:"Socket initialization failed";e8.error("[useSocketConnection] Socket initialization error",{url:e,error:r,retryCount:l}),o(r),i(!1),d.current=null,t(null),u("common_generic_socket_connection_state_changed",{connected:!1,error:r,namespace:m.current}),b()}},[u,l,b]),w=(0,C.useCallback)(()=>{x(),c(0),d.current&&(e8.info("[useSocketConnection] Disconnecting socket",{id:d.current.id}),d.current.disconnect()),d.current=null,t(null),s(!1),i(!1),o(null)},[x]),j=(0,C.useCallback)(()=>{e8.info("[useSocketConnection] Force reconnect requested"),c(0),w(),setTimeout(()=>{p.current&&h.current&&y(p.current,h.current,m.current)},1e3)},[w,y]);return(0,C.useEffect)(()=>{if(!e)return;let r=()=>{d.current===e&&(e8.info("[useSocketConnection] Socket connected",{id:e.id,retryCount:l}),s(!0),i(!1),o(null),c(0),x(),u("common_generic_socket_connection_state_changed",{connected:!0,namespace:m.current}))},n=r=>{if(d.current===e){let n;e8.warn("[useSocketConnection] Socket disconnected",{id:e.id,reason:r,retryCount:l}),s(!1),i(!1);let a=!1;switch(r){case"io client disconnect":n=void 0;break;case"transport close":case"transport error":n="Connection lost. Reconnecting...",a=!0;break;case"io server disconnect":n="Disconnected by server. This may be due to authentication issues.",a=!0;break;default:n=`Disconnected: ${r}`,a=!0}n&&o(n),u("common_generic_socket_connection_state_changed",{connected:!1,error:n,namespace:m.current}),d.current=null,t(null),a&&b()}},a=r=>{if(d.current===e){let n=r.message||"Connection failed";e8.error("[useSocketConnection] Connection error",{id:e?.id??"N/A",error:n,retryCount:l}),s(!1),i(!1);o(n.includes("401")||n.includes("403")?"Authentication failed. Please log in again.":n.includes("timeout")?"Connection timeout. Retrying...":"Connection failed. Retrying..."),u("common_generic_socket_connection_state_changed",{connected:!1,error:n,namespace:m.current}),d.current=null,t(null),b()}};return e.on("connect",r),e.on("disconnect",n),e.on("connect_error",a),()=>{e.off("connect",r),e.off("disconnect",n),e.off("connect_error",a)}},[e,u,l,b,x]),(0,C.useEffect)(()=>()=>{x()},[x]),{socket:e,isConnected:r,isConnecting:n,connectionError:a,retryCount:l,connect:y,disconnect:w,forceReconnect:j}},rV=()=>{let e=te.livechatUrl,{socket:t,isConnected:r,isConnecting:s,connectionError:n,retryCount:i,connect:a,disconnect:o,forceReconnect:l}=r$();return{socket:t,isConnected:r,isConnecting:s,connectionError:n,retryCount:i,connect:(0,C.useCallback)(()=>{"undefined"!=typeof window&&e&&a(e,window.location.origin)},[a,e]),disconnect:(0,C.useCallback)(()=>{o()},[o]),forceReconnect:(0,C.useCallback)(()=>{l()},[l])}},rq=(0,C.createContext)(void 0),rH=({children:e})=>{let[t,r]=(0,C.useState)(!1),[s,n]=(0,C.useState)(),[i,a]=(0,C.useState)(!1),[o,l]=(0,C.useState)(!1),c=(0,C.useCallback)(()=>{r(!1),n(void 0),a(!1),l(!1)},[]),d=(0,C.useMemo)(()=>({isAuthenticated:t,userAddress:s,isCreator:i,isRoomModerator:o,setIsAuthenticated:r,setUserAddress:n,setIsCreator:a,setIsRoomModerator:l,resetAuthState:c}),[t,s,i,o,c]);return(0,S.jsx)(rq.Provider,{value:d,children:e})},rQ=()=>{let e=(0,C.useContext)(rq);if(void 0===e)throw Error("useLivechatRoomAuth must be used within a LivechatRoomAuthProvider");return e},rz=(e,t)=>{let r="string"==typeof e.username&&""!==e.username.trim()?e.username.trim():"Unknown User",s=e.timestamp&&!isNaN(new Date(e.timestamp).getTime())?new Date(e.timestamp):new Date;return{id:e.id||`fallback-${s.getTime()}-${Math.random()}`,roomId:e.roomId,username:r,message:e.message||"",userAddress:e.userAddress||"",profile_image:e.profile_image||rx,timestamp:s,messageType:"regular",isOwnMessage:!!t&&r===t,isPending:!1,replyToId:e.replyToId,replyPreview:e.replyPreview}},rG=e=>[...e].sort((e,t)=>e.timestamp.getTime()-t.timestamp.getTime()),rZ=e=>e&&0!==e.length?e[0].timestamp.getTime():null,rW=({isConnected:e,emitJoinRoom:t,emitLeaveRoom:r,onJoinSuccess:s})=>{let[n,i]=(0,C.useState)(!1),[a,o]=(0,C.useState)(!1),[l,c]=(0,C.useState)(!1),[d,u]=(0,C.useState)(null),[m,p]=(0,C.useState)(null),h=(0,C.useRef)(null),{setIsAuthenticated:g,setUserAddress:f,setIsCreator:x,setIsRoomModerator:v,resetAuthState:b}=rQ(),y=(0,C.useCallback)((e,t,r,n)=>{h.current=n,e8.info("[useLivechatRoom] Received auth status from backend",{roomId:e,authenticated:r.authenticated,userAddress:r.userAddress,isCreator:r.isCreator,isRoomModerator:r.isRoomModerator}),g(r.authenticated),f(r.userAddress||""),x(r.isCreator??!1),v(r.isRoomModerator??!1),u({id:n,username:t.username||"",profile_image:t.profile_image||rx,userAddress:r.userAddress||""}),p(e),o(!1),i(!0),s?.(e)},[g,f,x,v,s]),w=(0,C.useCallback)((r,s)=>{!e||a||l||(o(!0),t(r,s.username||"",(e,t)=>{if(Array.isArray(e)){let n=e.map(e=>rz(e,s.username));y(r,s,{authenticated:!1,messages:n},t)}else y(r,s,e,t)}))},[e,a,l,t,y]),j=(0,C.useCallback)(()=>{if(l||!m)return;e8.info("[useLivechatRoom] Attempting to leave room",{currentRoomId:m}),c(!0);let e=d?.username||"";p(null),u(null),i(!1),c(!1),b(),r(m,e),e8.info("[useLivechatRoom] Left room",{roomId:m})},[l,m,d,r,b]),k=(0,C.useCallback)(()=>{e8.debug("[useLivechatRoom] Resetting room state"),i(!1),o(!1),c(!1),u(null),p(null),b()},[b]);return(0,C.useEffect)(()=>{},[e,n,a,m,d]),{isJoined:n,isJoining:a,isLeaving:l,currentUser:d,currentRoomId:m,joinRoom:w,leaveRoom:j,resetRoomState:k,setCurrentUser:u}},rK=({socket:e})=>{let{trackEvent:t}=e7(),r=(0,C.useCallback)((r,s,n)=>{e&&(e8.debug("[useLivechatSocketEmitters] Emitting joinRoom",{roomId:r,username:s}),t("livechat_join_room_attempt",{roomId:r}),e.emit("joinRoom",{roomId:r,username:s},t=>{e.id&&n(t,e.id)}))},[e,t]);return{emitJoinRoom:r,emitLeaveRoom:(0,C.useCallback)((r,s)=>{e&&(e8.debug("[useLivechatSocketEmitters] Emitting leaveRoom",{roomId:r,username:s}),t("livechat_leave_room_attempt",{roomId:r}),e.emit("leaveRoom",{roomId:r,username:s}))},[e,t]),emitSendMessage:(0,C.useCallback)((t,r,s,n,i,a,o)=>{e&&(e8.debug("[useLivechatSocketEmitters] Emitting sendMessage",{roomId:t,username:r,profile_image:s,messageText:n,replyToId:i,replyPreview:a}),e.emit("sendMessage",{roomId:t,message:n,username:r,profile_image:s,replyToId:i,replyPreview:a},o))},[e]),emitGetMessageHistory:(0,C.useCallback)((t,r,s,n)=>{e&&(e8.debug("[useLivechatSocketEmitters] Emitting getMessageHistory",{roomId:t,beforeTimestamp:r,limit:s}),e.emit("getMessageHistory",{roomId:t,before:r,limit:s},n))},[e])}},rJ=(0,_.U)(e=>({roomModerators:{},bannedUsers:{},activeModerationRoomId:null,isModerationViewActive:!1,setRoomModerators:(t,r)=>e(e=>({roomModerators:{...e.roomModerators,[t]:r}})),addRoomModerator:(t,r)=>e(e=>{let s=e.roomModerators[t]||[];return s.some(e=>e.userAddress===r.userAddress)?e:{roomModerators:{...e.roomModerators,[t]:[...s,r]}}}),removeRoomModerator:(t,r)=>e(e=>({roomModerators:{...e.roomModerators,[t]:(e.roomModerators[t]||[]).filter(e=>e.userAddress!==r)}})),setBannedUsers:(t,r)=>e(e=>({bannedUsers:{...e.bannedUsers,[t]:r}})),addBannedUser:(t,r)=>e(e=>{let s=e.bannedUsers[t]||[];return s.some(e=>e.userAddress===r.userAddress)?e:{bannedUsers:{...e.bannedUsers,[t]:[...s,r]}}}),removeBannedUser:(t,r)=>e(e=>({bannedUsers:{...e.bannedUsers,[t]:(e.bannedUsers[t]||[]).filter(e=>e.userAddress!==r)}})),openModerationView:t=>e({activeModerationRoomId:t,isModerationViewActive:!0}),closeModerationView:()=>e({activeModerationRoomId:null,isModerationViewActive:!1}),clearRoomModerationState:t=>e(e=>({roomModerators:{...e.roomModerators,[t]:[]},bannedUsers:{...e.bannedUsers,[t]:[]}})),resetAllModerationState:()=>e({roomModerators:{},bannedUsers:{},activeModerationRoomId:null,isModerationViewActive:!1})})),rY=(0,_.U)((e,t)=>({participantsByRoom:{},bannedUsersByRoom:{},banUser:(t,r)=>e(e=>{let s=new Set(e.bannedUsersByRoom[r]||new Set);return s.add(t),{bannedUsersByRoom:{...e.bannedUsersByRoom,[r]:s}}}),unbanUser:(t,r)=>e(e=>{let s=new Set(e.bannedUsersByRoom[r]||new Set);return s.delete(t),{bannedUsersByRoom:{...e.bannedUsersByRoom,[r]:s}}}),isUserBanned:(e,r)=>{let s=t().bannedUsersByRoom[r];return!!s&&s.has(e)},clearBannedUsers:t=>e(e=>{if(!t)return{bannedUsersByRoom:{}};{let{[t]:r,...s}=e.bannedUsersByRoom;return{bannedUsersByRoom:s}}}),setParticipants:(t,r)=>e(e=>({participantsByRoom:{...e.participantsByRoom,[t]:r}})),addParticipant:(t,r)=>e(e=>{let s=e.participantsByRoom[t]||[];return s.some(e=>e.userAddress===r.userAddress)?e:{participantsByRoom:{...e.participantsByRoom,[t]:[...s,r]}}}),removeParticipant:(t,r)=>e(e=>{let s=e.participantsByRoom[t]||[];return{participantsByRoom:{...e.participantsByRoom,[t]:s.filter(e=>e.userAddress!==r)}}})})),rX=({socket:e,roomId:t,onNewMessage:r,onMessageDeleted:s,onUserMessagesWiped:n,onModeratorAssigned:i,onModeratorUnassigned:a})=>{let{addBannedUser:o,removeBannedUser:l}=rJ(),c=rY(e=>e.addParticipant),d=rY(e=>e.removeParticipant),{userAddress:u,setIsRoomModerator:m}=rQ();(0,C.useEffect)(()=>{if(!e)return;let t=t=>{e8.debug("[useLivechatSocketEvents] Received newMessage event",{id:t?.id,roomId:t?.roomId});try{r?.(t)}catch(e){e8.error("[useLivechatSocketEvents] Error processing newMessage",{id:t?.id,error:e instanceof Error?e.message:String(e)})}t&&t.id&&(e8.debug("[useLivechatSocketEvents] Emitting messageReceived ack",{messageId:t.id}),e.emit("messageReceived",{messageId:t.id}))};return r&&e.on("newMessage",t),s&&e.on("messageDeleted",e=>{s(e.messageId)}),e.on("userMessagesWiped",n),e.on("roomModeratorAssigned",i),e.on("roomModeratorUnassigned",a),()=>{r&&e.off("newMessage",t),s&&e.off("messageDeleted"),e.off("userMessagesWiped",n),e.off("roomModeratorAssigned",i),e.off("roomModeratorUnassigned",a)}},[e,r,t,s,n,o,l,c,d,u,m,i,a]),(0,C.useEffect)(()=>{if(!e)return;let s=()=>{e8.info("[useLivechatSocketEvents] connect/reconnect event triggered",{roomId:t}),t&&(e8.debug("[useLivechatSocketEvents] Emitting getMissedMessages",{roomId:t}),e.emit("getMissedMessages",{roomId:t},e=>{e8.debug("[useLivechatSocketEvents] Received response for getMissedMessages",{count:e?.length??0,roomId:t}),e&&e.length>0&&e.forEach(e=>{try{r&&r(e)}catch(t){e8.error("[useLivechatSocketEvents] Error processing missed message",{id:e?.id,error:t instanceof Error?t.message:String(t)})}})}))};return e.on("connect",s),()=>{e.off("connect",s)}},[e,r,t]),(0,C.useEffect)(()=>{if(!e)return;let t=e=>{try{let{name:t,value:r,maxAge:s}=e;e8.debug("[useLivechatSocketEvents] Received setCookie event",{name:t,value:r}),document.cookie=`${t}=${r}; Path=/; Max-Age=${s}; SameSite=Lax`}catch(e){e8.error("[useLivechatSocketEvents] Error processing setCookie event",{error:e instanceof Error?e.message:String(e)})}};return e.on("setCookie",t),()=>{e.off("setCookie",t)}},[e])},r0=async(e,t,r,s)=>(e8.debug("[useMessagesQuery] Fetching message history",{roomId:t,beforeTimestamp:s}),new Promise(n=>{e(t,s,20,e=>{if(!e)return e8.warn("[useMessagesQuery] No response received for getMessageHistory",{roomId:t,beforeTimestamp:s}),n({messages:[],nextCursor:null});let i=Array.isArray(e)?e:e?.messages;if(i&&i.length>0){let e=rG(i.filter(e=>"string"==typeof e.username&&""!==e.username.trim()).map(e=>rz(e,r))),s=rZ(e),a=i.length>=20;e8.debug("[useMessagesQuery] History fetch successful",{roomId:t,count:e.length,hasMore:a,oldestTs:s}),n({messages:e.filter(Boolean),nextCursor:a?s:null})}else e8.debug("[useMessagesQuery] History fetch returned no messages",{roomId:t,beforeTimestamp:s}),n({messages:[],nextCursor:null})})})),r1=({socket:e,roomId:t,currentUser:r,isEnabled:s})=>{let{emitGetMessageHistory:n}=rK({socket:e});return(0,A.N)({queryKey:r2(t),queryFn:({pageParam:e=null})=>t?r0(n,t,r?.username,e):(e8.warn("[useMessagesQuery] Query function skipped, no roomId"),Promise.resolve({messages:[],nextCursor:null})),initialPageParam:null,getNextPageParam:e=>e.nextCursor,getPreviousPageParam:()=>void 0,enabled:s&&!!t&&!!e,staleTime:1/0,refetchOnWindowFocus:!1,refetchOnMount:!1})},r2=e=>["livechat",e,"messages"],r4=({socket:e,roomId:t,currentUser:r,addSystemMessage:s})=>{let n=(0,N.NL)(),{emitSendMessage:i}=rK({socket:e}),{trackEvent:a}=e7();return(0,P.D)({mutationFn:({messageText:s,replyToId:n,replyPreview:a})=>new Promise((o,l)=>{if(!e||!t||!r)return e8.error("[useSendMessageMutation] Mutation failed pre-check",{hasSocket:!!e,roomId:t,hasCurrentUser:!!r}),l(Error("Chat not ready to send message."));i(t,r.username,r.profile_image,s,n,a,e=>{e?.error?(e8.error("[useSendMessageMutation] Server returned error on send message ack",{error:e.error,roomId:t,username:r.username}),l(Error(e.error))):(e8.debug("[useSendMessageMutation] Server acknowledged sent message",{response:e,roomId:t,username:r.username}),o(e))})}),onMutate:async({messageText:e,replyToId:s,replyPreview:i})=>{if(!t||!r)return;let a=r2(t);e8.debug("[useSendMessageMutation] onMutate started",{queryKey:a,messageText:e}),await n.cancelQueries({queryKey:a});let o=n.getQueryData(a),l=`pending-${Date.now()}-${Math.random()}`;return e8.debug("[useSendMessageMutation] Performing optimistic update",{queryKey:a,tempId:l}),n.setQueryData(a,n=>{if(!n)return{pages:[{messages:[],nextCursor:null}],pageParams:[null]};let a={id:l,roomId:t,username:r.username,message:e,userAddress:r.userAddress||"",profile_image:r.profile_image,timestamp:new Date,messageType:"regular",isOwnMessage:!0,isPending:!0,replyToId:s,replyPreview:i},o=n.pages.map((e,t)=>t===n.pages.length-1?{...e,messages:[...e.messages,a]}:e);return{...n,pages:o}}),{previousMessages:o,tempId:l}},onError:(e,r,i)=>{if(a("livechat_send_message_failure",{error:e.message,mintId:t??void 0}),!t||!i?.tempId)return;let o=r2(t);e8.error("[useSendMessageMutation] onError triggered",{error:e.message,variables:r,tempId:i.tempId,queryKey:o}),i?.previousMessages?n.setQueryData(o,i.previousMessages):n.setQueryData(o,e=>{if(!e)return e;let t=e.pages.map(e=>({...e,messages:e.messages.filter(e=>e.id!==i.tempId)}));return{...e,pages:t}}),s(`Failed to send message: ${e.message}`)},onSuccess:(e,r,s)=>{if(a("livechat_send_message_success",{messageLength:r.messageText.length,mintId:t??void 0}),!t||!s?.tempId)return;let i=r2(t),o=e?.id;e8.debug("[useSendMessageMutation] onSuccess triggered",{data:e,variables:r,tempId:s.tempId,confirmedId:o,queryKey:i}),n.setQueryData(i,e=>{if(!e)return e;let t=e.pages.map(e=>({...e,messages:e.messages.map(e=>e.id===s.tempId?{...e,id:o||e.id,isPending:!1}:e)}));return{...e,pages:t}})}})},r3=(0,C.createContext)(void 0),r5=({children:e,readOnly:t=!1,onTrackEvent:r})=>{let{socket:s,isConnected:n,isConnecting:i,connectionError:a,retryCount:o,connect:l,disconnect:c,forceReconnect:d}=rV(),{emitJoinRoom:u,emitLeaveRoom:m}=rK({socket:s}),p=(0,N.NL)(),{isAuthenticated:h,userAddress:g,isCreator:f,isRoomModerator:x,setIsRoomModerator:v}=rQ(),{isJoined:b,isJoining:y,isLeaving:w,currentUser:j,currentRoomId:k,joinRoom:I,leaveRoom:E,setCurrentUser:M}=rW({isConnected:n,emitJoinRoom:u,emitLeaveRoom:m,onJoinSuccess:(0,C.useCallback)(e=>{p.resetQueries({queryKey:r2(e)})},[p])}),[T,_]=(0,C.useState)([]),L=(0,C.useCallback)(e=>{let t={id:`sys-${Date.now()}`,roomId:k||"system",message:e,timestamp:new Date,messageType:"system"};_(e=>[...e,t])},[k]),{data:A,fetchNextPage:P,hasNextPage:R,isFetchingNextPage:D}=r1({socket:s,roomId:k,currentUser:j,isEnabled:n&&b}),{mutate:F,isPending:U}=r4({socket:s,roomId:k,currentUser:j,addSystemMessage:L}),B=(0,C.useCallback)(e=>{!t&&h&&e.messageText.trim()&&F(e)},[F,t,h]),O=(0,C.useCallback)(e=>{if("string"==typeof e.username&&""!==e.username.trim()&&b&&e.roomId===k){let r=rz(e,j?.username);if(!t&&h&&j&&r.isOwnMessage){let e=r2(k),t=p.getQueryData(e);if(t?.pages.flatMap(e=>e.messages).some(e=>e.isPending&&e.isOwnMessage&&e.message===r.message))return}let s=r2(k);p.setQueryData(s,e=>{if(!e||e.pages.some(e=>e.messages.some(e=>e.id===r.id&&r.id)))return e;let t=e.pages.map((t,s)=>s===e.pages.length-1?{...t,messages:[...t.messages,r]}:t);return{...e,pages:t}}),p.invalidateQueries({queryKey:s,exact:!0})}},[b,k,j,p,t,h]),$=(0,C.useCallback)(e=>{g&&e.userAddress.toLowerCase()===g.toLowerCase()&&v(!0),k&&(rP.getState().addModerator(k,e.userAddress),p.invalidateQueries({queryKey:[rR,k]}))},[g,v,k,p]),V=(0,C.useCallback)(e=>{g&&e.userAddress.toLowerCase()===g.toLowerCase()&&v(!1),k&&(rP.getState().removeModerator(k,e.userAddress),p.invalidateQueries({queryKey:[rR,k]}))},[g,v,k,p]),q=(0,C.useCallback)(e=>{if(e8.debug("[LivechatProvider] Received messageDeleted event",{messageId:e,roomId:k}),!k){e8.warn("[LivechatProvider] No current room ID for message deletion",{messageId:e});return}let t=r2(k);p.setQueryData(t,t=>{if(!t)return e8.debug("[LivechatProvider] No existing data to update for message deletion",{messageId:e,roomId:k}),t;let r=t.pages.map(t=>({...t,messages:t.messages.filter(t=>t.id!==e)})),s={...t,pages:r};return e8.debug("[LivechatProvider] Message removed from cache",{messageId:e,roomId:k}),s}),p.invalidateQueries({queryKey:t,exact:!0})},[k,p]),H=(0,C.useCallback)(e=>{if(e8.debug("[LivechatProvider] Received userMessagesWiped event",{userAddress:e.userAddress,roomId:k}),!k)return;let t=r2(k);p.setQueryData(t,t=>{if(!t)return t;let r=t.pages.map(t=>({...t,messages:t.messages.filter(t=>t.userAddress!==e.userAddress)}));return{...t,pages:r}}),p.invalidateQueries({queryKey:t,exact:!0})},[k,p]),Q=rY(e=>e.banUser),z=rY(e=>e.unbanUser);(0,C.useEffect)(()=>{if(!s||!k)return;let e=e=>{e8.debug("[LivechatProvider] Received userBannedInRoom event",{roomId:k,userAddress:e.userAddress}),Q(e.userAddress,k),p.invalidateQueries({queryKey:[rL,k]})},t=e=>{e8.debug("[LivechatProvider] Received userUnbannedInRoom event",{roomId:k,userAddress:e.userAddress}),z(e.userAddress,k),p.invalidateQueries({queryKey:[rL,k]})};return s.on("userBannedInRoom",e),s.on("userUnbannedInRoom",t),()=>{s.off("userBannedInRoom",e),s.off("userUnbannedInRoom",t)}},[s,k,p,Q,z]),rX({socket:s,roomId:k,onNewMessage:O,onMessageDeleted:q,onUserMessagesWiped:H,onModeratorAssigned:$,onModeratorUnassigned:V});let[G,Z]=(0,C.useState)(!1);(0,C.useEffect)(()=>(l(),()=>{c()}),[l,c]);let W=(0,C.useCallback)((e,t)=>{_([]),I(e,t)},[I]),K=(0,C.useCallback)(()=>{E(),_([]),k&&p.resetQueries({queryKey:r2(k)})},[E,k,p]),J=(0,C.useCallback)(()=>{Z(e=>!e)},[]),Y=(0,C.useMemo)(()=>[...A?.pages.flatMap(e=>e.messages)??[],...T].sort((e,t)=>e.timestamp.getTime()-t.timestamp.getTime()),[A,T]),X=(0,C.useMemo)(()=>({socket:s,isConnected:n,isConnecting:i,connectionError:a,retryCount:o,forceReconnect:d,isJoined:b,isJoining:y,isLeaving:w,messages:Y,currentUser:j,currentRoomId:k,hasMoreHistory:!!R,isLoadingHistory:D,loadOlderMessages:P,isCollapsed:G,toggleCollapse:J,joinRoom:W,leaveRoom:K,sendMessage:B,isSendingMessage:U,readOnly:t||!h,setCurrentUser:M,onTrackEvent:r,isAuthenticated:h,userAddress:g,isCreator:f,isRoomModerator:x}),[s,n,i,a,o,d,b,y,w,Y,j,k,R,D,G,W,K,B,P,J,U,t,M,r,h,g,f,x]);return(0,S.jsx)(e5,{onTrackEvent:r,children:(0,S.jsx)(r3.Provider,{value:X,children:e})})},r6=e=>(0,S.jsx)(rH,{children:(0,S.jsx)(r5,{...e})}),r8=()=>{let e=(0,C.useContext)(r3);if(void 0===e)throw Error("useLivechat must be used within a LivechatProvider");return e},r7=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("img",{src:"/livestreams/king-of-the-hill.png",alt:"King of the Hill"})}),r9=({marketCap:e,isKingOfTheHill:t,showKingIcon:r=!0})=>(0,S.jsx)(R.fC,{openDelay:0,closeDelay:0,children:(0,S.jsx)(R.xz,{children:(0,S.jsxs)("div",{className:F()("flex items-center rounded-[4px] py-[1px] text-sm text-white","sm:flex","mr-2"),children:[(0,S.jsx)("div",{className:"flex items-center gap-2",children:(0,S.jsx)("span",{children:e})}),r&&t&&(0,S.jsx)(r7,{className:"ml-[8px]"})]})})}),se=e=>{let[t,r]=(0,C.useState)(!1),s=rw(e.src,"https://ipfs.io/ipfs/"),n=(0,C.useMemo)(()=>`${s}?img-width=${e.width}&img-dpr=2&img-onerror=redirect`,[s,e.width]),[i,a]=(0,C.useState)(n);return((0,C.useEffect)(()=>{a(n)},[n]),t)?(0,S.jsx)("img",{...e,src:rx,className:F()(e.className,"bg-[#1C2530]"),alt:e.alt||"placeholder"}):(0,S.jsx)("img",{...e,className:F()(e.className,s===rx&&"bg-[#1C2530]"),src:i,onError:()=>{a(s),i===s&&r(!0)},alt:e.alt||""})},st=({src:e=rx,alt:t="avatar",size:r=32,className:s})=>(0,S.jsx)(se,{src:e,alt:t,width:r,height:r,className:F()("rounded-full","object-cover",s)}),sr=({showMarketCap:e=!1})=>{let{coinInfo:t}=r_();if(!t)return(0,S.jsx)("div",{});let{creatorAvatar:r,coinName:s,coinSymbol:n,marketCap:i,creatorUsername:a,isKingOfTheHill:o}=t,l=e&&i&&n;return(0,S.jsxs)("div",{className:"flex items-start gap-[8px]",children:[(0,S.jsx)(st,{src:r||"",size:40,alt:a||s||"",className:"hidden flex-shrink-0 sm:block",style:{boxShadow:"inset 0 0 0 1px #ffffff20"}}),(0,S.jsxs)("div",{className:"flex max-w-[200px] flex-col gap-[4px]",children:[(0,S.jsxs)("p",{className:"break-words text-[14px] font-bold leading-[18px] text-white",children:[s,n&&` (${n})`]}),l&&(0,S.jsx)(r9,{marketCap:i,coinSymbol:n,isKingOfTheHill:o,showKingIcon:!1}),a&&(0,S.jsx)("p",{className:"break-words text-[12px] text-white",children:a})]})]})},ss="get-clip-by-id",sn=({roomName:e,clipId:t,enabled:r=!0,onSuccess:s})=>(0,I.a)({queryKey:[ss,e,t],queryFn:async()=>{if(!e||!t)throw Error("Missing roomName or clipId");let r=await ts.get(`clips/${e}/${t}`).json();return s?.(r),r},enabled:!!e&&!!t&&r}),si=({isOpen:e,onClose:t,onUpload:r,time:s,isLoading:n=!1})=>{let[i,a]=(0,C.useState)(null);(0,C.useEffect)(()=>{let r=r=>{"Escape"===r.key&&e&&!n&&t()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[e,t,n]),(0,C.useEffect)(()=>{e||a(null)},[e]);let o=(0,C.useCallback)(e=>{let t=e[0];t&&a(URL.createObjectURL(t))},[]);(0,C.useEffect)(()=>()=>{i&&URL.revokeObjectURL(i)},[i]);let{getRootProps:l,getInputProps:c,isDragActive:d}=(0,Q.uI)({onDrop:o,accept:{"image/*":[".png",".jpg",".jpeg",".webp"]},maxFiles:1,multiple:!1,disabled:n});return e?(0,S.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,S.jsxs)("div",{className:"w-[500px] rounded-lg bg-[#1e1e1e] p-6",children:[(0,S.jsx)("div",{className:"mb-4",children:(0,S.jsxs)("div",{className:"flex items-center justify-between",children:[(0,S.jsxs)("div",{children:[(0,S.jsxs)("h2",{className:"text-lg font-medium text-white",children:["Change cover for Clip from ",s]}),(0,S.jsx)("p",{className:"mt-1 text-sm text-gray-400",children:"Upload new cover image"})]}),(0,S.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-400",disabled:n,children:(0,S.jsx)(q.Z,{size:18})})]})}),(0,S.jsxs)("div",{...l(),className:`mb-4 flex h-48 cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-700 bg-[#141414] p-6 transition-colors ${d?"border-[#87EF9B] bg-[#87EF9B]/5":""} ${n?"cursor-not-allowed opacity-50":""}`,children:[(0,S.jsx)("input",{...c(),disabled:n}),i?(0,S.jsx)("img",{src:i,alt:"Preview",className:"h-full w-full object-contain"}):(0,S.jsxs)("div",{className:"text-center",children:[(0,S.jsx)(H.Z,{className:"mx-auto mb-3 h-8 w-8 text-gray-600"}),(0,S.jsx)("button",{className:"mb-2 rounded bg-[#87EF9B] px-4 py-1.5 text-sm font-medium text-black hover:bg-[#87EF9B]/90",children:"select file"}),(0,S.jsx)("p",{className:"text-sm text-gray-500",children:"or drag and drop it here"})]})]}),(0,S.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,S.jsx)("button",{onClick:t,className:"rounded px-4 py-1.5 text-sm font-medium text-gray-400 hover:text-gray-300",disabled:n,children:"Cancel"}),(0,S.jsx)("button",{onClick:()=>{i&&fetch(i).then(e=>e.blob()).then(e=>{r(new File([e],"thumbnail.jpg",{type:"image/jpeg"}))})},disabled:!i||n,className:"rounded bg-[#87ef9b] px-4 py-1.5 text-sm font-medium text-black transition-colors hover:bg-[#87ef9b]/90 disabled:cursor-not-allowed disabled:opacity-50",children:"Save changes"})]})]})}):null},sa="get-clips-for-room",so=({roomName:e,limit:t=10,enabled:r=!0,includeUserHidden:s=!1})=>(0,A.N)({queryKey:[sa,e,t,s],queryFn:async({pageParam:r})=>{let n=new URLSearchParams;return n.set("limit",String(t)),r&&n.set("lastEvaluatedKey",r),s&&n.set("includeUserHidden","true"),await ts.get(`clips/${e}?${n.toString()}`).json()},getNextPageParam:e=>e.lastEvaluatedKey,initialPageParam:void 0,enabled:!!e&&r}),sl=()=>{let e=(0,N.NL)();return(0,P.D)({mutationFn:async({roomName:e,clipId:t,reason:r,mintId:s})=>ts.patch(`clips/${e}/${t}/hide`,{json:{reason:r,mintId:s}}),onSuccess:(t,r)=>{e.invalidateQueries({queryKey:[sa,r.roomName]}),e.invalidateQueries({queryKey:[ss,r.roomName,r.clipId]})}})},sc=()=>{let e=(0,N.NL)();return(0,P.D)({mutationFn:async({roomName:e,clipId:t,mintId:r})=>ts.patch(`clips/${e}/${t}/unhide`,{json:{mintId:r}}),onSuccess:(t,r)=>{e.invalidateQueries({queryKey:[sa,r.roomName]}),e.invalidateQueries({queryKey:[ss,r.roomName,r.clipId]})}})},sd=()=>{let e=(0,N.NL)();return(0,P.D)({mutationFn:async({roomName:e,clipId:t,file:r,mintId:s})=>{let n=new FormData;return n.append("thumbnail",r),n.append("mintId",s),ts.post(`clips/${e}/${t}/thumbnail`,{body:n})},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:[sa,r.roomName]})}})};function su(e=!1){let[t,r]=(0,C.useState)(e);return{value:t,setValue:r,toggleValue:()=>r(!t),setTrue:()=>r(!0),setFalse:()=>r(!1)}}var sm=({clip:e,mintId:t,onThumbnailModalOpen:r})=>{let{value:s,toggleValue:n,setFalse:i}=su(!1),{handleHideVideo:a,isProcessing:o}=sw({clip:e,mintId:t});return(0,S.jsx)("div",{className:"absolute right-2 top-2",children:(0,S.jsxs)("div",{className:"relative",children:[(0,S.jsx)("button",{onClick:e=>{e.stopPropagation(),n()},className:"rounded bg-black/70 p-1.5 text-white transition-all duration-200 hover:bg-black/80",children:(0,S.jsx)(G.Z,{size:16})}),s&&(0,S.jsxs)("div",{className:"absolute right-0 top-full mt-1 w-36 rounded-md bg-black/90 py-1 text-sm text-white shadow-lg",children:[(0,S.jsxs)("button",{onClick:e=>{e.stopPropagation(),r(),i()},className:"flex w-full items-center gap-2 px-3 py-1.5 text-left hover:bg-white/10",children:[(0,S.jsx)(O.Z,{size:14}),"Change cover"]}),(0,S.jsxs)("button",{onClick:e=>{e.stopPropagation(),a(),i()},disabled:o,className:"flex w-full items-center gap-2 px-3 py-1.5 text-left hover:bg-white/10 disabled:opacity-50",children:[e.hidden?(0,S.jsx)($.Z,{size:14}):(0,S.jsx)(V.Z,{size:14}),e.hidden?"Unhide video":"Hide video"]})]})]})})},sp=e=>{let t=Math.floor(e/3600),r=Math.floor(e%3600/60),s=e%60;return t>0?`${t}h ${r}m`:r>0?`${r}m ${s}s`:`${s}s`},sh=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),sg=e=>{if("undefined"==typeof window)return;let t=new URL(window.location.href);t.searchParams.set("clip",e),window.history.pushState({},"",t.toString()),window.dispatchEvent(new PopStateEvent("popstate"))},sf=()=>"undefined"==typeof window?null:new URL(window.location.href).searchParams.get("clip"),sx=()=>"undefined"!=typeof window&&new URL(window.location.href).searchParams.has("clip"),sv=()=>"undefined"!=typeof window&&!sx()&&tt.CLIPS_ENABLED,sb=({clip:e,className:t,canEdit:r})=>{let{mintId:s}=r_(),n=sp(e.duration),{value:i,setTrue:a,setFalse:o}=su(!1),{handleThumbnailUpload:l,isUploading:c}=sj({clip:e,mintId:s,onThumbnailModalClose:o});return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:`w-[220px] shrink-0 cursor-pointer transition-all duration-200 hover:scale-[1.02] hover:shadow-lg ${t??""}`,onClick:()=>sg(e.clipId),children:[(0,S.jsxs)("div",{className:"relative",children:[(0,S.jsx)("img",{src:e.thumbnailUrl,alt:"Clip thumbnail",className:"aspect-video w-full rounded-lg object-cover transition-all duration-200 hover:brightness-110"}),(0,S.jsx)("span",{className:"absolute bottom-2 right-2 rounded bg-black/70 px-2 py-0.5 text-sm font-medium text-white",children:n}),r&&(0,S.jsx)(sm,{clip:e,mintId:s,onThumbnailModalOpen:a})]}),(0,S.jsxs)("div",{className:"mt-2",children:[(0,S.jsx)("div",{className:"text-[15px] font-semibold text-white transition-colors duration-200 hover:text-gray-200",children:sh(e.startTime)}),(0,S.jsxs)("div",{className:"mt-0.5 text-sm text-gray-400 transition-colors duration-200 hover:text-gray-300",children:["duration: ",n]})]})]}),r&&(0,S.jsx)(si,{isOpen:i,onClose:o,onUpload:l,time:sh(e.startTime),isLoading:c})]})},sy=({message:e,onConfirm:t,toast:r,clip:s})=>(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:0,minWidth:320,position:"relative",padding:"16px 8px 12px 8px",background:"#18181b",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,0.25)"},children:[(0,S.jsx)("button",{onClick:()=>r.dismiss(),style:{position:"absolute",top:12,right:12,background:"transparent",border:"none",color:"#aaa",fontSize:28,cursor:"pointer",zIndex:50,padding:4,borderRadius:999,transition:"background 0.2s"},"aria-label":"Close",type:"button",children:(0,S.jsx)(q.Z,{size:28})}),(0,S.jsx)("div",{style:{display:"flex",justifyContent:"center",background:"#232323",borderRadius:8,padding:8,marginBottom:20,marginTop:8},children:(0,S.jsx)(sb,{clip:s,canEdit:!1})}),(0,S.jsx)("div",{style:{height:1,background:"#333",margin:"0 0 20px 0"}}),(0,S.jsx)("div",{style:{textAlign:"center",marginBottom:16},children:(0,S.jsx)("span",{style:{fontWeight:600,fontSize:18,color:"#fff"},children:e})}),(0,S.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,S.jsx)("button",{style:{background:"#87ef9b",color:"black",border:"none",borderRadius:6,padding:"10px 28px",fontSize:16,fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(135,239,155,0.08)",transition:"background 0.2s, box-shadow 0.2s"},onClick:()=>{r.dismiss(),t()},type:"button",children:"Confirm"})})]}),sw=({clip:e,mintId:t})=>{let{mutate:r,isPending:s}=sl(),{mutate:n,isPending:i}=sc(),a=()=>{e.hidden?n({roomName:e.roomName,clipId:e.clipId,mintId:t},{onSuccess:()=>{z.ZP.success("Video successfully unhidden.")},onError:e=>{z.ZP.error("Failed to unhide video: "+(e?.message||e))}}):r({roomName:e.roomName,clipId:e.clipId,reason:"user_hidden",mintId:t},{onSuccess:()=>{z.ZP.success("Video successfully hidden.")},onError:e=>{z.ZP.error("Failed to hide video: "+(e?.message||e))}})};return{handleHideVideo:t=>{t?.stopPropagation();let r=e.hidden?"Are you sure you want to unhide this video?":"Are you sure you want to hide this video? This video will no longer be visible to anyone.";(0,z.ZP)(t=>C.createElement(sy,{message:r,onConfirm:a,toast:{id:t.id,dismiss:()=>z.ZP.dismiss(t.id)},clip:e}),{duration:25e3,style:{padding:0,background:"none",boxShadow:"none"}})},confirmHideVideo:a,isProcessing:s||i}},sj=({clip:e,mintId:t,onThumbnailModalClose:r})=>{let{mutate:s,isPending:n}=sd();return{handleThumbnailUpload:async n=>{s({roomName:e.roomName,clipId:e.clipId,file:n,mintId:t},{onSuccess:()=>{r?.(),z.ZP.success("Thumbnail updated successfully.")},onError:e=>{z.ZP.error("Failed to update thumbnail: "+(e?.message||e))}})},isUploading:n}},sk=({className:e,canEdit:t})=>{let r=(0,C.useRef)(null),{mintId:s}=r_(),[n,i]=(0,C.useState)(!1),[a,o]=(0,C.useState)(sf()),[l,c]=(0,C.useState)(!0),[d,u]=(0,C.useState)(!1);(0,C.useEffect)(()=>{let e=()=>{o(sf())};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]);let{data:m,isLoading:p}=sn({roomName:s,clipId:a||"",enabled:!!a}),{handleHideVideo:h,isProcessing:g}=sw({clip:m,mintId:s}),{handleThumbnailUpload:f,isUploading:x}=sj({clip:m,mintId:s,onThumbnailModalClose:()=>u(!1)});return((0,C.useEffect)(()=>{let e;let t=r.current;if(t&&m){if(t.canPlayType("application/vnd.apple.mpegurl")){t.src=m.playlistUrl;return}return U.ZP.isSupported()&&((e=new U.ZP).loadSource(m.playlistUrl),e.attachMedia(t)),()=>{e&&e.destroy()}}},[m]),(0,C.useEffect)(()=>{r.current&&(r.current.muted=l)},[l]),(0,C.useEffect)(()=>{let e=r.current;if(!e)return;let t=()=>{c(e.muted)};return e.addEventListener("volumechange",t),()=>{e.removeEventListener("volumechange",t)}},[r]),a)?p?(0,S.jsx)(B.Z,{className:"animate-spin"}):m?n?(0,S.jsxs)("div",{className:"p-4 text-center text-white",children:[(0,S.jsx)("p",{className:"mb-2 font-semibold text-red-400",children:"Failed to load video."}),(0,S.jsx)("button",{onClick:()=>{i(!1)},className:"text-green-400 hover:underline",children:"Try again"})]}):(0,S.jsxs)("div",{className:e,style:{width:"100%",maxWidth:900,margin:"0 auto",padding:0},children:[(0,S.jsxs)("div",{className:"mb-2 flex items-center justify-between pt-3.5",children:[(0,S.jsxs)("div",{className:"text-left text-lg font-semibold text-white",children:["livestreamed ",sh(m.startTime)]}),t&&(0,S.jsxs)("div",{className:"flex gap-2",children:[(0,S.jsxs)("button",{onClick:e=>{e.stopPropagation(),u(!0)},className:"flex items-center gap-2 rounded bg-blue-500/80 px-2.5 py-1 text-sm font-medium text-white transition-all duration-200 hover:scale-105 hover:bg-blue-500",children:[(0,S.jsx)(O.Z,{size:14}),"Edit Thumbnail"]}),(0,S.jsxs)("button",{onClick:h,disabled:g,className:`flex items-center gap-2 rounded px-2.5 py-1 text-sm font-medium text-white transition-all duration-200 hover:scale-105 disabled:cursor-not-allowed disabled:opacity-50 ${m.hidden?"bg-green-500/80 hover:bg-green-500":"bg-red-500/80 hover:bg-red-500"}`,children:[m.hidden?(0,S.jsx)($.Z,{size:14}):(0,S.jsx)(V.Z,{size:14}),m.hidden?"Unhide Video":"Hide Video"]})]})]}),(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("video",{ref:r,controls:!0,autoPlay:!0,muted:l,disablePictureInPicture:!0,controlsList:"nodownload",className:"block w-full rounded-none bg-black",poster:m.thumbnailUrl,onError:()=>i(!0)}),l&&(0,S.jsx)("div",{onClick:()=>c(!1),className:"absolute inset-0 z-10 flex h-full w-full cursor-pointer select-none items-center justify-center bg-black/35 text-[22px] font-semibold text-white",children:"Click to Unmute"})]}),(0,S.jsx)(si,{isOpen:d,onClose:()=>u(!1),onUpload:f,time:sh(m.startTime),isLoading:x})]}):null:null},sN=({className:e,canEdit:t})=>{let{mintId:r}=r_(),s=(0,C.useRef)(null),[n,i]=(0,C.useState)("active"),{data:a,isLoading:o,isFetching:l,error:c,fetchNextPage:d,hasNextPage:u}=so({roomName:r,limit:20,enabled:!!r,includeUserHidden:t});if((0,C.useEffect)(()=>{if(!u||!s.current)return;let e=new IntersectionObserver(([e])=>{e.isIntersecting&&!l&&d()});return e.observe(s.current),()=>e.disconnect()},[u,l,d]),c)return(0,S.jsx)("div",{className:"text-center text-red-500",children:"Error loading archived videos. Please try again later."});if(o)return(0,S.jsx)("div",{className:"flex h-32 items-center justify-center",children:(0,S.jsx)(B.Z,{className:"animate-spin"})});if(!a?.pages?.[0]?.clips?.length)return(0,S.jsx)("div",{className:"text-center text-gray-400",children:"No archived videos"});let m=a.pages.flatMap(e=>e.clips),p="all"===n?m:"active"===n?m.filter(e=>!e.hidden):m.filter(e=>e.hidden);return(0,S.jsxs)("div",{className:e,children:[t&&(0,S.jsx)(z.x7,{position:"top-right"}),(0,S.jsxs)("div",{className:"mb-2 flex items-center gap-3",children:[(0,S.jsx)("span",{className:"text-base font-semibold text-white",children:"archived videos"}),t&&(0,S.jsxs)("select",{value:n,onChange:e=>i(e.target.value),className:"rounded bg-gray-800 px-2 py-1 text-sm text-white",children:[(0,S.jsx)("option",{value:"all",children:"all"}),(0,S.jsx)("option",{value:"active",children:"active"}),(0,S.jsx)("option",{value:"hidden",children:"hidden"})]})]}),(0,S.jsx)("div",{className:"flex flex-wrap gap-4",children:p.map(e=>(0,S.jsx)(sb,{clip:e,canEdit:t},e.clipId))}),u&&(0,S.jsx)("div",{ref:s,className:"mt-4 flex h-10 w-full items-center justify-center",children:(0,S.jsx)(B.Z,{className:"animate-spin text-white"})}),!u&&(0,S.jsx)("div",{className:"mt-4 text-center text-sm text-gray-400",children:"No more archived videos"})]})},sC=({mintId:e,enabled:t,onSuccess:r})=>{let{trackEvent:s}=e7();return(0,I.a)({queryKey:["is-creator",e],queryFn:async()=>{s("common_check_approved_creator_status_attempt");let t=new URLSearchParams;t.set("mintId",e);try{let n=await ts.get(`livestream/is-approved-creator?${t.toString()}`).json();return r?.(n),s("common_check_approved_creator_status_success",{isApproved:n.isApprovedCreator,userId:e}),n}catch(r){let t=r instanceof Error?r.message:String(r);throw e8.error("[useIsApprovedCreator] Fetch failed",{mintId:e,error:t}),s("common_check_approved_creator_status_failure",{error:t,userId:e}),r}},enabled:t,select:e=>e.isApprovedCreator})},sS=({className:e})=>{let{mintId:t}=r_(),{data:r}=sC({mintId:t}),s=r&&tt.EDIT_CLIPS_ENABLED;return(0,S.jsxs)("div",{className:e,children:[(0,S.jsx)(sk,{canEdit:s}),(0,S.jsx)(sN,{canEdit:s})]})},sI=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsxs)("svg",{width:"40",height:"40",viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,S.jsx)("path",{d:"M35 20C35 28.2843 28.2843 35 20 35C11.7157 35 5 28.2843 5 20C5 11.7157 11.7157 5 20 5C28.2843 5 35 11.7157 35 20Z",stroke:"white",strokeWidth:"2"}),(0,S.jsx)("path",{d:"M24.7145 25.2859C22.111 22.6824 17.8899 22.6824 15.2864 25.2859",stroke:"white",strokeWidth:"2",strokeLinecap:"square"}),(0,S.jsx)("path",{d:"M24.5834 15.8334H24.6001M25.0001 15.8334C25.0001 16.0635 24.8135 16.2501 24.5834 16.2501C24.3533 16.2501 24.1667 16.0635 24.1667 15.8334C24.1667 15.6033 24.3533 15.4167 24.5834 15.4167C24.8135 15.4167 25.0001 15.6033 25.0001 15.8334Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round"}),(0,S.jsx)("path",{d:"M15.4167 15.8334H15.4333M15.8333 15.8334C15.8333 16.0635 15.6468 16.2501 15.4167 16.2501C15.1865 16.2501 15 16.0635 15 15.8334C15 15.6033 15.1865 15.4167 15.4167 15.4167C15.6468 15.4167 15.8333 15.6033 15.8333 15.8334Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})}),sE=({className:e,maxWidth:t})=>{let{isMobile:r}=r_();return(0,S.jsxs)("div",{className:F()(e,"bg-black","flex aspect-video w-full flex-row items-center justify-center gap-[8px] border border-gray-500",!r&&"rounded-[8px]"),style:{maxWidth:r?void 0:t},children:[(0,S.jsx)(sI,{}),(0,S.jsx)("p",{className:"max-w-[300px] text-white",children:"this stream has been removed for violating pump.fun's Terms of Service"})]})},sM=(0,C.forwardRef)(({icon:e,label:t,className:r,disabled:s,...n},i)=>(0,S.jsx)("button",{ref:i,"aria-label":t,disabled:s,className:F()("flex items-center justify-center rounded-lg p-1","text-white transition-colors duration-150",s&&"cursor-not-allowed opacity-50",!s&&"hover:bg-white/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-opacity-75",r),type:"button",...n,children:e}));sM.displayName="IconButton";var sT={side:"top",align:"center",sideOffset:4,delayDuration:0},s_={ModerationDialog:{content:120,overlay:110},ModerationQueueMedia:{bottomOverlay:20,topOverlay:20,content:10},BlurDialog:{content:30,title:10,footer:10},LiveKitRoom:{noControlsLiveIndicator:10,reactionsViewer:10},MiniView:{content:21,rnd:21},Controls:{bottom:19,top:19},ReactionsPopover:{content:25},Selector:{content:120},ParticipantsDialog:{content:50},AudioInteractionOverlay:{content:40},ParticipantVideoTile:{gradientOverlay:10},MainVideoView:{screenshareVideoTile:10},Tooltip:{content:50}},sL=({children:e,content:t,side:r=sT.side,align:s=sT.align,sideOffset:n=sT.sideOffset,delayDuration:i=sT.delayDuration,className:a})=>{let o=Array.isArray(e)?e[0]:e;return t?(0,S.jsxs)(k.fC,{delayDuration:i,children:[(0,S.jsx)(k.xz,{asChild:!0,children:o}),(0,S.jsx)(k.h_,{children:(0,S.jsxs)(k.VY,{side:r,align:s,sideOffset:n,className:F()(a,"rounded bg-gray-900 px-2.5 py-1.5 text-xs font-semibold text-white shadow-md","will-change-[transform,opacity]"),style:{zIndex:s_.Tooltip.content},onPointerDownOutside:e=>{e.target instanceof Element&&e.target.closest("[data-radix-collection-item]")&&e.preventDefault()},children:[t,(0,S.jsx)(k.Eh,{className:"fill-gray-900"})]})})]}):o},sA=({icon:e,tooltipContent:t,tooltipSide:r=sT.side,tooltipAlign:s=sT.align,tooltipSideOffset:n=sT.sideOffset,tooltipDelayDuration:i=sT.delayDuration,...a})=>{let o="string"==typeof t?t:"Icon button";return(0,S.jsx)(sL,{content:t,side:r,align:s,sideOffset:n,delayDuration:i,children:(0,S.jsx)(sM,{icon:e,label:o,...a})})},sP=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M6 13V18H11M13 6H18V11",stroke:"#F8FAFC",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),sR=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M5 14H10V19M14 5V10H19",stroke:"#F8FAFC",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),sD=()=>{let e=(0,Z.K)(),{localParticipant:t}=(0,Z.C)();return(0,C.useMemo)(()=>{let r,s;let n=[],i=[],a=[];return e.forEach(e=>{let o=rj(e),l=e.identity===t?.identity,c={displayName:rk(e),participant:e,isCurrentUser:l,metadataObject:o};if(e.kind===rf.AGENT){a.push(c);return}if(e.kind===rf.INGRESS){s=c;return}switch(c.metadataObject?.role){case"host":r=c;break;case"co-host":n.push(c);break;default:i.push(c)}}),n.sort((e,t)=>e.participant.identity.localeCompare(t.participant.identity)),i.sort((e,t)=>{let r=e.metadataObject?.hand_raised??!1;return r!==(t.metadataObject?.hand_raised??!1)?r?-1:1:e.participant.identity.localeCompare(t.participant.identity)}),{host:r,ingress:s,coHosts:n,viewers:i,aiModerators:a}},[e,t])},sF=()=>{let{host:e,coHosts:t,viewers:r}=sD(),{localParticipant:s}=(0,Z.C)(),n=[...e?[e]:[],...t,...r].find(e=>e.participant.identity===s.identity),i=n?.metadataObject??{},a=i?.role,o=!!i?.invited_to_stage,l="host"===a,c="co-host"===a;return{metadataObject:i,role:a,isInvited:o,isHost:l,isCoHost:c,isViewer:!l&&!c}},sU="pinning-v1",sB=({onGlobalPinsReceived:e,isHost:t})=>{let{localParticipant:r}=(0,Z.C)(),s=(0,C.useRef)(!1),n=(0,C.useCallback)(s=>{if(s.topic===sU&&s.from&&s.from.identity!==r?.identity&&!t)try{let t=new TextDecoder().decode(s.payload),r=JSON.parse(t);Array.isArray(r)?(e8.debug("[usePinningDataChannel] Received remote global pins",{from:s.from.identity,count:r.length}),e?.(r)):e8.warn("[usePinningDataChannel] Received data that is not an array of BroadcastPins",{payload:r})}catch(e){e8.error("[usePinningDataChannel] Error processing incoming global pins data",{error:e instanceof Error?e.message:String(e)})}},[r,e,t]),{send:i,isSending:a}=(0,Z.E)(sU,n);return(0,C.useEffect)(()=>{s.current=a},[a]),{sendGlobalPins:(0,C.useCallback)(async e=>{if(!t){e8.warn("[usePinningDataChannel] Attempted to send global pins from non-host client.");return}if(s.current&&a){e8.warn("[usePinningDataChannel] Already sending, skipping new sendGlobalPins request.");return}try{let t=new TextEncoder().encode(JSON.stringify(e));e8.debug("[usePinningDataChannel] Sending global pins",{count:e.length}),await i(t,{reliable:!0})}catch(e){e8.error("[usePinningDataChannel] Error sending global pins",{error:e instanceof Error?e.message:String(e)})}},[i,t,a])}},sO=((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of eX(t))e1.call(e,n)||n===r||eJ(e,n,{get:()=>t[n],enumerable:!(s=eY(t,n))||s.enumerable});return e})(eJ(null!=(i=e2())?eK(e0(i)):{},"default",{value:i,enumerable:!0}),i);M.TQ.ConnectionStateChanged,M.TQ.RoomMetadataChanged,M.TQ.ActiveSpeakersChanged,M.TQ.ConnectionQualityChanged,M.TQ.ParticipantConnected,M.TQ.ParticipantDisconnected,M.TQ.ParticipantPermissionsChanged,M.TQ.ParticipantMetadataChanged,M.TQ.ParticipantNameChanged,M.TQ.ParticipantAttributesChanged,M.TQ.TrackMuted,M.TQ.TrackUnmuted,M.TQ.TrackPublished,M.TQ.TrackUnpublished,M.TQ.TrackStreamStateChanged,M.TQ.TrackSubscriptionFailed,M.TQ.TrackSubscriptionPermissionChanged,M.TQ.TrackSubscriptionStatusChanged,M.TQ.LocalTrackPublished,M.TQ.LocalTrackUnpublished,M.dd.TrackPublished,M.dd.TrackUnpublished,M.dd.TrackMuted,M.dd.TrackUnmuted,M.dd.TrackStreamStateChanged,M.dd.TrackSubscribed,M.dd.TrackUnsubscribed,M.dd.TrackSubscriptionPermissionChanged,M.dd.TrackSubscriptionFailed,M.dd.LocalTrackPublished,M.dd.LocalTrackUnpublished,M.dd.ConnectionQualityChanged,M.dd.IsSpeakingChanged,M.dd.ParticipantMetadataChanged,M.dd.ParticipantPermissionsChanged,M.dd.TrackMuted,M.dd.TrackUnmuted,M.dd.TrackPublished,M.dd.TrackUnpublished,M.dd.TrackStreamStateChanged,M.dd.TrackSubscriptionFailed,M.dd.TrackSubscriptionPermissionChanged,M.dd.TrackSubscriptionStatusChanged,M.dd.LocalTrackPublished,M.dd.LocalTrackUnpublished;var s$=sO.default.getLogger("lk-components-js");s$.setDefaultLevel("WARN");var{load:sV,save:sq}=(u="lk-user-choices",{load:()=>(function(e){if("undefined"==typeof localStorage){s$.error("Local storage is not available.");return}try{let t=localStorage.getItem(e);if(!t){s$.warn(`Item with key ${e} does not exist in local storage.`);return}return JSON.parse(t)}catch(e){s$.error(`Error getting item from local storage: ${e}`);return}})(u),save:e=>(function(e,t){if("undefined"==typeof localStorage){s$.error("Local storage is not available.");return}try{if(t){let r=Object.fromEntries(Object.entries(t).filter(([,e])=>""!==e));localStorage.setItem(e,JSON.stringify(r))}}catch(e){s$.error(`Error setting item to local storage: ${e}`)}})(u,e)});function sH(e){return[e.localParticipant,...Array.from(e.remoteParticipants.values())].filter(Boolean).filter(rS)}var sQ=new WeakMap,sz=({isHost:e})=>{let[t,r]=(0,C.useState)([]),[s,n]=(0,C.useState)([]),[i,a]=(0,C.useState)([]),o=sB({isHost:e,onGlobalPinsReceived:t=>{e||(e8.debug("[useMultiPinState] Viewer received global pins from broadcast",{count:t.length}),r(t))}}),{allTracks:l}=function(){let e=(0,W.f)(),[t,r]=(0,C.useState)([]),s=(0,C.useMemo)(()=>t.filter(e=>e.source===M.fQ.Source.Camera),[t]),n=(0,C.useMemo)(()=>t.filter(e=>e.source===M.fQ.Source.Microphone),[t]),i=(0,C.useMemo)(()=>t.filter(e=>e.source===M.fQ.Source.ScreenShare),[t]);return(0,C.useEffect)(()=>{if(!e)return;let t=(function(e){if(!e)throw Error("getHostCoHostObservable: room is undefined");let t=sQ.get(e);if(!t){let r;t=new K.y(t=>(t.next(sH(e)),r=(function(e,...t){return new K.y(r=>{let s=()=>{r.next(e)};return t.forEach(t=>{e.on(t,s)}),()=>{t.forEach(t=>{e.off(t,s)})}}).pipe((0,J.O)(e))})(e,M.TQ.TrackPublished,M.TQ.TrackUnpublished,M.TQ.LocalTrackPublished,M.TQ.LocalTrackUnpublished,M.TQ.TrackSubscribed,M.TQ.TrackUnsubscribed,M.TQ.TrackMuted,M.TQ.TrackUnmuted,M.TQ.ParticipantMetadataChanged).subscribe(()=>{t.next(sH(e))}),()=>r?.unsubscribe())).pipe((0,Y.d)({bufferSize:1,refCount:!0})),sQ.set(e,t)}return t})(e).subscribe(e=>{try{let t=[];e.forEach(e=>{e.getTrackPublications().forEach(r=>{t.push({participant:e,publication:r,source:r.source,isMuted:r.isMuted})})}),r(t)}catch(e){e8.error("useObserveTracks: failed to build track list",{error:e instanceof Error?e.message:String(e)})}});return()=>t.unsubscribe()},[e]),{allTracks:t,cameraTracks:s,microphoneTracks:n,screenShareTracks:i}}(),c=(0,C.useCallback)(t=>{if((0,W.a1)(t)&&t.publication){let s={trackSid:t.publication.trackSid,participantIdentity:t.participant.identity,source:t.source};r(t=>{if(t.find(e=>e.trackSid===s.trackSid))return t;let r=[...t,s];return e&&(e8.debug("[useMultiPinState] Host adding pin, sending global pins",{newPin:s,updatedPinsCount:r.length}),o.sendGlobalPins(r)),r})}else e8.warn("[useMultiPinState] addGlobalPin skipped: TrackReference is a placeholder or has no publication",{trackRef:t})},[e,o]),d=(0,C.useCallback)(t=>{r(r=>{let s=r.filter(e=>e.trackSid!==t);return s.length!==r.length?(e&&(e8.debug("[useMultiPinState] Host removing pin, sending global pins",{trackSid:t,updatedPinsCount:s.length}),o.sendGlobalPins(s)),s):r})},[e,o]),u=(0,C.useCallback)(t=>{e?e8.warn("[useMultiPinState] Host attempted to setGlobalPinsFromBroadcast, should not happen."):(e8.debug("[useMultiPinState] Viewer explicitly setting global pins from broadcast",{count:t.length}),r(t))},[e]),m=(0,C.useCallback)(e=>{if((0,W.a1)(e)&&e.publication){let t={trackSid:e.publication.trackSid,participantIdentity:e.participant.identity,source:e.source};n(e=>e.find(e=>e.trackSid===t.trackSid)?e:[...e,t]),a(e=>e.filter(e=>e!==t.trackSid))}else e8.warn("[useMultiPinState] addLocalPin skipped: Invalid trackRef")},[]),p=(0,C.useCallback)(e=>{n(t=>t.filter(t=>t.trackSid!==e))},[]),h=(0,C.useCallback)(e=>{a(t=>t.includes(e)?t:[...t,e]),n(t=>t.filter(t=>t.trackSid!==e))},[]),g=(0,C.useCallback)(e=>{a(t=>t.filter(t=>t!==e))},[]),f=(0,C.useMemo)(()=>{let e=[],r=new Set;return t.forEach(t=>{if(!i.includes(t.trackSid)&&!s.some(e=>e.trackSid===t.trackSid)){let s=l.find(e=>e.publication?.trackSid===t.trackSid);s&&(e.push(s),r.add(t.trackSid))}}),s.forEach(t=>{if(!r.has(t.trackSid)){let s=l.find(e=>e.publication?.trackSid===t.trackSid);s&&(e.push(s),r.add(t.trackSid))}}),e8.debug("[useMultiPinState] Recalculated effectivePins",{globalPinsCount:t.length,localPinsCount:s.length,localUnpinsCount:i.length,allTracksCount:l.length,resolvedEffectivePinsCount:e.length}),e},[t,s,i,l]);return(0,C.useMemo)(()=>({globalPins:t,effectivePins:f,addGlobalPin:c,removeGlobalPin:d,setGlobalPinsFromBroadcast:u,localPins:s,localUnpins:i,addLocalPin:m,removeLocalPin:p,addLocalUnpin:h,removeLocalUnpin:g}),[t,f,c,d,u,s,i,m,p,h,g])},sG=(0,C.createContext)(void 0),sZ=({children:e,showHostCameraOverlay:t,showParticipantRow:r=!0,showMainNameOverlay:s=!0,allowParticipantControls:n=!0,showViewerParticipationControls:i=!0,showHostRaiseHandIndicator:a=!0})=>{let{isHost:o}=sF(),{globalPins:l,effectivePins:c,addGlobalPin:d,removeGlobalPin:u,setGlobalPinsFromBroadcast:m,localPins:p,localUnpins:h,addLocalPin:g,removeLocalPin:f,addLocalUnpin:x,removeLocalUnpin:v}=sz({isHost:o}),[b,y]=(0,C.useState)(!1),[w,j]=(0,C.useState)(null),[k,N]=(0,C.useState)(1),{value:I,toggleValue:E,setFalse:M}=su(!1),T=(0,C.useMemo)(()=>({globalPins:l,effectivePins:c,addGlobalPin:d,removeGlobalPin:u,setGlobalPinsFromBroadcast:m,localPins:p,localUnpins:h,addLocalPin:g,removeLocalPin:f,addLocalUnpin:x,removeLocalUnpin:v,fullScreen:b,setFullScreen:y,audioMuted:I,unmuteAudio:M,toggleMute:E,rtmpCredentials:w,setRtmpCredentials:j,showParticipantRow:r,showMainNameOverlay:s,allowParticipantControls:n,showViewerParticipationControls:i,showHostRaiseHandIndicator:a,showHostCameraOverlay:t,volume:k,setVolume:N,isHost:o}),[l,c,d,u,m,p,h,g,f,x,v,b,I,M,E,w,r,s,n,i,a,t,k,N,o]);return(0,S.jsx)(sG.Provider,{value:T,children:e})};function sW(){let e=(0,C.useContext)(sG);if(void 0===e)throw Error("useLivestreamFeaturesContext must be used within a LivestreamFeaturesProvider");return e}var sK=({className:e})=>{let{roomRef:t}=r_(),{fullScreen:r,setFullScreen:s}=sW();return(0,C.useEffect)(()=>{let e=()=>{s(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[s]),(0,S.jsx)(sA,{tooltipContent:r?"exit fullscreen":"enter fullscreen",icon:r?(0,S.jsx)(sR,{}):(0,S.jsx)(sP,{}),onClick:()=>{document.fullscreenElement?document.exitFullscreen():t.current?.requestFullscreen()},className:e})},sJ=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)(X.Z,{className:"text-white"})}),sY=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M19.071 4.92969C20.8807 6.73933 22 9.23933 22 12.0008C22 14.7622 20.8807 17.2622 19.071 19.0718M15.8891 8.11133C16.8844 9.10663 17.5 10.4816 17.5 12.0004C17.5 13.5192 16.8844 14.8942 15.8891 15.8895M2 8H6L12 4V20L6 16H2V8Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),sX=({audioMuted:e,toggleMute:t,className:r})=>(0,S.jsx)(sA,{tooltipContent:e?"unmute":"mute",icon:e?(0,S.jsx)(sJ,{}):(0,S.jsx)(sY,{}),onClick:t,className:r}),s0="bg-[#1B1D27]/60 backdrop-blur-[12px]",s1=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,S.jsx)("path",{d:"M5 4H9V20H5V4Z",stroke:"#F8FAFC",strokeWidth:"2"}),(0,S.jsx)("path",{d:"M15 4H19V20H15V4Z",stroke:"#F8FAFC",strokeWidth:"2"})]})}),s2=(0,_.U)(e=>({isOpen:!1,openDialog:(t,...r)=>{e({isOpen:!0,dialogType:t,payload:r[0]})},closeDialog:()=>{e({isOpen:!1,dialogType:void 0,payload:void 0})},dialogType:void 0,payload:void 0})),s4=()=>{let{openDialog:e}=s2();return(0,S.jsx)("div",{className:F()("cursor-pointer rounded-xl p-2 hover:!bg-white/20",s0),onClick:()=>e("end-stream"),children:(0,S.jsx)(s1,{})})},s3=e=>rI(t=>t.livestreamsByMintId[e]??null),s5=({livestreamId:e,mintId:t,onSuccess:r,onError:s,onSettled:n})=>{let{localParticipant:i}=(0,Z.C)(),{trackEvent:a}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useRemoveSelfFromStage] Attempting to remove self from stage via API",{livestreamId:e,mintId:t,localIdentity:i.identity})},mutationFn:async()=>{if(!i?.identity)throw Error("Local participant identity not available for remove self");return ts.post("livestream/participant/remove-from-stage",{json:{livestreamId:e,mintId:t,identity:i.identity}}).json()},onSuccess:s=>{a("livestream_stage_remove_participant_success",{self:!0,removedUserId:i?.identity,mintId:t}),e8.debug("[useRemoveSelfFromStage] Successfully removed self from stage",{livestreamId:e,localIdentity:i?.identity}),r?.(s)},onError:r=>{let n=r.message||"Unknown error during remove self from stage";a("livestream_stage_remove_participant_failure",{error:n,self:!0,removedUserId:i?.identity,mintId:t}),e8.error("[useRemoveSelfFromStage] Failed to remove self from stage",{livestreamId:e,localIdentity:i?.identity,error:n}),s?.(r)},onSettled:n})},s6=()=>{let{mintId:e}=r_(),t=s3(e),{mutate:r,isPending:s}=s5({livestreamId:t?.id??0,mintId:t?.mintId??""});return(0,S.jsx)("button",{onClick:()=>{s||r()},disabled:s,className:F()("cursor-pointer rounded-xl p-2 text-white hover:!bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/20 disabled:opacity-50",s0),title:"leave stage",children:(0,S.jsx)(ee.Z,{className:"h-6 w-6"})})},s8=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M13.3333 4L5.99996 11.3333L2.66663 8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),s7=(e,t)=>e.length<=t?e:e.slice(0,t)+"...",s9=({value:e,label:t,selected:r})=>(0,S.jsx)(er.ck,{value:e,className:F()("flex h-8 cursor-pointer items-center rounded-md px-4 py-3 text-sm outline-none hover:bg-white/20","data-[state=checked]:text-livestream-green"),children:(0,S.jsxs)("div",{className:F()("flex items-center gap-2"),children:[(0,S.jsx)("div",{children:r?(0,S.jsx)(s8,{}):(0,S.jsx)("div",{className:"w-4"})}),(0,S.jsx)(er.eT,{className:"truncate",children:s7(t,25)})]})}),ne=({className:e,direction:t="down"})=>(0,S.jsx)("div",{className:F()(e,"up"===t&&"rotate-180","left"===t&&"rotate-90","right"===t&&"-rotate-90"),children:(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M8 10L11.2929 13.2929C11.6834 13.6834 12.3166 13.6834 12.7071 13.2929L16 10",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),nt=(0,C.forwardRef)(({selectedValue:e,onOpenChange:t,onValueChange:r,options:s,renderInPortal:n=!1,showSelectedValue:i,openDirection:a="bottom",openOffset:o=15,icon:l,title:c,footer:d,triggerClassName:u,...m},p)=>{let[h,g]=(0,C.useState)(!1),f=(0,C.useMemo)(()=>s.find(t=>t.value===e),[s,e]),x=(0,C.useCallback)(e=>{g(e),t?.(e)},[t]),v=(0,C.useMemo)(()=>h?"top"===a?"down":"up":"top"===a?"up":"down",[h,a]),b=(0,C.useRef)(null),y=l||(0,S.jsx)(ne,{direction:v}),w=c||"Open selector";return(0,S.jsxs)(er.fC,{value:e,onValueChange:r,onOpenChange:x,children:[(0,S.jsxs)(er.xz,{ref:p,"aria-label":w,className:F()("flex items-center","bg-transparent text-white focus:outline-none",u),...m,children:[i?.show&&f&&(0,S.jsx)("div",{className:"flex items-center overflow-hidden",children:(0,S.jsx)("p",{className:F()("truncate text-[14px] leading-[18px]",i?.className),children:f?.label})}),(0,S.jsx)(er.JO,{children:y})]}),n?(0,S.jsx)("div",{ref:b,children:(0,S.jsx)(er.h_,{container:b.current,children:(0,S.jsxs)(er.VY,{side:"top"===a?"top":"bottom",position:"popper",sideOffset:o,className:F()("-translate-x-2 overflow-hidden rounded-xl p-2 text-white shadow-lg","bg-[#1B1D27]/80",s0),style:{zIndex:s_.Selector.content},children:[c&&(0,S.jsx)("p",{className:"p-1 text-xs text-white",children:c}),s.map((t,r)=>(0,S.jsx)(s9,{value:t.value,label:t.label,selected:e===t.value},r)),d]})})}):(0,S.jsx)(er.h_,{children:(0,S.jsxs)(er.VY,{side:"top"===a?"top":"bottom",position:"popper",sideOffset:o,className:F()("-translate-x-2 overflow-hidden rounded-xl p-2 text-white shadow-lg",s0),style:{zIndex:s_.Selector.content},children:[c&&(0,S.jsx)("p",{className:"p-1 text-xs text-white",children:c}),s.map((t,r)=>(0,S.jsx)(s9,{value:t.value,label:t.label,selected:e===t.value},r)),d]})})]})});nt.displayName="Selector";var nr=({activeDeviceId:e,setActiveMediaDevice:t,devices:r})=>(0,S.jsx)(nt,{selectedValue:e,onValueChange:t,options:r.map(e=>({label:e.label,value:e.deviceId})),showSelectedValue:{show:!0,className:"!max-w-[200px] mr-2"},openDirection:"bottom",openOffset:5}),ns=({activeDeviceId:e,setActiveMediaDevice:t,devices:r,onOpenChange:s})=>{let{fullScreen:n}=sW(),i=(0,C.useMemo)(()=>r.map(e=>({label:e.label,value:e.deviceId})),[r]);return(0,S.jsx)(nt,{selectedValue:e,onValueChange:t,options:i,onOpenChange:s,openDirection:"top",renderInPortal:n})},nn=({room:e})=>{let[t,r]=(0,C.useState)(!1),{trackEvent:s}=e7();(0,C.useEffect)(()=>{let t=e?.localParticipant;if(t){let e=t.permissions;r(e?.canPublish??!1),e8.info("useDeviceManagement initialized for participant",{participantSid:t.sid,canPublish:e?.canPublish??!1});let s=()=>{let e=t.permissions?.canPublish??!1;r(e),e8.info("Participant permissions changed",{participantSid:t.sid,canPublish:e})};return t.on(M.dd.ParticipantPermissionsChanged,s),()=>{t.off(M.dd.ParticipantPermissionsChanged,s)}}r(!1)},[e,e?.localParticipant]);let n=(0,C.useMemo)(()=>!e||t,[e,t]),i=(0,Z.e)({kind:"audioinput",requestPermissions:n,room:e??void 0}),a=(0,Z.e)({kind:"videoinput",requestPermissions:n,room:e??void 0}),o=(0,Z.x)(),l=i.devices.filter(e=>""!==e.deviceId),c=a.devices.filter(e=>""!==e.deviceId),d=i.activeDeviceId&&""!==i.activeDeviceId?i.activeDeviceId:"default",u=a.activeDeviceId&&""!==a.activeDeviceId?a.activeDeviceId:"default",m=(0,C.useRef)({audio:!1,video:!1});return(0,C.useEffect)(()=>{if(!m.current.audio&&i.devices.length>0){let e=o.userChoices.audioDeviceId;e8.debug("Attempting to restore audio device",{savedId:e}),e&&"default"!==e&&e!==i.activeDeviceId&&i.devices.some(t=>t.deviceId===e)&&i.setActiveMediaDevice(e).then(()=>{o.saveAudioInputDeviceId(e),e8.info("Successfully restored audio device",{deviceId:e}),s("livekit_media_device_changed",{deviceType:"audioInput",deviceId:e})}).catch(t=>e8.error("Error restoring audio device",{error:t,deviceId:e})),m.current.audio=!0}if(!m.current.video&&a.devices.length>0){let e=o.userChoices.videoDeviceId;e8.debug("Attempting to restore video device",{savedId:e}),e&&"default"!==e&&e!==a.activeDeviceId&&a.devices.some(t=>t.deviceId===e)&&a.setActiveMediaDevice(e).then(()=>{o.saveVideoInputDeviceId(e),e8.info("Successfully restored video device",{deviceId:e}),s("livekit_media_device_changed",{deviceType:"videoInput",deviceId:e})}).catch(t=>e8.error("Error restoring video device",{error:t,deviceId:e})),m.current.video=!0}},[i.devices,a.devices,i.activeDeviceId,a.activeDeviceId,o.userChoices.audioDeviceId,o.userChoices.videoDeviceId,i.setActiveMediaDevice,a.setActiveMediaDevice,o.saveAudioInputDeviceId,o.saveVideoInputDeviceId,i,o,a,s]),{audioInputDevices:l,videoInputDevices:c,audioDeviceId:d,videoDeviceId:u,audioSetActiveMediaDevice:i.setActiveMediaDevice,videoSetActiveMediaDevice:a.setActiveMediaDevice,saveAudioInputDeviceId:o.saveAudioInputDeviceId,saveVideoInputDeviceId:o.saveVideoInputDeviceId}},ni=({room:e,audioSetActiveMediaDevice:t,videoSetActiveMediaDevice:r,saveAudioInputDeviceId:s,saveVideoInputDeviceId:n})=>{let{trackEvent:i}=e7();return{handleSetAudioDevice:async r=>{try{if(e?.state===M.em.Connected)try{e8.debug("[useDeviceSelectionHandlers] Attempting audio switch via room.switchActiveDevice",{deviceId:r}),await e.switchActiveDevice("audioinput",r),i("livekit_media_device_changed",{deviceType:"audioInput",deviceId:r})}catch(t){let e=t instanceof Error?t.message:String(t);e8.error("[useDeviceSelectionHandlers] In-Stream: Failed to switch audio device",{deviceId:r,error:e}),i("livekit_media_device_change_failure",{deviceType:"audioInput",deviceId:r,error:e})}else e8.debug("[useDeviceSelectionHandlers] Attempting audio switch via audioSetActiveMediaDevice (not connected)",{deviceId:r}),await t(r),i("livekit_media_device_changed",{deviceType:"audioInput",deviceId:r});s(r)}catch(t){let e=t instanceof Error?t.message:String(t);e8.error("[useDeviceSelectionHandlers] Error setting audio device",{deviceId:r,error:e}),i("livekit_media_device_change_failure",{deviceType:"audioInput",deviceId:r,error:e})}},handleSetVideoDevice:async t=>{try{if(e?.state===M.em.Connected)try{e8.debug("[useDeviceSelectionHandlers] Attempting video switch via room.switchActiveDevice",{deviceId:t}),await e.switchActiveDevice("videoinput",t),i("livekit_media_device_changed",{deviceType:"videoInput",deviceId:t})}catch(r){let e=r instanceof Error?r.message:String(r);e8.error("[useDeviceSelectionHandlers] In-Stream: Failed to switch video device",{deviceId:t,error:e}),i("livekit_media_device_change_failure",{deviceType:"videoInput",deviceId:t,error:e})}else e8.debug("[useDeviceSelectionHandlers] Attempting video switch via videoSetActiveMediaDevice (not in room)",{deviceId:t}),await r(t),i("livekit_media_device_changed",{deviceType:"videoInput",deviceId:t});n(t)}catch(r){let e=r instanceof Error?r.message:String(r);e8.error("[useDeviceSelectionHandlers] Error setting video device",{deviceId:t,error:e}),i("livekit_media_device_change_failure",{deviceType:"videoInput",deviceId:t,error:e})}}}},na=(0,C.createContext)(void 0),no=({children:e})=>{let t=(0,W.w)(),{audioInputDevices:r,videoInputDevices:s,audioDeviceId:n,videoDeviceId:i,audioSetActiveMediaDevice:a,videoSetActiveMediaDevice:o,saveAudioInputDeviceId:l,saveVideoInputDeviceId:c}=nn({room:t}),{handleSetAudioDevice:d,handleSetVideoDevice:u}=ni({room:t,audioSetActiveMediaDevice:a,videoSetActiveMediaDevice:o,saveAudioInputDeviceId:l,saveVideoInputDeviceId:c}),m=(0,C.useMemo)(()=>({audioInputDevices:r,videoInputDevices:s,audioDeviceId:n,videoDeviceId:i,handleSetAudioDevice:d,handleSetVideoDevice:u}),[r,s,n,i,d,u]);return(0,S.jsx)(na.Provider,{value:m,children:e})},nl=()=>{let e=(0,C.useContext)(na);if(void 0===e)throw Error("useDeviceSelectionContext must be used within a DeviceSelectionProvider");return e},nc=({isBackstage:e=!1,onOpenChange:t})=>{let{audioInputDevices:r,audioDeviceId:s,handleSetAudioDevice:n}=nl();return e?(0,S.jsx)(nr,{activeDeviceId:s,setActiveMediaDevice:n,devices:r}):(0,S.jsx)(ns,{activeDeviceId:s,setActiveMediaDevice:n,devices:r,onOpenChange:t})},nd=e=>{let{localParticipant:t}=(0,Z.C)(),r=(0,C.useRef)(null),s=(0,C.useRef)(null);(0,C.useEffect)(()=>{if(!t)return;let n=t.getTrackPublication(e);n&&nm(n,s,r);let i=t=>{t.source===e&&t instanceof M.Zr&&nm(t,s,r)};return t.on(M.dd.TrackPublished,i),()=>{s.current&&r.current&&s.current.off(M.vN.Muted,r.current),t.off(M.dd.TrackPublished,i),s.current=null,r.current=null}},[t,e])},nu=e=>{e?.track&&(e8.debug("[useMediaTrackMute] Track muted, stopping underlying MediaStreamTrack",{source:e.source,trackSid:e.trackSid,trackName:e.trackName}),e.track.stop())},nm=(e,t,r)=>{e8.debug("[useMediaTrackMute:setupNewListener] Setting up mute listener",{source:e.source,trackSid:e.trackSid,initialIsMuted:e.isMuted});let s=()=>nu(e);t.current&&r.current&&(e8.debug("[useMediaTrackMute:setupNewListener] Removing old listener",{oldTrackSid:t.current.trackSid}),t.current.off(M.vN.Muted,r.current)),e.on(M.vN.Muted,s),t.current=e,r.current=s,e.isMuted&&(e8.debug("[useMediaTrackMute:setupNewListener] Track initially muted, calling handleMuted",{trackSid:e.trackSid}),nu(e))},np=({className:e,size:t=24})=>(0,S.jsx)("div",{className:e,style:{width:t,height:t},children:(0,S.jsx)("svg",{width:"100%",height:"100%",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M12 21V19.5M5.01434 15C6.14683 16.7451 8.32179 19 12 19C13.9581 19 15.4902 18.361 16.6658 17.5M9.51896 3.86222C10.2008 3.32235 11.0628 3 12 3C14.2092 3 16 4.79086 16 7V10.3433M3 3L21 21M8 8.75L8.00001 11C8.00001 13.2091 9.79087 15 12 15C12.638 15 13.2411 14.8506 13.7762 14.585",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"square"})})}),nh=({className:e,size:t=24})=>(0,S.jsx)("div",{className:e,style:{width:t,height:t},children:(0,S.jsx)("svg",{width:"100%",height:"100%",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M12.0001 19V21M12.0001 19C8.32185 19 6.14689 16.7451 5.0144 15M12.0001 19C15.6783 19 17.8533 16.7451 18.9857 15M16.0001 7V11C16.0001 13.2091 14.2092 15 12.0001 15C9.79093 15 8.00007 13.2091 8.00007 11V7C8.00007 4.79086 9.79093 3 12.0001 3C14.2092 3 16.0001 4.79086 16.0001 7Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"square"})})}),ng=({audioEnabled:e,setAudioEnabled:t,setForceShowControls:r,disabled:s,disabledTooltip:n})=>(nd(M.fQ.Source.Microphone),(0,S.jsx)(sL,{content:s?n:void 0,children:(0,S.jsx)("div",{className:F()("flex items-center rounded-xl","text-white",s&&"cursor-not-allowed opacity-70",s0),children:(0,S.jsxs)("div",{className:F()("flex items-center",s&&"pointer-events-none"),children:[(0,S.jsx)(et.T,{showIcon:!1,initialState:e,source:M.fQ.Source.Microphone,onChange:t,className:"flex !rounded-l-xl !p-2 hover:!bg-white/20",children:(0,S.jsx)(nf,{audioEnabled:e})}),(0,S.jsx)("div",{className:"rounded-r-xl border-l border-white/20 p-2 hover:bg-white/20",children:(0,S.jsx)(nc,{onOpenChange:r})})]})})})),nf=({audioEnabled:e,setAudioEnabled:t})=>(0,S.jsx)("div",{className:"cursor-pointer",onClick:()=>{t&&t(!e)},children:e?(0,S.jsx)(nh,{}):(0,S.jsx)(np,{})}),nx=({isHost:e,localParticipant:t,activeScreenSharer:r,canShare:s})=>{let{openDialog:n}=s2(),{trackEvent:i}=e7(),a=t.isScreenShareEnabled,o=!s||!e&&!!r,l=(0,C.useMemo)(()=>o&&!e&&r?"only one person at a time can screenshare":null,[o,e,r]);return{isSharing:a,isDisabled:o,tooltipContent:l,handleClick:()=>{if(e&&r&&!a)e8.debug("[useScreenShareToggle] Host opening takeover dialog for screen share",{activeScreenSharerId:r.identity}),n("host-takeover-screenshare",{participantToStop:r});else if(s&&(!r||e||a)){let e=!a;t.setScreenShareEnabled(e),i("livekit_screenshare_toggled",{enabled:e})}else e8.warn("[useScreenShareToggle] Screen share toggle blocked",{isHost:e,isSharing:a,canShare:s,hasActiveSharer:!!r})}}},nv=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M9 11.25L12 8.25L15 11.25M12 15.75V9.5M4.75 19.25H19.25C20.3546 19.25 21.25 18.3546 21.25 17.25V6.75C21.25 5.64543 20.3546 4.75 19.25 4.75H4.75C3.64543 4.75 2.75 5.64543 2.75 6.75V17.25C2.75 18.3546 3.64543 19.25 4.75 19.25Z",stroke:"#F8FAFC",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),nb=({className:e,style:t})=>(0,S.jsx)("div",{className:e,style:t,children:(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M9 11.25L12 8.25L15 11.25M12 15.75V9.5M4.75 19.25H19.25C20.3546 19.25 21.25 18.3546 21.25 17.25V6.75C21.25 5.64543 20.3546 4.75 19.25 4.75H4.75C3.64543 4.75 2.75 5.64543 2.75 6.75V17.25C2.75 18.3546 3.64543 19.25 4.75 19.25Z",stroke:"#87EFAC",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),ny=e=>{let{isSharing:t,isDisabled:r,tooltipContent:s,handleClick:n}=nx(e),i=(0,S.jsx)("button",{type:"button",onClick:n,disabled:r,className:F()("cursor-pointer rounded-xl p-2 text-white hover:!bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/20 disabled:cursor-not-allowed disabled:opacity-50",s0),"aria-label":t?"stop sharing screen":"start sharing screen",children:t?(0,S.jsx)(nb,{}):(0,S.jsx)(nv,{})});return s?(0,S.jsx)(sL,{content:s,children:i}):i},nw=({isBackstage:e=!1,onOpenChange:t})=>{let{videoInputDevices:r,videoDeviceId:s,handleSetVideoDevice:n}=nl();return e?(0,S.jsx)(nr,{activeDeviceId:s,setActiveMediaDevice:n,devices:r}):(0,S.jsx)(ns,{activeDeviceId:s,setActiveMediaDevice:n,devices:r,onOpenChange:t})},nj=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M15.25 12V10L19.8028 7.72361C20.4677 7.39116 21.25 7.87465 21.25 8.61803V15.382C21.25 16.1253 20.4677 16.6088 19.8028 16.2764L15.25 14V12ZM15.25 12V6.75C15.25 5.64543 14.3546 4.75 13.25 4.75H7.75M3.54608 5.1528C3.06253 5.51786 2.75 6.09743 2.75 6.75V17.25C2.75 18.3546 3.64543 19.25 4.75 19.25H13.25C13.6459 19.25 14.0149 19.135 14.3255 18.9365M2 3L16.5 21.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),nk=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,S.jsx)("path",{d:"M2.75 6.75C2.75 5.64543 3.64543 4.75 4.75 4.75H13.25C14.3546 4.75 15.25 5.64543 15.25 6.75V17.25C15.25 18.3546 14.3546 19.25 13.25 19.25H4.75C3.64543 19.25 2.75 18.3546 2.75 17.25V6.75Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),(0,S.jsx)("path",{d:"M15.25 10L19.8028 7.72361C20.4677 7.39116 21.25 7.87465 21.25 8.61803V15.382C21.25 16.1253 20.4677 16.6088 19.8028 16.2764L15.25 14V10Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"})]})}),nN=({videoEnabled:e,setVideoEnabled:t,setForceShowControls:r,disabled:s,disabledTooltip:n})=>(nd(M.fQ.Source.Camera),(0,S.jsx)(sL,{content:s?n:void 0,children:(0,S.jsx)("div",{className:F()("rounded-xl","text-white",s&&"cursor-not-allowed opacity-70",s0),children:(0,S.jsxs)("div",{className:F()("flex items-center",s&&"pointer-events-none"),children:[(0,S.jsx)(et.T,{showIcon:!1,initialState:e,source:M.fQ.Source.Camera,onChange:t,className:"flex !rounded-l-xl !p-2 hover:!bg-white/20",children:(0,S.jsx)(nC,{videoEnabled:e})}),(0,S.jsx)("div",{className:"rounded-r-xl border-l border-white/20 p-2 hover:bg-white/20",children:(0,S.jsx)(nw,{onOpenChange:r})})]})})})),nC=({videoEnabled:e,setVideoEnabled:t})=>(0,S.jsx)("div",{className:"cursor-pointer",onClick:()=>{t&&t(!e)},children:e?(0,S.jsx)(nk,{}):(0,S.jsx)(nj,{})}),nS=()=>{let e=(0,W.f)(),{localParticipant:t}=(0,Z.C)(),{host:r}=sD();(0,C.useEffect)(()=>{if(!e||!r||!t)return;let s=(e,s)=>{if(s?.identity===r.participant.identity)try{let s=JSON.parse(eW.from(e).toString("utf-8"));if(e8.debug("[useHostCommandListener] Data received from host",{hostIdentity:r.participant.identity,message:s}),"HOST_COMMAND"!==s.messageType)return;let n=s.payload;if(!n)return;"STOP_YOUR_SCREENSHARE"===n.type?(e8.debug("[useHostCommandListener] Received host command: stopping local screen share",{commandType:"STOP_YOUR_SCREENSHARE",hostIdentity:r.participant.identity}),t.setScreenShareEnabled(!1)):e8.warn("[useHostCommandListener] Received unknown host command type",{type:n.type,hostIdentity:r.participant.identity})}catch(e){e8.error("[useHostCommandListener] Failed to parse host command message:",{error:e instanceof Error?e.message:String(e)})}};return e.on(M.TQ.DataReceived,s),()=>{e.off(M.TQ.DataReceived,s)}},[e,r,t])},nI=()=>(0,Z.K)().some(e=>e.kind===rf.INGRESS),nE=()=>{let{localParticipant:e}=(0,Z.C)(),[t,r]=(0,C.useState)(!1),{trackEvent:s}=e7(),n=e?.getTrackPublication(M.fQ.Source.Camera),i=!!n&&!n.isMuted,a=e?.getTrackPublication(M.fQ.Source.Microphone),o=!!a,l=!!e?.getTrackPublication(M.fQ.Source.ScreenShare),c=e?.permissions?.canPublish??!1,d=c&&!!e?.permissions?.canPublishData,u=(0,C.useCallback)(async()=>{if(!e)return;let t=!i,r=t?"Enabling":"Disabling";e8.debug("[useLocalParticipantMedia] Toggling camera",{action:r});try{await e.setCameraEnabled(t),e8.debug("[useLocalParticipantMedia] Camera toggle successful",{action:r}),s("livekit_media_track_mute_changed",{trackType:"video",muted:!t,participantId:e.identity})}catch(e){e8.error("[useLocalParticipantMedia] Camera toggle failed",{action:r,error:e instanceof Error?e.message:String(e)})}},[e,i,s]),m=(0,C.useCallback)(async()=>{if(!e||t){e8.debug("[useLocalParticipantMedia] Toggle microphone skipped",{hasLocalParticipant:!!e,isTogglingMic:t});return}r(!0);let n=o?"Unpublishing":"Publishing";e8.debug("[useLocalParticipantMedia] Toggling microphone",{action:n});try{if(o){let t=a?.track;t?(e8.debug("[useLocalParticipantMedia] Unpublishing microphone track",{trackSid:t.sid}),await e.unpublishTrack(t),e8.debug("[useLocalParticipantMedia] Microphone unpublish successful"),s("livekit_media_track_mute_changed",{trackType:"audio",muted:!0,participantId:e.identity})):e8.warn("[useLocalParticipantMedia] Microphone unpublish skipped: micPub.track not found")}else{let t;try{e8.debug("[useLocalParticipantMedia] Creating local audio track"),t=await (0,M.Ai)({audio:!0,video:!1})}catch(e){e8.error("[useLocalParticipantMedia] Failed to create local audio track",{error:e instanceof Error?e.message:String(e)}),r(!1);return}let n=t.find(e=>e.kind===M.fQ.Kind.Audio);if(n)try{e8.debug("[useLocalParticipantMedia] Publishing local audio track",{trackId:n.mediaStreamTrack.id}),await e.publishTrack(n),e8.debug("[useLocalParticipantMedia] Microphone publish successful"),s("livekit_media_track_mute_changed",{trackType:"audio",muted:!1,participantId:e.identity})}catch(e){e8.error("[useLocalParticipantMedia] Failed to publish local audio track",{error:e instanceof Error?e.message:String(e)}),n.stop()}else e8.warn("[useLocalParticipantMedia] Microphone publish skipped: new audio track not found after creation")}}catch(e){e8.error("[useLocalParticipantMedia] Microphone toggle general error",{action:n,error:e instanceof Error?e.message:String(e)})}finally{r(!1)}},[e,t,o,a,s]),p=(0,C.useCallback)(async()=>{if(!e)return;let t=!l,r=t?"Enabling":"Disabling";e8.info("[useLocalParticipantMedia] Toggling screen share",{action:r});try{await e.setScreenShareEnabled(t),e8.debug("[useLocalParticipantMedia] Screen share toggle successful",{action:r}),s("livekit_screenshare_toggled",{enabled:t})}catch(e){e8.error("[useLocalParticipantMedia] Screen share toggle failed",{action:r,error:e instanceof Error?e.message:String(e)})}},[e,l,s]);return{isCameraEnabled:i,isMicrophonePublished:o,isScreenShareEnabled:l,isTogglingMic:t,canPublish:c,canPublishScreenShare:d,toggleCamera:u,toggleMicrophone:m,toggleScreenShare:p}},nM=({isHost:e})=>{let t=(0,W.f)(),r=nI(),{userChoices:s}=(0,Z.x)(),{localParticipant:n}=(0,Z.C)(),i=(0,Z.M)(),{canPublishScreenShare:a}=nE(),[o,l]=(0,C.useState)(s.audioEnabled),[c,d]=(0,C.useState)(s.videoEnabled),u=async e=>{d(e)};(0,C.useEffect)(()=>{(async()=>{t.state===M.em.Connected&&(e8.debug("[useHostControls] Setting local media state",{videoEnabled:c,audioEnabled:o,roomState:t.state}),await t.localParticipant.setCameraEnabled(c),await t.localParticipant.setMicrophoneEnabled(o))})()},[o,t.localParticipant,t.state,c]);let m=i.find(e=>e.isScreenShareEnabled),p=e&&r;return(0,C.useEffect)(()=>{p&&(async()=>{e8.info("[useHostControls] Disabling device controls and media due to ingress active",{disableDeviceControls:p}),l(!1),d(!1),await t.localParticipant.setCameraEnabled(!1),await t.localParticipant.setMicrophoneEnabled(!1)})()},[p,t.localParticipant]),{localParticipant:n,activeScreenSharer:m,canPublishScreenShare:a,audioEnabled:o,videoEnabled:c,toggleAudio:e=>{l(e)},toggleVideo:u,disableDeviceControls:p}},nT=({setForceShowControls:e,isHost:t,isCoHost:r})=>{let{localParticipant:s,activeScreenSharer:n,canPublishScreenShare:i,audioEnabled:a,videoEnabled:o,toggleAudio:l,toggleVideo:c,disableDeviceControls:d}=nM({isHost:t});return nS(),(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[t&&(0,S.jsx)(s4,{}),r&&(0,S.jsx)(s6,{}),(0,S.jsx)(ng,{disabled:d,disabledTooltip:"manage your audio from your streaming software",setForceShowControls:e,audioEnabled:a,setAudioEnabled:l}),(0,S.jsx)(nN,{disabled:d,disabledTooltip:"manage your video from your streaming software",setForceShowControls:e,videoEnabled:o,setVideoEnabled:c}),(0,S.jsx)(ny,{isHost:t,localParticipant:s,activeScreenSharer:n,canShare:i})]})},n_=.01,nL=1,nA=({value:e,onChange:t,max:r=nL,step:s=n_,disabled:n,className:i})=>{let a=Math.min(Math.max(e,0),r);return(0,S.jsx)("div",{className:F()("w-[90px]",s0,i),children:(0,S.jsxs)(es.fC,{className:F()("relative flex h-1 w-full touch-none select-none items-center"),value:[a],max:r,step:s,onValueChange:e=>{t(e[0])},disabled:n,children:[(0,S.jsx)(es.fQ,{className:"relative h-1 w-full grow rounded-full bg-livestream-muted/20",children:(0,S.jsx)(es.e6,{className:F()("absolute h-full rounded-full",n?"bg-livestream-muted":"bg-livestream-green"),style:{width:`${e/r*100}%`}})}),(0,S.jsx)(es.bU,{className:F()("relative block h-4 w-4 rounded-full",n?"cursor-not-allowed bg-livestream-muted":"cursor-pointer bg-livestream-green")})]})})},nP=()=>{let{volume:e,setVolume:t,audioMuted:r}=sW();return(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("p",{className:"p-1 text-xs",children:"volume"}),(0,S.jsxs)("div",{className:"flex items-center gap-2 px-2 py-2",children:[(0,S.jsx)(nA,{value:e,onChange:t,disabled:r}),(0,S.jsx)("p",{className:F()("text-sm text-livestream-muted"),children:r?"muted":`${(100*e).toFixed(0)}%`})]})]})},nR=e=>{let{trackEvent:t}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useCreateRtmpCredentials] Attempting to create RTMP credentials via API",{mintId:e.mintId})},mutationFn:async()=>ts.post("livestream/livekit/create-rtmp-credentials",{json:e}).json(),onSuccess:r=>{t("livekit_create_rtmp_credentials_success"),e8.debug("[useCreateRtmpCredentials] Successfully created RTMP credentials",{mintId:e.mintId,hasCredentials:!!r}),e.onSuccess?.(r)},onError:r=>{t("livekit_create_rtmp_credentials_failure",{error:r.message||"Unknown error creating RTMP credentials"}),e8.error("[useCreateRtmpCredentials] Failed to create RTMP credentials",{mintId:e.mintId,error:r.message})}})},nD=()=>{let{mintId:e,token:t}=r_(),{setRtmpCredentials:r,rtmpCredentials:s}=sW(),{openDialog:n}=s2(),{mutateAsync:i,isPending:a}=nR({mintId:e,onSuccess:e=>{r(e),n("get-rtmp-keys")}}),o=async()=>{if(s){n("get-rtmp-keys");return}await i()};return tt.RTMP_CREDENTIALS_ENABLED&&t?.role==="host"?(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)("p",{className:"p-1 text-xs",children:"RTMP stream"}),(0,S.jsxs)("div",{className:"flex items-center gap-2 rounded-md px-4 py-2 hover:bg-white/20",children:[(0,S.jsx)("div",{className:"h-4 w-4",children:a&&(0,S.jsx)(en.Z,{className:"animate-spin text-livestream-muted",size:16})}),(0,S.jsx)("p",{className:"cursor-pointer text-sm",onClick:o,children:"get key and url"})]})]}):null},nF=({tooltipContent:e,tooltipProps:t=sT,...r})=>(0,S.jsx)(sL,{content:e,...t,children:(0,S.jsx)(nt,{...r})}),nU=((m=nU||{}).AUTO="auto",m.HIGH="high (720p)",m.MEDIUM="medium (360p)",m.LOW="low (180p)",m),nB=e=>{switch(e){case"high (720p)":return M.SF.HIGH;case"medium (360p)":return M.SF.MEDIUM;case"low (180p)":return M.SF.LOW}},nO=()=>{let e=(0,W.u)(),[t,r]=(0,C.useState)("auto");return{quality:t,setQuality:(0,C.useCallback)(t=>{e.remoteParticipants.forEach(e=>{e.trackPublications.forEach(r=>{if(r.kind===M.fQ.Kind.Video&&r.isSubscribed&&r.track){if(e8.debug("[useConnectionQuality] Applying quality to publication",{participantIdentity:e.identity,publicationSid:r.trackSid,requestedQuality:t}),"auto"===t)r.setVideoQuality(M.SF.HIGH);else{let e=nB(t);r.setVideoQuality(e)}}})}),r(t)},[e.remoteParticipants]),selectorOptions:(0,C.useMemo)(()=>Object.values(nU).map(e=>({label:e,value:e})),[])}},n$=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,S.jsx)("path",{d:"M8.6447 5.54878L6.90046 5.14626C6.57358 5.07083 6.23089 5.16911 5.99368 5.40632L5.40632 5.99368C5.16911 6.23089 5.07083 6.57358 5.14626 6.90046L5.54878 8.6447C5.63978 9.03905 5.47717 9.44855 5.14043 9.67305L3.43326 10.8112C3.16258 10.9916 3 11.2954 3 11.6207V12.3793C3 12.7046 3.16259 13.0084 3.43326 13.1888L5.14043 14.327C5.47717 14.5514 5.63978 14.9609 5.54878 15.3553L5.14626 17.0995C5.07083 17.4264 5.16911 17.7691 5.40632 18.0063L5.99368 18.5937C6.23089 18.8309 6.57358 18.9292 6.90046 18.8537L8.6447 18.4512C9.03905 18.3602 9.44855 18.5228 9.67305 18.8596L10.8112 20.5667C10.9916 20.8374 11.2954 21 11.6207 21H12.3793C12.7046 21 13.0084 20.8374 13.1888 20.5667L14.327 18.8596C14.5514 18.5228 14.9609 18.3602 15.3553 18.4512L17.0995 18.8537C17.4264 18.9292 17.7691 18.8309 18.0063 18.5937L18.5937 18.0063C18.8309 17.7691 18.9292 17.4264 18.8537 17.0995L18.4512 15.3553C18.3602 14.9609 18.5228 14.5514 18.8596 14.327L20.5667 13.1888C20.8374 13.0084 21 12.7046 21 12.3793V11.6207C21 11.2954 20.8374 10.9916 20.5667 10.8112L18.8596 9.67305C18.5228 9.44855 18.3602 9.03905 18.4512 8.6447L18.8537 6.90046C18.9292 6.57358 18.8309 6.23089 18.5937 5.99368L18.0063 5.40632C17.7691 5.16911 17.4264 5.07083 17.0995 5.14626L15.3553 5.54878C14.9609 5.63978 14.5514 5.47717 14.327 5.14043L13.1888 3.43326C13.0084 3.16258 12.7046 3 12.3793 3H11.6207C11.2954 3 10.9916 3.16259 10.8112 3.43326L9.67305 5.14043C9.44855 5.47717 9.03905 5.63978 8.6447 5.54878Z",stroke:"#F8FAFC",strokeWidth:"2",strokeLinejoin:"round"}),(0,S.jsx)("path",{d:"M15 12C15 13.6569 13.6569 15 12 15C10.3431 15 9 13.6569 9 12C9 10.3431 10.3431 9 12 9C13.6569 9 15 10.3431 15 12Z",stroke:"#F8FAFC",strokeWidth:"2",strokeLinejoin:"round"})]})}),nV=({onOpenChange:e})=>{let{quality:t,setQuality:r,selectorOptions:s}=nO(),{fullScreen:n}=sW();return(0,S.jsx)(nF,{title:"video quality",tooltipContent:"stream settings",selectedValue:String(t),options:s,onValueChange:r,tooltipProps:{...sT,sideOffset:15},openDirection:"top",footer:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(nD,{}),(0,S.jsx)(nP,{})]}),onOpenChange:e,icon:(0,S.jsx)(n$,{}),triggerClassName:"rounded-lg p-1 hover:bg-white/20",renderInPortal:n})},nq=()=>{let{localParticipant:e}=(0,Z.C)();return!1===rj(e).anon},nH=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M5 20.9999V14.9999M5 14.9999V3.99994C10.074 1.47396 13.926 6.52592 19 3.99994V14.9999C13.926 17.5259 10.074 12.474 5 14.9999Z",stroke:"#F8FAFC",strokeWidth:"2",strokeLinecap:"square"})})}),nQ=()=>{let{openDialog:e}=s2();return nq()?(0,S.jsx)(sA,{tooltipContent:"report issue",icon:(0,S.jsx)(nH,{}),onClick:()=>{e("report-livestream")}}):null},nz=[{label:"0.01",value:"0.01"},{label:"0.1",value:"0.1"},{label:"1",value:"1"}],nG=({className:e})=>(0,S.jsx)("div",{className:F()(e),children:(0,S.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("g",{children:(0,S.jsx)("path",{d:"M5.33333 6.00065L8 3.33398L10.6667 6.00065M5.33333 10.0007L8 12.6673L10.6667 10.0007",stroke:"currentColor",strokeWidth:"1.33333",strokeLinecap:"square"})})})}),nZ=({amount:e,setAmount:t,onBuy:r,setForceShowControls:s})=>(0,S.jsxs)("div",{onClick:r,className:"flex h-full w-32 cursor-pointer select-none items-center justify-center gap-1 rounded-lg bg-livestream-green-dark px-4 py-2 text-[14px] text-black",children:[(0,S.jsx)("span",{children:"buy"}),(0,S.jsx)(nt,{options:nz,selectedValue:e,onValueChange:t,onOpenChange:s,showSelectedValue:{show:!0,className:"text-black"},openDirection:"top",icon:(0,S.jsx)(nG,{className:"text-black opacity-50"})}),(0,S.jsx)("span",{children:"SOL"})]}),nW=((p=nW||{}).THUMBS_UP="thumbs-up",p.ROCKET="rocket",p.TADA="tada",p.PARTY_FACE="party-face",p.HEART_EYES="heart-eyes",p.SOB="sob",p.JOY="joy",p.GRIN="grin",p),nK={"thumbs-up":{assetFilename:"thumbs-up.json",staticCharacter:"\uD83D\uDC4D"},rocket:{assetFilename:"rocket.json",staticCharacter:"\uD83D\uDE80"},tada:{assetFilename:"tada.json",staticCharacter:"\uD83C\uDF89"},"party-face":{assetFilename:"party-face.json",staticCharacter:"\uD83E\uDD73"},"heart-eyes":{assetFilename:"heart-eyes.json",staticCharacter:"\uD83D\uDE0D"},sob:{assetFilename:"sob.json",staticCharacter:"\uD83D\uDE2D"},joy:{assetFilename:"joy.json",staticCharacter:"\uD83D\uDE02"},grin:{assetFilename:"grin.json",staticCharacter:"\uD83D\uDE00"}},nJ=(0,_.U)(e=>({lastSelectedEmoji:"party-face",setLastSelectedEmoji:t=>e({lastSelectedEmoji:t})})),nY=e=>{!w||w.length<e?(w=eW.allocUnsafe(128*e),eo().randomFillSync(w),j=0):j+e>w.length&&(eo().randomFillSync(w),j=0),j+=e},nX=(e=21)=>{nY(e|=0);let t="";for(let r=j-e;r<j;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&w[r]];return t},n0=e=>{let t=nK[e];return t.assetFilename?`/livestreams/reactions/${t.assetFilename}`:""},n1=e=>nK[e].staticCharacter,n2=e=>`${e}-${nX()}`,n4=({onSelect:e,message:t,setMessage:r})=>{let s=nJ(e=>e.setLastSelectedEmoji),n=t=>{s(t),e()};return(0,S.jsxs)("div",{className:"flex flex-col gap-3 p-4",children:[(0,S.jsx)("div",{className:"custom-scrollbar flex w-[300px] gap-2 overflow-x-auto pb-2",children:Object.values(nW).map(e=>(0,S.jsx)("button",{onClick:()=>n(e),className:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full text-2xl hover:bg-white/10",children:n1(e)},e))}),(0,S.jsx)("label",{className:"mb-2 text-sm font-medium text-white",htmlFor:"reaction-message-input",children:"Message (optional)"}),(0,S.jsx)("input",{id:"reaction-message-input",type:"text",placeholder:"Enter...",className:"w-[300px] rounded-md border border-gray-600 bg-gray-700 px-4 py-2 text-white placeholder:text-gray-400",value:t,onChange:e=>r(e.target.value)})]})},n3=({className:e,direction:t="down"})=>(0,S.jsx)("div",{className:F()(e,"up"===t&&"rotate-180","left"===t&&"rotate-90","right"===t&&"-rotate-90"),children:(0,S.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.23571 8.15497C8.10553 8.28515 7.89448 8.28515 7.7643 8.15497L5.80474 6.19541C5.54439 5.93506 5.12228 5.93506 4.86193 6.19541C4.60158 6.45576 4.60158 6.87787 4.86193 7.13822L6.82149 9.09778C7.47237 9.74866 8.52764 9.74865 9.17852 9.09778L11.1381 7.13822C11.3984 6.87787 11.3984 6.45576 11.1381 6.19541C10.8777 5.93506 10.4556 5.93506 10.1953 6.19541L8.23571 8.15497Z",fill:"currentColor"})})}),n5=({isPopoverOpen:e})=>{let t=nJ(e=>e.lastSelectedEmoji);return(0,S.jsxs)("div",{className:"flex items-center gap-1 px-1",children:[(0,S.jsx)(n3,{direction:e?"up":"down",className:"h-4 w-4 text-white"}),(0,S.jsx)("span",{className:"text-2xl",children:t?n1(t):"\uD83D\uDE00"})]})},n6=({message:e,setMessage:t,setForceShowControls:r})=>{let{value:s,setValue:n,setFalse:i}=su(!1);return(0,S.jsxs)(ei.fC,{open:s,onOpenChange:e=>{n(e),r(e)},children:[(0,S.jsx)(ei.xz,{asChild:!0,children:(0,S.jsx)(sM,{icon:(0,S.jsx)(n5,{isPopoverOpen:s}),label:"Select Reaction",className:"bg-transparent p-0 hover:bg-transparent"})}),(0,S.jsx)(ei.h_,{children:(0,S.jsxs)(ei.VY,{sideOffset:10,side:"top",align:"center",className:"rounded-lg bg-[#1B1D27]/80 shadow-lg backdrop-blur-sm",style:{zIndex:s_.ReactionsPopover.content},children:[(0,S.jsx)(n4,{message:e,setMessage:t,onSelect:i}),(0,S.jsx)(ei.Eh,{className:"fill-[#1B1D27]/80"})]})})]})},n8=({delayMs:e})=>{let t=(0,C.useRef)(0);return{canPerformAction:(0,C.useCallback)(()=>{let r=Date.now();return r-t.current>=e&&(t.current=r,!0)},[e])}},n7=new class{constructor(){this.handlers=[]}emit(e){[...this.handlers].forEach(t=>t(e))}subscribe(e){return this.handlers.push(e),()=>{this.handlers=this.handlers.filter(t=>t!==e)}}clearHandlers(){this.handlers=[]}},n9=()=>{let{localParticipant:e}=(0,Z.C)(),{canPerformAction:t}=n8({delayMs:500});return{sendReaction:(0,C.useCallback)((r,s,n)=>{if(!t()){e8.debug("[useSendReaction] Network reaction rate-limited.",{emojiId:r});return}let i={type:"reaction",emojiId:r,message:s,senderIdentity:e.identity,purchase:n,initialXSeed:Math.random()};n7.emit(i);try{let t=new TextEncoder().encode(JSON.stringify(i));e.publishData(t,{topic:"reactions-v1",reliable:!0}),e8.debug("[useSendReaction] Sent reaction data to network",{emojiId:r,message:s,purchase:n})}catch(e){e8.error("[useSendReaction] Failed to send reaction data to network",{emojiId:r,message:s,purchase:n,error:e instanceof Error?e.message:String(e)})}},[e,t])}},ie=({setForceShowControls:e})=>{let{onBuyReaction:t}=r_(),{lastSelectedEmoji:r}=nJ(),{sendReaction:s}=n9(),[n,i]=(0,C.useState)(nz[0].value),[a,o]=(0,C.useState)("");return(0,S.jsxs)("div",{className:"flex items-center",children:[(0,S.jsx)(n6,{message:a,setMessage:o,setForceShowControls:e}),(0,S.jsx)(nZ,{amount:n,setAmount:i,onBuy:()=>{r&&(t?.(n,a),s(r,a,{amount:n,currency:"SOL"}),o(""))},setForceShowControls:e})]})},it=({setForceShowControls:e,className:t})=>{let{isHost:r,isCoHost:s}=sF(),{mintId:n,showControls:i,isMobile:a}=r_(),{audioMuted:o,toggleMute:l}=sW(),c=s3(n);return i&&c?(0,S.jsx)("div",{className:F()("absolute bottom-0 flex h-12 w-full items-center sm:h-16","bg-gradient-to-b from-[#1B1D27]/0 via-[#1B1D27]/5 to-[#1B1D27]/50",t),style:{zIndex:s_.Controls.bottom},children:(0,S.jsxs)("div",{className:"relative flex w-full items-center justify-between p-1 sm:p-3",children:[(0,S.jsx)("div",{className:"flex items-center gap-1 sm:gap-2",children:(r||s)&&(0,S.jsx)(nT,{setForceShowControls:e,isHost:r,isCoHost:s})}),(0,S.jsx)("div",{className:"absolute left-1/2 top-1/2 flex -translate-x-1/2 -translate-y-1/2 items-center gap-2",children:tt.REACTIONS_ENABLED&&(0,S.jsx)(ie,{setForceShowControls:e})}),(0,S.jsxs)("div",{className:F()("flex items-center gap-1 rounded-xl p-1",s0),children:[(0,S.jsx)(nV,{onOpenChange:e}),(0,S.jsx)(sX,{audioMuted:o,toggleMute:l}),!r&&(0,S.jsx)(nQ,{}),!a&&(0,S.jsx)(sK,{})]})]})}):null},ir=({live:e})=>(0,S.jsx)("div",{className:F()("w-fit rounded-[4px] px-[6px] py-[2px]","text-[12px] font-bold uppercase leading-[16px] text-black",e?"bg-livestream-green":"bg-[#E77975]"),children:e?"Live":"Not live"}),is=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,S.jsx)("path",{d:"M8.00033 1.33325C6.34347 1.33325 5.00033 2.6764 5.00033 4.33325C5.00033 5.99011 6.34347 7.33325 8.00033 7.33325C9.65718 7.33325 11.0003 5.99011 11.0003 4.33325C11.0003 2.6764 9.65718 1.33325 8.00033 1.33325Z",fill:"#F8FAFC"}),(0,S.jsx)("path",{d:"M8.0004 7.99992C5.76191 7.99992 3.97541 9.17731 3.03545 10.9256C2.61597 11.7058 2.77408 12.5157 3.23911 13.0942C3.68798 13.6526 4.41616 13.9999 5.19723 13.9999H10.8036C11.5846 13.9999 12.3128 13.6526 12.7617 13.0942C13.2267 12.5157 13.3848 11.7058 12.9653 10.9256C12.0254 9.17731 10.2389 7.99992 8.0004 7.99992Z",fill:"#F8FAFC"})]})}),ii=({onClick:e})=>{let t=(0,Z.M)();return(0,S.jsxs)("div",{className:F()("flex cursor-pointer items-center gap-[2px]"),onClick:e,children:[(0,S.jsx)(ir,{live:!0}),(0,S.jsxs)("div",{className:"flex items-center rounded-[4px] bg-black/50 p-[2px]",children:[(0,S.jsx)(is,{}),(0,S.jsx)("span",{className:"text-[14px] leading-[18px] text-white",children:t.length})]})]})},ia=({isBackstage:e})=>{let{openDialog:t}=s2(),{showControls:r}=r_(),s=(0,C.useCallback)(()=>{r&&t("participants")},[t,r]);return(0,S.jsx)("div",{className:F()("bg-gradient-to-b from-[#11121580] to-black/0","absolute top-0 h-[84px] w-full","pointer-events-none"),style:{zIndex:s_.Controls.top},children:(0,S.jsxs)("div",{className:"flex w-full items-start justify-between p-[12px]",children:[(0,S.jsx)("div",{className:"pointer-events-auto flex items-center gap-2",children:r&&!e&&(0,S.jsx)(sr,{})}),(0,S.jsxs)("div",{className:"pointer-events-auto flex items-center gap-2",children:[!e&&(0,S.jsx)(ii,{onClick:s}),e&&(0,S.jsx)(ir,{live:!1})]})]})})},io=({isBackstage:e=!1})=>{let{isOpen:t}=s2(),[r,s]=(0,C.useState)(!1),[n,i]=(0,C.useState)(!1),{isDisconnected:a,isMobile:o}=r_();return a?null:(0,S.jsxs)("div",{onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),className:F()("absolute right-0 top-0 h-full w-full",!o&&"group-hover:opacity-100",o||n||r||t?"opacity-100":"opacity-0"),onClick:o?e=>e.stopPropagation():void 0,children:[(0,S.jsx)(ia,{isBackstage:e}),!e&&(0,S.jsx)(it,{setForceShowControls:e=>{s(e)}})]})},il=({width:e=32,...t})=>(0,S.jsxs)("svg",{width:e,viewBox:"0 0 320 320",preserveAspectRatio:"xMidYMid meet",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t,children:[(0,S.jsx)("path",{d:"M160 180C204.182 180 240 144.183 240 100C240 55.8172 204.182 20 160 20C115.817 20 79.9997 55.8172 79.9997 100C79.9997 144.183 115.817 180 160 180Z",fill:"currentColor",fillOpacity:.25}),(0,S.jsx)("path",{d:"M97.6542 194.614C103.267 191.818 109.841 192.481 115.519 195.141C129.025 201.466 144.1 205 159.999 205C175.899 205 190.973 201.466 204.48 195.141C210.158 192.481 216.732 191.818 222.345 194.614C262.703 214.719 291.985 253.736 298.591 300.062C300.15 310.997 291.045 320 280 320H39.9997C28.954 320 19.8495 310.997 21.4087 300.062C28.014 253.736 57.2966 214.72 97.6542 194.614Z",fill:"currentColor",fillOpacity:.25})]}),ic=({audioEnabled:e,videoEnabled:t})=>{let{audioDeviceId:r,videoDeviceId:s}=nl(),n=(0,el.aZ)({audio:!!e&&{deviceId:r},video:!!t&&{deviceId:s}}),{isMobile:i}=r_(),a=(0,C.useMemo)(()=>n?.find(e=>e.kind===M.fQ.Kind.Video),[n]),o=(0,C.useRef)(null);(0,C.useEffect)(()=>{let e=o.current;return e&&a&&(a.unmute(),a.attach(e)),()=>{e&&a&&a.detach(e)}},[a]);let l=F()("flex aspect-video h-full w-full items-center justify-center overflow-hidden bg-black","text-white",{"rounded-[8px]":!i,"rounded-none":i});return(0,S.jsx)("div",{className:l,children:a&&t?(0,S.jsx)("video",{ref:o,className:"h-full w-full object-cover"}):(0,S.jsx)(il,{width:60})})},id={terms:"terms and conditions","stream-preview":"stream preview"},iu={primary:"bg-livestream-green",secondary:"bg-red-500"},im={filled:{primary:"text-black",secondary:"text-white"},outline:{primary:"text-livestream-green",secondary:"text-white"}},ip={large:"px-[76px]",medium:"px-[14px]",small:"px-2"},ih={large:"py-3",medium:"py-1",small:"py-0"},ig=({onClick:e,label:t,icon:r,className:s,style:n,disabled:i,variant:a="primary",appearance:o="filled",size:l="large",tooltip:c})=>{let d=!!r,u=!d&&"secondary"===a,m=(0,S.jsxs)("button",{onClick:i?void 0:e,disabled:i,style:n,className:F()("flex items-center justify-center",ih[l],"font-bold","rounded-[6px] text-[14px] leading-[18px]","lowercase","filled"===o&&iu[a],"outline"===o&&"bg-transparent",im[o][a],d?"gap-2 px-2":ip[l],i&&"cursor-not-allowed opacity-50",!i&&"hover:opacity-70",s),children:[r,(0,S.jsxs)("span",{children:[u&&"[",t,u&&"]"]})]});return c?(0,S.jsxs)(k.fC,{delayDuration:0,children:[(0,S.jsx)(k.xz,{asChild:!0,children:m}),(0,S.jsx)(k.VY,{className:"mb-[10px] max-w-[200px] rounded-md bg-gray-100 p-2 text-[12px] text-black",children:c})]}):m},ix=()=>"undefined"!=typeof navigator&&!!navigator.userAgent&&/phantom/i.test(navigator.userAgent),iv=()=>"undefined"!=typeof navigator&&!!navigator.userAgent&&/firefox/i.test(navigator.userAgent),ib=()=>{let[e,t]=(0,C.useState)("not-checked"),[r,s]=(0,C.useState)("not-checked");return(0,C.useEffect)(()=>{let e=null,r=null,n=()=>{e&&t(e.state)},i=()=>{r&&s(r.state)};return(async()=>{if(e8.debug("[useBrowserPermissions] Checking browser permissions"),!navigator.permissions||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){if(ix()){e8.debug("[useBrowserPermissions] Phantom browser detected for permissions check. Bypassing"),t("bypass"),s("bypass");return}e8.warn("[useBrowserPermissions] Permissions API or getUserMedia not supported"),t("unsupported"),s("unsupported");return}try{e=await navigator.permissions.query({name:"camera"}),e8.debug("[useBrowserPermissions] Camera permission status queried",{state:e.state}),t(e.state),e.onchange=n,r=await navigator.permissions.query({name:"microphone"}),e8.debug("[useBrowserPermissions] Microphone permission status queried",{state:r.state}),s(r.state),r.onchange=i}catch(e){e8.error("[useBrowserPermissions] Failed to query permissions",{error:e instanceof Error?e.message:String(e)}),iv()?(e8.debug("[useBrowserPermissions] Failed to query permissions on Firefox browser. Bypassing"),t("bypass"),s("bypass")):(t("unsupported"),s("unsupported"))}})(),()=>{e&&(e.onchange=null),r&&(r.onchange=null)}},[]),{hasAnyPermission:"bypass"===e&&"bypass"===r||"granted"===e||"granted"===r,checkInProgress:"not-checked"===e||"not-checked"===r,isUnsupported:"unsupported"===e||"unsupported"===r}},iy=e=>{let t=(0,N.NL)(),{trackEvent:r}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useCreateLivestream] Attempting to create livestream via API",{mintId:e.mintId})},mutationFn:async()=>ts.post("livestream/create",{json:e}).json(),onSuccess:s=>{r("livekit_create_stream_success",{mintId:e.mintId}),e8.debug("[useCreateLivestream] Successfully created livestream, invalidating query",{mintId:e.mintId,receivedToken:s?.token}),t.invalidateQueries({queryKey:[td,e.mintId]}),e.onSuccess(s)},onError:t=>{let s=t.message||"Unknown error during livestream creation";r("livekit_create_stream_failure",{error:s,mintId:e.mintId}),e8.error("[useCreateLivestream] Failed to create livestream",{mintId:e.mintId,error:s})}})},iw=({className:e})=>{let{mintId:t,setIsDisconnected:r,setToken:s,setShowBackstage:n}=r_(),{mutateAsync:i,isPending:a}=iy({mintId:t,onSuccess:s}),{hasAnyPermission:o}=ib(),l=(0,C.useCallback)(async e=>{if(e.preventDefault(),e8.info("[StartStreamButton] handleStartStream called.",{mintId:t,hasAnyPermission:o}),!o){e8.warn("[StartStreamButton] Start stream blocked due to missing browser permissions.",{mintId:t});return}try{await i(),n(!1),r(!1)}catch(e){e8.error("[StartStreamButton] Error from createLivestream or subsequent state sets:",{mintId:t,error:e instanceof Error?e.message:String(e)})}},[i,r,n,t,o]);return(0,S.jsx)(ig,{disabled:a||!o,label:"go live",onClick:l,className:e,tooltip:o?void 0:"You must give browser access to your camera or microphone"})},ij=({activeTab:e,isEndOfTermsVisible:t,onClick:r})=>"terms"===e?(0,S.jsx)(ig,{label:t?"I agree":"scroll to end",className:"w-full",onClick:r}):(0,S.jsx)(iw,{className:"w-full"}),ik=e=>(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,S.jsxs)("div",{className:"flex items-center gap-4",children:[(0,S.jsx)(nC,{videoEnabled:e.videoEnabled,setVideoEnabled:e.toggleVideo}),(0,S.jsx)(nw,{isBackstage:!0})]}),(0,S.jsxs)("div",{className:"flex items-center gap-4",children:[(0,S.jsx)(nf,{audioEnabled:e.audioEnabled,setAudioEnabled:e.toggleAudio}),(0,S.jsx)(nc,{isBackstage:!0})]})]}),iN=e=>(0,S.jsx)(ik,{...e}),iC=()=>(0,S.jsxs)("div",{className:"pb-[20px] text-[12px] leading-[16px] text-white",children:[(0,S.jsx)("p",{className:"mb-3 font-bold",children:"Livestream Moderation Policy"}),(0,S.jsx)("p",{className:"mb-3",children:"Purpose: To cultivate a social environment on pump fun that preserves creativity and freedom of expression and encourages meaningful engagement amongst users, free of illegal, harmful, and negative interactions. We consider this moderation policy to be a living document, and you should check it frequently as it will be updated from time to time, including in response to feedback from the community, moderators, policy experts, and other stakeholders."}),(0,S.jsx)("p",{className:"mb-3 font-bold",children:"Restriction on Underage Use"}),(0,S.jsx)("p",{className:"mb-3",children:"Livestreamingwhether streaming yourself, watching a stream, or chatting with other viewersis restricted to users above the age of 18. pump fun takes this user restriction seriously. If we identify a user violating this policy, we will promptly terminate your account. We reserve the right to require age verification where we deem it necessary, and whether verification is necessary is subject to our sole and absolute discretion."}),(0,S.jsx)("p",{className:"mb-3 font-bold",children:"Appropriateness of Content"}),(0,S.jsx)("p",{className:"mb-3",children:"Aside from the prohibitions listed below, pump fun does not intend to universally define what content is 'appropriate' or 'inappropriate.' There is an implicit assumption that some content - perhaps much content - generally defined as NSFW will in fact appear on pump fun. The livestreaming platform is intended exclusively for users above the age of 18. pump fun reserves the right to unilaterally determine the appropriateness of content where necessary and to moderate it accordingly."}),(0,S.jsx)("p",{className:"mb-3 font-bold",children:"Prohibited Content"}),(0,S.jsx)("p",{className:"mb-3",children:"Streams containing any of the following are prohibited and subject to immediate termination and suspension of future access to pump fun livestreams or to pump fun itself."}),(0,S.jsxs)("span",{className:"mb-3",children:[(0,S.jsx)("span",{className:"mb-3 underline",children:"Violence:"})," Graphic violence, threats, glorification of violent acts, or content promoting self-harm. pump fun takes violence seriously, and it is considered a zero-tolerance violation. Accounts associated with such activities should expect to be indefinitely suspended. Specific examples include:"]}),(0,S.jsxs)("ul",{className:"mb-3 list-disc space-y-2 pl-5",children:[(0,S.jsx)("li",{children:"Attempts or threats to physically harm or kill yourself or others"}),(0,S.jsx)("li",{children:"Attempts or threats to hack, dox, DDOS, or SWAT others"}),(0,S.jsx)("li",{children:"Use of weapons to physically threaten, intimidate, harm, or kill"}),(0,S.jsx)("li",{children:"Encouraging others to participate in acts that may harm others"}),(0,S.jsx)("li",{children:"Promotion of sexual violence"})]}),(0,S.jsxs)("span",{className:"mb-3",children:[(0,S.jsx)("span",{className:"mb-3 underline",children:"Harassment:"})," People experience harassment in different ways, including targeted abuse, bullying, sexual harassment, or coordinated harassment campaigns. Specific examples include:"]}),(0,S.jsxs)("ul",{className:"mb-3 list-disc space-y-2 pl-5",children:[(0,S.jsx)("li",{children:"Encouraging harm or death to someone else"}),(0,S.jsx)("li",{children:"Implied threats of violence"}),(0,S.jsx)("li",{children:'Sharing negative doctored or "deep fake" content to intentionally abuse or degrade another person'}),(0,S.jsx)("li",{children:"Stalking"}),(0,S.jsx)("li",{children:"Unwanted sexual advances"}),(0,S.jsx)("li",{children:"Advocating or encouraging sexual violence against someone else"})]}),(0,S.jsxs)("span",{className:"mb-3",children:[(0,S.jsx)("span",{className:"mb-3 underline",children:"Sexual Content:"})," Sexual and pornographic content as well as nudity without context. Even where consensual, this content is frequently subject to other rules and regulations that make it unsupportable. Specific examples include:"]}),(0,S.jsxs)("ul",{className:"mb-3 list-disc space-y-2 pl-5",children:[(0,S.jsx)("li",{children:"Explicit, simulated, fictional, or implied sex or masturbation"}),(0,S.jsx)("li",{children:"Advertisement or solicitation of sex, including prostitution, escorts, and filmed sexual activity"}),(0,S.jsx)("li",{children:"Consensual sexual activities"}),(0,S.jsx)("li",{children:"Non-consensual sexual activities and sexual exploitation"}),(0,S.jsx)("li",{children:"Encouraging or directing viewers to engage in sexual acts"})]}),(0,S.jsxs)("span",{className:"mb-3",children:[(0,S.jsx)("span",{className:"mb-3 underline",children:"Youth Endangerment:"})," ","Livestreaming may not be targeted to people under the age of 18 and may not contain any content that features or promotes activities that endanger youth. We report all illegal content or activity to the National Center for Missing and Exploited Children, which works with global law enforcement agencies. The consequence for engaging in youth endangerment activity is immediate and indefinite suspension as well as reporting to law enforcement. Specific examples include:"]}),(0,S.jsxs)("ul",{className:"mb-3 list-disc space-y-2 pl-5",children:[(0,S.jsx)("li",{children:'Content promoting or constituting child sexual abuse material ("CSAM") (e.g., sexually explicit content or sexualized images of youth including AI generated images)'}),(0,S.jsx)("li",{children:"Content that promotes or depicts the sexual exploitation or grooming of children"}),(0,S.jsx)("li",{children:"Sharing information about or links to third-party sites that contain CSAM"}),(0,S.jsx)("li",{children:"Identifying CSAM victims (e.g., name or image)"}),(0,S.jsx)("li",{children:"Grooming or otherwise purposefully exposing youth to sexually explicit language or material, as well as engaging in sexual conversations in chat with youth"})]}),(0,S.jsxs)("span",{className:"mb-3",children:[(0,S.jsx)("span",{className:"mb-3 underline",children:"Illegal Activities:"})," Content promoting illicit behavior or violations of the law in pump fun's jurisdictions and your own. Any content or activity featuring, encouraging, or soliciting illegal activity may be reported to law enforcement. Specific examples include:"]}),(0,S.jsxs)("ul",{className:"mb-3 list-disc space-y-2 pl-5",children:[(0,S.jsx)("li",{children:"Engaging in or encouraging human trafficking (e.g., sex trafficking, sales of children)"}),(0,S.jsx)("li",{children:"Buying or selling illegal firearms, drugs, or counterfeit goods"}),(0,S.jsx)("li",{children:"Defamation"}),(0,S.jsx)("li",{children:"Destroying or stealing someone else's property or public property"})]}),(0,S.jsxs)("span",{className:"mb-3",children:[(0,S.jsx)("span",{className:"mb-3 underline",children:"Privacy Violations:"})," Sharing personal information without consent, doxxing (i.e. the unauthorized association of a person's identity with their online handle or persona), or unauthorized broadcasting of private individuals' likenesses. Specific examples include:"]}),(0,S.jsxs)("ul",{className:"mb-3 list-disc space-y-2 pl-5",children:[(0,S.jsx)("li",{children:"AI generated images and deep fakes"}),(0,S.jsx)("li",{children:"Promoting or encouraging impersonation of others"}),(0,S.jsx)("li",{children:"Disclosure of personal information of non-public figures without their consent"}),(0,S.jsx)("li",{children:"Disclosure of personal information of public figures for the purposes of prohibited harassment or illegal activity"})]}),(0,S.jsxs)("span",{className:"mb-3",children:[(0,S.jsx)("span",{className:"mb-3 underline",children:"Copyright Violations:"})," ","Unauthorized broadcasting of protected content, trademarked content, or the use of intellectual property belonging to another person without permission. You may not use or share content that you do not own or have the right to share. Specific examples include:"]}),(0,S.jsxs)("ul",{className:"mb-3 list-disc space-y-2 pl-5",children:[(0,S.jsx)("li",{children:"Use of copyrighted songs"}),(0,S.jsx)("li",{children:"Content created by others on different platforms"}),(0,S.jsx)("li",{children:"Pirated content, including games, movies, television shows, or sporting events"}),(0,S.jsx)("li",{children:"Trademarked good or services"})]}),(0,S.jsxs)("p",{className:"mb-3",children:["Pump fun's DMCA guidelines are available"," ",(0,S.jsx)("a",{href:"https://pump.fun/docs/dmca-policy?include-nsfw=true",target:"_blank",rel:"noopener noreferrer",className:"font-bold text-livestream-green",children:"here"}),", which include information on submitting a copyright infringement notification."]}),(0,S.jsxs)("span",{className:"mb-3",children:[(0,S.jsx)("span",{className:"mb-3 underline",children:"Terrorism or Violent Extremism:"})," ","Glorification of or encouragement of acts which would cause harm to others or significant harm to property. Any content or activity supporting or promoting terrorism or violent extremism may be reported to law enforcement. Specific examples include:"]}),(0,S.jsxs)("ul",{className:"mb-3 list-disc space-y-2 pl-5",children:[(0,S.jsx)("li",{children:"Display or linking to terrorist propaganda"}),(0,S.jsx)("li",{children:"Graphic footage or images of terrorist violence for the purpose of encouraging, supporting, or glorifying the conduct"})]}),(0,S.jsx)("p",{className:"mb-3 font-bold",children:"Enforcement"}),(0,S.jsx)("p",{className:"mb-3",children:"Violation of this policy may result in termination of livestreams and user account(s). This policy is enforced at the sole discretion of pump fun. While our moderators work diligently to ensure that this policy is not violated, we may not discover every violation of this policy. The publication of material which violates this policy and is not discovered by our moderators does not constitute a waiver of our right to enforce this policy, in its entirety, to any subsequently posted content."}),(0,S.jsx)("p",{className:"mb-3",children:"If you believe that any content violates our guidelines or your rights, please let us know by contacting legal@pump.fun. Clearly identify the content in question and explain the concern. Our moderation team will promptly review your request and make a determination."}),(0,S.jsx)("p",{className:"mb-3",children:"Content determined to violate these rules will be removed. pump fun reserves the right to ban any user violating these rules and to make appropriate referrals to law enforcement if any posted content violates the law."}),(0,S.jsx)("p",{className:"mb-3 font-bold",children:"Creator Responsibilities"}),(0,S.jsxs)("ul",{className:"mb-3 list-disc space-y-2 pl-5",children:[(0,S.jsx)("li",{children:"Follow the moderation policy"}),(0,S.jsx)("li",{children:"Review moderation guidelines before streaming sensitive topics"})]}),(0,S.jsx)("p",{className:"mb-3 font-bold",children:"Appeals Process"}),(0,S.jsx)("p",{className:"mb-3",children:"We acknowledge that mistakes may be made in enforcing this policy and, to the extent a user believes that their content has been mistakenly removed and does not violate this policy and/or the user's account was banned as a result of the violation, such user may appeal."}),(0,S.jsx)("p",{className:"mb-3",children:"Contact legal@pump.fun clearly stating your reasons for appealing our decision. Include relevant details to help us reconsider the matter. Our moderation team will promptly re-evaluate your content based on your appeal. We'll provide you with a final decision and explanation by email."}),(0,S.jsx)("p",{className:"mb-3",children:"pump fun retains the ultimate discretion to determine whether content violates this policy."})]}),iS=({label:e,className:t,children:r,style:s})=>(0,S.jsxs)("p",{className:F()("font-bold lowercase leading-[20px] text-white",t),style:s,children:[e,r]}),iI=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M12.4998 7.49999L7.49984 12.5M12.4998 12.5L7.49984 7.49999M17.7082 9.99999C17.7082 14.2572 14.257 17.7083 9.99984 17.7083C5.74264 17.7083 2.2915 14.2572 2.2915 9.99999C2.2915 5.74279 5.74264 2.29166 9.99984 2.29166C14.257 2.29166 17.7082 5.74279 17.7082 9.99999Z",stroke:"#F8FAFC",strokeWidth:"1.5",strokeLinecap:"round"})})}),iE=({title:e,open:t,closeDialog:r,closeProps:s,children:n,footer:i,onScroll:a,className:o})=>t?(0,S.jsx)("div",{id:"blur-dialog",className:"absolute inset-0 bg-transparent",onClick:s?.disableCloseOutside?void 0:r,onScroll:e=>{e.stopPropagation(),e.preventDefault()},onWheel:e=>{e.stopPropagation()},children:(0,S.jsxs)("div",{onClick:e=>e.stopPropagation(),className:F()(o,"absolute left-[50%] top-[50%] w-[320px] translate-x-[-50%] translate-y-[-50%]","flex flex-col","max-h-full overflow-hidden sm:max-h-[calc(min(80%,400px))]","bg-transparent","text-white","rounded-[8px] backdrop-blur-[20px]"),style:{scrollbarWidth:"none",msOverflowStyle:"none",zIndex:s_.BlurDialog.content},children:[(0,S.jsx)(iS,{label:e,className:"sticky top-0 bg-[#1B1D27]/80 px-[25px] pb-[12px] pt-[27px]",style:{zIndex:s_.BlurDialog.title},children:s?.showCloseButton&&(0,S.jsx)("button",{className:"absolute right-[15px] top-[13px] cursor-pointer",onClick:r,children:(0,S.jsx)(iI,{className:"cursor-pointer"})})}),(0,S.jsx)("div",{className:F()("flex-1 bg-[#1B1D27]/80 px-[25px]","custom-scrollbar overflow-y-auto"),onScroll:a,children:n}),i?.element&&(0,S.jsx)("div",{className:F()("px-[25px]",i.sticky&&"sticky bottom-0 bg-[#1B1D27]/80 pb-[27px] pt-[12px] shadow-lg"),style:{zIndex:s_.BlurDialog.footer},children:i.element})]})}):null,iM=()=>{let{setShowBackstage:e}=r_(),[t,r]=(0,C.useState)("terms"),[s,n]=(0,C.useState)(!0),i=(0,C.useRef)(null),[a,o]=(0,C.useState)(!1),l=()=>{i.current&&i.current.scrollIntoView({behavior:"smooth",block:"nearest"})};return{tab:t,dialogOpen:s,endOfTermsRef:i,isScrolledToEnd:a,handleScroll:e=>{let t=e.currentTarget,r=t.scrollHeight-t.scrollTop-t.clientHeight<=20;r!==a&&o(r)},handleFooterClick:e=>{e.stopPropagation(),"terms"===t&&(a?r("stream-preview"):l())},handleCloseDialog:()=>{e(!1),n(!1)},scrollToEndOfTerms:l}},iT=e=>{let{dialogOpen:t,handleCloseDialog:r,tab:s,handleScroll:n,handleFooterClick:i,isScrolledToEnd:a,endOfTermsRef:o}=iM();return(0,S.jsxs)(iE,{open:t,closeDialog:r,title:id[s],onScroll:n,footer:{element:(0,S.jsx)(ij,{activeTab:s,isEndOfTermsVisible:a,onClick:i}),sticky:!0},closeProps:{showCloseButton:!0,disableCloseOutside:!0},children:["terms"===s&&(0,S.jsxs)("div",{children:[(0,S.jsx)(iC,{}),(0,S.jsx)("div",{ref:o})]}),"stream-preview"===s&&(0,S.jsx)(iN,{...e})]})},i_=()=>{let{userChoices:e,saveAudioInputEnabled:t,saveVideoInputEnabled:r}=(0,Z.x)(),[s,n]=(0,C.useState)(e.audioEnabled),[i,a]=(0,C.useState)(e.videoEnabled);return{audioEnabled:s,videoEnabled:i,toggleAudio:(0,C.useCallback)(e=>{n(e),t(e)},[t]),toggleVideo:(0,C.useCallback)(e=>{a(e),r(e)},[r])}},iL=()=>{let{showBackstage:e}=r_(),{audioEnabled:t,videoEnabled:r,toggleAudio:s,toggleVideo:n}=i_();return e?(0,S.jsx)(no,{children:(0,S.jsxs)("div",{className:"group relative h-full w-full",children:[(0,S.jsx)(io,{isBackstage:!0}),(0,S.jsx)(ic,{audioEnabled:t,videoEnabled:r}),(0,S.jsx)(iT,{toggleAudio:s,toggleVideo:n,audioEnabled:t,videoEnabled:r})]})}):null},iA=()=>{let e=(0,W.f)(),{unmuteAudio:t}=sW(),[r,s]=(0,C.useState)(!1),{trackEvent:n}=e7(),i=(0,Z.t)([M.fQ.Source.Camera,M.fQ.Source.ScreenShare],{onlySubscribed:!0}).some(e=>!e.participant.isLocal&&e.publication.isSubscribed&&e.publication.kind===M.fQ.Kind.Video);return(0,C.useEffect)(()=>{if(!e)return;let t=()=>{let t=!e.canPlaybackAudio;e8.debug("[useRoomAudioInteraction] Audio playback status changed",{canPlaybackAudio:e.canPlaybackAudio,needsInteraction:t}),s(t)};return e.on(M.TQ.AudioPlaybackStatusChanged,t),e.startAudio().catch(()=>{s(!0)}),()=>{e.off(M.TQ.AudioPlaybackStatusChanged,t)}},[e]),(0,C.useEffect)(()=>{if(!e||!r)return;let s=()=>{e8.debug("[useRoomAudioInteraction] User interaction detected, attempting to start audio"),n("livekit_user_interaction_for_audio_playback_attempt"),e.startAudio().then(()=>{e8.debug("[useRoomAudioInteraction] room.startAudio() successful after interaction"),n("livekit_user_interaction_for_audio_playback_success"),t()}).catch(e=>{let t=e instanceof Error?e.message:String(e);e8.error("[useRoomAudioInteraction] room.startAudio() failed after user interaction",{error:t}),n("livekit_user_interaction_for_audio_playback_failure",{error:t})})},i=["click","touchstart","keydown"];return i.forEach(e=>{document.addEventListener(e,s,{once:!0,capture:!0})}),()=>{i.forEach(e=>{document.removeEventListener(e,s,{capture:!0})})}},[e,r,t,n]),{needsAudioInteraction:r,isRemoteVideoAvailable:i}},iP=()=>{let{needsAudioInteraction:e,isRemoteVideoAvailable:t}=iA();return e&&t?(0,S.jsx)("div",{className:F()("absolute inset-0","flex flex-col items-center justify-center","bg-black/50 text-white","pointer-events-none"),style:{zIndex:s_.AudioInteractionOverlay.content},children:(0,S.jsx)("p",{className:"text-lg font-semibold",children:"click anywhere to enable audio"})}):null},iR=()=>{let{hasAnyPermission:e,checkInProgress:t}=ib(),{openDialog:r}=s2();return(0,C.useEffect)(()=>{t||e||r("media-permissions")},[e,r,t]),null},iD=({onMinimize:e,onMaximize:t,Z_INDEXES:r,MinusIcon:s,ExpandIcon:n})=>(0,S.jsx)("div",{className:"absolute left-2 top-1",style:{zIndex:r.MiniView.content},children:(0,S.jsx)("div",{className:"h-[27px] w-full rounded-md bg-black/50 px-1",children:(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)("button",{onClick:e,className:"ml-[1px] flex h-4 w-4 cursor-pointer items-center justify-center font-medium opacity-[var(--container-opacity)]",children:(0,S.jsx)(s,{className:"h-5 w-5"})}),(0,S.jsx)("div",{onClick:t,className:"-ml-[2px] cursor-pointer opacity-[var(--container-opacity)] transition-colors hover:text-blue-400",children:(0,S.jsx)(n,{className:"h-6 w-6"})})]})})}),iF={top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},iU=({className:e})=>(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:(0,S.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})});function iB(e,t,r){let s=0;return Math.max(r,Math.min(((s=e.current&&e.current.parentElement?e.current.parentElement.getBoundingClientRect().height:window.innerHeight)-t)/2,s-t-r))}var iO=({children:e,onMaximize:t,defaultPosition:r={x:37,y:37},defaultSize:s={width:300,height:168.75},allowContentInteraction:n=!1})=>{let i=(0,C.useRef)(null),a=(0,C.useRef)(null),[o,l]=(0,C.useState)(1),[c,d]=(0,C.useState)(!1),[u,m]=(0,C.useState)(r),[p,h]=(0,C.useState)(s),[g,f]=(0,C.useState)(r),x=(0,C.useCallback)(()=>{if(!i.current||!a.current||c)return;let e=a.current.getBoundingClientRect(),t=i.current.getBoundingClientRect();t.width>e.width||t.height>e.height?l(Math.min(e.width/t.width,e.height/t.height)):l(1)},[c]);(0,C.useEffect)(()=>{if(x(),"undefined"!=typeof window)return window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[e,x]),(0,C.useEffect)(()=>{if(c){let e=iB(a,80,8);m(t=>({...t,y:e}))}},[c]);let v=()=>{c?m(g):(f(u),m({x:0,y:iB(a,80,8)})),d(!c)};(0,C.useEffect)(()=>{let e=()=>{if(c){let e=iB(a,80,8);m(t=>({...t,y:e}))}};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[c]);let b=(0,S.jsxs)("div",{ref:a,className:F()("relative flex flex-col text-white shadow-[0px_0px_10px_rgba(0,0,0,0.2)] backdrop-blur-[10px] transition-[--container-opacity] duration-300 ease-in-out [--container-opacity:0.5] hover:[--container-opacity:1]",c?"h-[80px] w-[24px] rounded-r-[4px] !bg-black/50 p-0":"h-full w-full rounded-[4px]"),children:[!c&&(0,S.jsx)(iD,{onMinimize:v,onMaximize:t,Z_INDEXES:s_,MinusIcon:iU,ExpandIcon:sP}),c&&(0,S.jsx)("button",{onClick:v,"aria-label":"Expand mini-view",className:"absolute left-0 top-0 flex h-full w-full cursor-pointer items-center justify-center p-2 text-lg font-medium opacity-[var(--container-opacity)] transition-colors hover:text-blue-400",style:{zIndex:s_.MiniView.content},children:(0,S.jsx)(ne,{className:"h-6 w-6 transition-transform duration-300",direction:"right"})}),!c&&(0,S.jsx)("div",{ref:i,className:"flex flex-1 cursor-grabbing items-center justify-center overflow-hidden rounded-[4px] font-bold opacity-[var(--container-opacity)]",style:{transform:1!==o?`scale(${o})`:"none",transformOrigin:"center"},children:(0,S.jsx)("div",{className:F()("h-full w-full",!n&&"pointer-events-none"),children:e})})]});return(0,S.jsx)(ed.s,{lockAspectRatio:!c,default:{x:r.x,y:r.y,width:c?24:s.width,height:c?80:s.height},size:c?{width:24,height:80}:p,position:u,minWidth:c?24:200,minHeight:c?80:112.5,bounds:"parent",disableDragging:c,enableResizing:!c&&iF,onDragStop:function(e,t){c||m({x:t.x,y:t.y})},onResize:function(e,t,r,s,n){c||(x(),h({width:parseInt(r.style.width),height:parseInt(r.style.height)}),m(n))},className:"shadow-[0px_0px_10px_rgba(0,0,0,0.2)]",style:{zIndex:s_.MiniView.rnd},children:b})},i$=({livestreamId:e,mintId:t,onSuccess:r,onError:s,onSettled:n})=>{let{localParticipant:i}=(0,Z.C)(),{trackEvent:a}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useAcceptInvite] Attempting to accept invite via API",{livestreamId:e,mintId:t,localIdentity:i?.identity})},mutationFn:async()=>{if(!i?.identity)throw Error("Local participant identity not available for accept invite");return ts.post("livestream/participant/accept-invite",{json:{livestreamId:e,mintId:t,identity:i.identity}}).json()},onSuccess:s=>{a("livestream_stage_invite_response_success",{accepted:!0,mintId:t}),e8.debug("[useAcceptInvite] Successfully accepted invite",{livestreamId:e,mintId:t,localIdentity:i?.identity}),r?.(s)},onError:r=>{let n=r.message||"Unknown error during accept invite";a("livestream_stage_invite_response_failure",{error:n,mintId:t}),e8.error("[useAcceptInvite] Failed to accept invite",{livestreamId:e,mintId:t,localIdentity:i?.identity,error:n}),s?.(r)},onSettled:n})},iV=({livestreamId:e,mintId:t,onSuccess:r,onError:s,onSettled:n})=>{let{localParticipant:i}=(0,Z.C)(),{trackEvent:a}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useDeclineInvite] Attempting to decline invite via API",{livestreamId:e,mintId:t,localIdentity:i?.identity})},mutationFn:async()=>{if(!i?.identity)throw Error("Local participant identity not available for decline invite");return ts.post("livestream/participant/decline-invite",{json:{livestreamId:e,mintId:t,identity:i.identity}}).json()},onSuccess:s=>{a("livestream_stage_invite_response_success",{accepted:!1,mintId:t}),e8.debug("[useDeclineInvite] Successfully declined invite",{livestreamId:e,mintId:t,localIdentity:i?.identity}),r?.(s)},onError:r=>{let n=r.message||"Unknown error during decline invite";a("livestream_stage_invite_response_failure",{error:n,mintId:t}),e8.error("[useDeclineInvite] Failed to decline invite",{livestreamId:e,mintId:t,localIdentity:i?.identity,error:n}),s?.(r)},onSettled:n})},iq=()=>{let{isOpen:e,closeDialog:t}=s2(),{mintId:r}=r_(),s=s3(r),{mutate:n,isPending:i}=i$({livestreamId:s?.id??0,mintId:r}),{mutate:a,isPending:o}=iV({livestreamId:s?.id??0,mintId:r}),l=i||o,c=(0,C.useCallback)(()=>{a(),t()},[a,t]),d=(0,C.useCallback)(()=>{n(),t()},[n,t]);return(0,S.jsxs)(iE,{title:"request to join stage",open:e,closeDialog:c,closeProps:{showCloseButton:!0},children:[(0,S.jsx)("p",{className:"text-xs text-livestream-muted",children:"the host has invited you to join the stage as a speaker"}),(0,S.jsxs)("div",{className:"flex flex-col gap-3 pb-6 pt-3",children:[(0,S.jsx)(ig,{label:"join",onClick:d,disabled:l}),(0,S.jsx)(ig,{label:"decline",variant:"secondary",size:"medium",appearance:"outline",onClick:c,disabled:l})]})]})},iH=e=>{let t=(0,N.NL)(),{trackEvent:r}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useCloseLivestream] Attempting to close livestream via API",{mintId:e.mintId})},mutationFn:async()=>ts.post("livestream/close",{json:e}).json(),onSuccess:s=>{r("livekit_end_stream_success",{mintId:e.mintId,reason:"closed"}),e8.debug("[useCloseLivestream] Successfully closed livestream, invalidating query",{mintId:e.mintId}),t.invalidateQueries({queryKey:[td,e.mintId]}),e.onSuccess(s)},onError:t=>{r("livekit_end_stream_failure",{error:t.message||"Unknown error during close livestream",mintId:e.mintId}),e8.error("[useCloseLivestream] Failed to close livestream",{mintId:e.mintId,error:t.message})}})},iQ=()=>{let{mintId:e,resetContext:t}=r_(),{closeDialog:r}=s2(),{trackEvent:s}=e7(),{mutateAsync:n}=iH({mintId:e,onSuccess:()=>{t()}});return{endStream:async()=>{e8.debug("[useEndStream] Attempting to end stream",{mintId:e}),s("livekit_end_stream_attempt",{mintId:e});try{await n()}catch(t){throw e8.error("[useEndStream] closeLivestream mutation failed in useEndStream",{mintId:e,error:t}),t}r()}}},iz=()=>{let{isOpen:e,closeDialog:t}=s2(),{endStream:r}=iQ(),s=(0,S.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,S.jsx)(ig,{label:"cancel",onClick:t,variant:"secondary",appearance:"outline",size:"medium"}),(0,S.jsx)(ig,{label:"ok",onClick:r,className:"!px-[32px]"})]});return(0,S.jsx)(iE,{title:"End Stream",open:e,closeDialog:t,footer:{element:s,sticky:!0},closeProps:{showCloseButton:!0},children:(0,S.jsx)("p",{className:"text-[12px] leading-[16px]",children:"This will end the stream, and all participants will be kicked out. Proceed?"})})},iG=({className:e})=>(0,S.jsx)("div",{className:"flex items-center justify-center",children:(0,S.jsx)(B.Z,{strokeWidth:3,className:F()("h-[1em] w-[1em] animate-spin duration-100",e)})}),iZ=({text:e,resetTimeoutSeconds:t=1.5})=>{let[r,s]=(0,C.useState)(!1);return{isCopied:r,copy:(0,C.useCallback)(async()=>{try{await navigator.clipboard.writeText(e),s(!0),setTimeout(()=>s(!1),1e3*t)}catch(e){e8.error("[useCopyText] Failed to copy text",{error:e instanceof Error?e.message:String(e)})}},[e,t])}},iW=({className:e,copied:t})=>(0,S.jsx)("div",{className:e,children:t?(0,S.jsx)(eu.Z,{size:16}):(0,S.jsx)(em.Z,{size:16})}),iK=({text:e,className:t,icon:r,iconLabel:s})=>{let{isCopied:n,copy:i}=iZ({text:e});return(0,S.jsx)("div",{className:F()(t),children:(0,S.jsx)(sL,{...sT,content:n?"Copied":`Copy ${s}`,className:"!bg-gray-200 !text-black",children:(0,S.jsxs)("div",{className:F()("cursor-pointer rounded-md","flex items-center"),onClick:i,children:[r&&(0,S.jsx)("div",{className:"mr-4",children:r}),(0,S.jsx)("p",{className:"mr-2 truncate text-xs text-white",children:e}),(0,S.jsx)(iW,{copied:n,className:F()(n?"text-livestream-green":"text-livestream-muted")})]})})})},iJ=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)(ep.Z,{})}),iY=({className:e})=>(0,S.jsx)("div",{className:e,children:(0,S.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,S.jsx)("path",{d:"M12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 6.89137 17.1086 2.75 12 2.75M12 21.25C6.89137 21.25 2.75 17.1086 2.75 12C2.75 6.89137 6.89137 2.75 12 2.75M12 21.25C9.65279 21.25 7.75 17.1086 7.75 12C7.75 6.89137 9.65279 2.75 12 2.75M12 21.25C14.3472 21.25 16.25 17.1086 16.25 12C16.25 6.89137 14.3472 2.75 12 2.75M21 12H3",stroke:"#F8FAFC",strokeWidth:"1.5",strokeLinecap:"square"})})}),iX=()=>{let{rtmpCredentials:e}=sW(),{isOpen:t,closeDialog:r}=s2();return(0,S.jsxs)(iE,{title:"RTMP stream",open:t,closeDialog:r,closeProps:{showCloseButton:!0},children:[(0,S.jsx)("p",{className:"text-xs text-livestream-muted",children:"add the url and key below to your streaming software to stream directly in there. you will still need to keep this page open"}),(0,S.jsxs)("div",{className:"flex flex-col gap-2 pb-6 pt-2",children:[!e&&(0,S.jsx)(iG,{}),e&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(iK,{text:e.url,icon:(0,S.jsx)(iY,{}),iconLabel:"url"}),(0,S.jsx)(iK,{text:e.streamKey,icon:(0,S.jsx)(iJ,{}),iconLabel:"key"})]})]})]})},i0=()=>{let{localParticipant:e}=(0,Z.C)(),{trackEvent:t}=e7();return{sendCommandToParticipant:(0,C.useCallback)(async(r,s)=>{if(!e){e8.error("[useHostCommandEmitter] Cannot send command: LocalParticipant not available.");return}if(!r){e8.error("[useHostCommandEmitter] Cannot send command: No target identity provided.");return}let n=eW.from(JSON.stringify(s),"utf-8");t("livekit_data_publish_attempt",{targetIdentity:[r],command:s});try{e8.info("[useHostCommandEmitter] Sending command to participant",{targetIdentity:r,command:s}),await e.publishData(n,{destinationIdentities:[r],reliable:!0}),t("livekit_data_publish_success",{targetIdentity:[r],command:s})}catch(n){let e=n instanceof Error?n.message:String(n);e8.error("[useHostCommandEmitter] Failed to send command",{error:e,command:s,targetIdentity:r}),t("livekit_data_publish_failure",{error:e,targetIdentity:[r],command:s})}},[e,t])}},i1=()=>{let{isOpen:e,closeDialog:t,payload:r}=s2(),{localParticipant:s}=(0,Z.C)(),{sendCommandToParticipant:n}=i0(),i=async()=>{r?.participantToStop&&await n(r.participantToStop.identity,{messageType:"HOST_COMMAND",payload:{type:"STOP_YOUR_SCREENSHARE"}}),s.setScreenShareEnabled(!0),t()},a=(0,S.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,S.jsx)(ig,{label:"cancel",onClick:()=>{t()},variant:"secondary",size:"medium",appearance:"outline"}),(0,S.jsx)(ig,{label:"confirm",onClick:i,className:"!px-[32px]"})]});return(0,S.jsx)(iE,{title:"start screen share?",open:e,closeDialog:t,footer:{element:a,sticky:!0},closeProps:{showCloseButton:!0},children:(0,S.jsx)("p",{className:"text-[12px] leading-[16px]",children:"starting your screen share will stop the current one. continue?"})})},i2=(e,t)=>{let[r,s]=(0,C.useState)(e);if(e<0)throw Error("Seconds must be greater than 0");return(0,C.useEffect)(()=>{let n=setInterval(()=>{s(e=>Math.max(e-1,0)),0===r&&(e8.debug("[useCountdown] Countdown completed",{initialSeconds:e}),t?.onComplete?.(),clearInterval(n))},1e3);return()=>clearInterval(n)},[e,t]),r},i4=()=>{let{isOpen:e,closeDialog:t}=s2(),{endStream:r}=iQ(),{hasAnyPermission:s}=ib(),n=i2(60,{onComplete:()=>{r()}});return(0,C.useEffect)(()=>{s&&t()},[s,t]),(0,S.jsxs)(iE,{title:"allow media sharing",open:e,closeDialog:t,closeProps:{showCloseButton:!1,disableCloseOutside:!0},children:[(0,S.jsx)("p",{className:"text-[12px] text-white",children:"you must grant access to either your camera or microphone for the stream to continue. You will be able to mute them later."}),n&&(0,S.jsxs)("p",{className:"mb-[20px] text-[12px] text-white",children:["if no permission is granted, the stream will stop in ",n," ","seconds."]})]})},i3=({onClick:e,disabled:t,loading:r})=>(0,S.jsx)(ig,{onClick:e,disabled:t,label:"yes",size:"small",icon:r?(0,S.jsx)(en.Z,{className:"h-4 w-4 animate-spin"}):void 0}),i5=({onClick:e,disabled:t,loading:r})=>(0,S.jsx)(ig,{onClick:e,disabled:t,label:"invite",size:"small",icon:r?(0,S.jsx)(en.Z,{className:"h-4 w-4 animate-spin"}):void 0}),i6=({onClick:e,disabled:t,loading:r})=>(0,S.jsx)(ig,{onClick:e,disabled:t,icon:r?(0,S.jsx)(en.Z,{className:"h-4 w-4 animate-spin"}):void 0,label:"no",size:"small",className:"!bg-[#E77975]"}),i8=({onClick:e,disabled:t,loading:r,className:s,style:n})=>(0,S.jsx)(ig,{onClick:e,disabled:t,label:"remove",size:"small",className:F()("!bg-[#E77975]",s),icon:r?(0,S.jsx)(en.Z,{className:"h-4 w-4 animate-spin"}):void 0,style:n}),i7=({livestreamId:e,mintId:t,targetIdentity:r,onSuccess:s,onError:n,onSettled:i})=>{let{trackEvent:a}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useAddToStage] Attempting to add to stage via API",{livestreamId:e,mintId:t,targetIdentity:r})},mutationFn:async()=>await ts.post("livestream/participant/add-to-stage",{json:{livestreamId:e,mintId:t,identity:r}}).json(),onSuccess:n=>{a("livestream_stage_invite_or_add_success",{userId:r,mintId:t,actionType:"add"}),e8.debug("[useAddToStage] Successfully added to stage",{livestreamId:e,mintId:t,targetIdentity:r}),s?.(n)},onError:s=>{let i=s.message||"Unknown error during add to stage";a("livestream_stage_invite_or_add_failure",{error:i,userId:r,mintId:t,actionType:"add"}),e8.error("[useAddToStage] Failed to add to stage",{livestreamId:e,mintId:t,targetIdentity:r,error:i}),n?.(s)},onSettled:i})},i9=({livestreamId:e,mintId:t,targetIdentity:r,onSuccess:s,onError:n,onSettled:i})=>{let{trackEvent:a}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useInviteToStage] Attempting to invite to stage via API",{livestreamId:e,mintId:t,targetIdentity:r})},mutationFn:async()=>ts.post("livestream/participant/invite-to-stage",{json:{livestreamId:e,mintId:t,identity:r}}).json(),onSuccess:n=>{a("livestream_stage_invite_or_add_success",{userId:r,mintId:t,actionType:"invite"}),e8.debug("[useInviteToStage] Successfully invited to stage",{livestreamId:e,targetIdentity:r}),s?.(n)},onError:s=>{let i=s.message||"Unknown error during invite to stage";a("livestream_stage_invite_or_add_failure",{error:i,userId:r,mintId:t,actionType:"invite"}),e8.error("[useInviteToStage] Failed to invite to stage",{livestreamId:e,targetIdentity:r,error:i}),n?.(s)},onSettled:i})},ae=({livestreamId:e,mintId:t,targetIdentity:r,onSuccess:s,onError:n,onSettled:i})=>{let{trackEvent:a}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useLowerHand] Attempting to lower hand via API",{livestreamId:e,mintId:t,targetIdentity:r})},mutationFn:async()=>ts.post("livestream/participant/lower-hand",{json:{livestreamId:e,mintId:t,identity:r}}).json(),onSuccess:n=>{a("livestream_hand_raise_state_changed",{raised:!1,mintId:t}),e8.debug("[useLowerHand] Successfully lowered hand",{livestreamId:e,targetIdentity:r}),s?.(n)},onError:t=>{e8.error("[useLowerHand] Failed to lower hand",{livestreamId:e,targetIdentity:r,error:t.message}),n?.(t)},onSettled:i})},at=({livestreamId:e,mintId:t,targetIdentity:r,onSuccess:s,onError:n,onSettled:i})=>{let{trackEvent:a}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useRemoveFromStage] Attempting to remove from stage via API",{livestreamId:e,mintId:t,targetIdentity:r})},mutationFn:async()=>ts.post("livestream/participant/remove-from-stage",{json:{livestreamId:e,mintId:t,identity:r}}).json(),onSuccess:n=>{a("livestream_stage_remove_participant_success",{self:!1,removedUserId:r,mintId:t}),e8.debug("[useRemoveFromStage] Successfully removed from stage",{livestreamId:e,targetIdentity:r}),s?.(n)},onError:s=>{let i=s.message||"Unknown error during remove from stage";a("livestream_stage_remove_participant_failure",{error:i,self:!1,removedUserId:r,mintId:t}),e8.error("[useRemoveFromStage] Failed to remove from stage",{livestreamId:e,targetIdentity:r,error:i}),n?.(s)},onSettled:i})},ar=({enrichedParticipant:e,livestreamId:t,mintId:r})=>{let{participant:s,metadataObject:n}=e,{mutate:i,isPending:a}=i7({livestreamId:t,mintId:r,targetIdentity:s.identity,onError:e=>{}}),{mutate:o,isPending:l}=ae({livestreamId:t,mintId:r,targetIdentity:s.identity,onError:e=>{}}),{mutate:c,isPending:d}=at({livestreamId:t,mintId:r,targetIdentity:s.identity,onError:e=>{}}),{mutate:u,isPending:m}=i9({livestreamId:t,mintId:r,targetIdentity:s.identity,onError:e=>{}}),p=n?.role==="viewer"&&n?.hand_raised;return{addToStage:i,isAdding:a,lowerHand:o,isLowering:l,removeFromStage:c,isRemoving:d,inviteToStage:u,isInviting:m,canAdd:p,canLowerHand:n?.hand_raised,canRemove:n?.role==="co-host",canInvite:n?.role==="viewer"&&!n?.invited_to_stage&&!n?.hand_raised}},as=({enrichedParticipant:e,livestreamId:t,mintId:r})=>{let{addToStage:s,isAdding:n,lowerHand:i,isLowering:a,removeFromStage:o,isRemoving:l,inviteToStage:c,isInviting:d,canAdd:u,canLowerHand:m,canRemove:p,canInvite:h}=ar({enrichedParticipant:e,livestreamId:t,mintId:r}),g=n||a||l||d;return(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[u&&(0,S.jsx)(i3,{onClick:()=>s(),disabled:g,loading:n}),m&&(0,S.jsx)(i6,{onClick:()=>i(),disabled:g,loading:a}),p&&(0,S.jsx)(i8,{onClick:()=>o(),disabled:g,loading:l}),h&&(0,S.jsx)(i5,{onClick:()=>c(),disabled:g,loading:d})]})},an=({enrichedParticipant:e})=>{let{mintId:t}=r_(),r=s3(t),{displayName:s,isCurrentUser:n,metadataObject:i}=e,{value:a,setTrue:o,setFalse:l}=su(!1),{isHost:c}=sF(),d=i?.anon===!1;return(0,S.jsxs)("div",{className:"flex h-[26px] items-center justify-between gap-2 rounded-lg pl-1 pr-2 hover:bg-white/10",onMouseEnter:o,onMouseLeave:l,children:[(0,S.jsxs)("div",{className:"flex items-center gap-2 overflow-hidden",children:[i?.hand_raised&&i?.role==="viewer"&&d&&(0,S.jsx)(eg.Z,{className:"h-4 w-4 text-livestream-green"}),(0,S.jsx)(st,{src:i?.avatar_image,size:16,alt:s}),(0,S.jsx)("p",{className:"truncate whitespace-nowrap text-xs font-bold",children:s}),n&&(0,S.jsx)("p",{className:"text-xs font-bold",children:"(you)"})]}),(0,S.jsx)("div",{className:"flex items-center gap-2",children:c&&!n&&d&&a?(0,S.jsx)(as,{enrichedParticipant:e,livestreamId:r?.id??0,mintId:r?.mintId??""}):i?.followers!==void 0&&(0,S.jsxs)("p",{className:"text-xs text-livestream-muted",children:[i.followers||0," followers"]})})]})},ai=({title:e,participants:t})=>(0,S.jsxs)("div",{className:"flex max-w-xs flex-col gap-2",children:[(0,S.jsx)("div",{className:"ml-1 text-xs font-bold lowercase text-livestream-muted",children:e}),(0,S.jsx)("div",{className:"flex flex-col gap-2",children:t.map(e=>(0,S.jsx)(an,{enrichedParticipant:e},e.participant.identity))})]}),aa=()=>{let{isOpen:e,closeDialog:t}=s2(),{host:r,coHosts:s,viewers:n,aiModerators:i}=sD();return e?(0,S.jsx)(eh.Vq,{open:e,onOpenChange:e=>{e||t()},children:(0,S.jsxs)(eh.cZ,{className:F()("absolute right-[12px] top-[36px]","h-[calc(100%-92px)] max-h-[400px] !min-w-[300px] max-w-full  bg-[#1B1D27]/80 px-3 pb-[33px] pt-4 text-white","rounded-[8px] backdrop-blur-[20px]","custom-scrollbar overflow-y-auto","z-50"),style:{zIndex:`${s_.ParticipantsDialog.content} !important`},children:[(0,S.jsx)(eh.$N,{children:(0,S.jsxs)("div",{className:"ml-1 flex items-center justify-between",children:[(0,S.jsx)(iS,{label:"Stream Participants"}),(0,S.jsx)(eh.GG,{children:(0,S.jsx)(iI,{})})]})}),(0,S.jsx)(eh.Be,{className:"sr-only",children:"A list of participants currently in the livestream."}),(0,S.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[r&&(0,S.jsx)(ai,{title:"Host",participants:[r]}),s.length>0&&(0,S.jsx)(ai,{title:s.length>1?"Co-Hosts":"Co-Host",participants:s}),i.length>0&&(0,S.jsx)(ai,{title:"Moderators",participants:i}),n.length>0&&(0,S.jsx)(ai,{title:"Viewers",participants:n})]})]})}):null},ao=e=>(0,S.jsx)(ef.fC,{value:e.selectedValue,onValueChange:e.onChange,className:F()(e.className,"mb-[12px] flex flex-col gap-[12px]"),children:e.options.map(t=>(0,S.jsxs)("div",{className:"flex cursor-pointer items-center gap-[4px]",onClick:()=>e.onChange(t.value),children:[(0,S.jsx)("div",{className:F()("relative aspect-square h-[17px] rounded-full border-[1.5px] border-white"),children:t.value===e.selectedValue&&(0,S.jsx)("div",{className:"absolute left-1/2 top-1/2 aspect-square h-[7px] -translate-x-1/2 -translate-y-1/2 rounded-full bg-white"})}),(0,S.jsx)(ef.ck,{value:t.value,className:"text-[12px] lowercase text-white",children:t.label})]},t.value))}),al=e=>(0,S.jsx)("textarea",{className:F()("w-full rounded-[8px] border border-white p-2 text-[12px] leading-[16px]","bg-transparent text-white placeholder:text-livestream-muted","resize-none focus:outline-none focus:ring-0",e.className),placeholder:e.placeholder,value:e.value,onChange:t=>e.onChange(t.target.value),maxLength:e.maxLength}),ac="can-report-livestream",ad=({mintId:e,enabled:t,onSuccess:r})=>{let{trackEvent:s}=e7();return(0,I.a)({queryKey:[ac,e],queryFn:async()=>{s("common_check_can_report_livestream_attempt",{mintId:e}),e8.debug("[useCanReportLivestream] Attempting to fetch canReport status",{mintId:e});let t=new URLSearchParams;t.set("mintId",e);try{let n=await ts.get(`livestream-reports/can-report?${t.toString()}`).json();return r?.(n),s("common_check_can_report_livestream_success",{mintId:e,canReport:n?.canReport??!1}),n}catch(r){let t=r instanceof Error?r.message:String(r);throw e8.error("[useCanReportLivestream] Fetch failed",{mintId:e,error:t}),s("common_check_can_report_livestream_failure",{mintId:e,error:t}),r}},refetchInterval:6e5,enabled:t})},au=e=>{let t=(0,N.NL)(),{trackEvent:r}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useReportLivestream] Attempting to report livestream via API",{mintId:e.mintId,reason:e.reason})},mutationFn:async()=>ts.post("livestream-reports/report",{json:e}).json(),onSuccess:t=>{r("livestream_report_success",{mintId:e.mintId,reason:e.reason}),e8.debug("[useReportLivestream] Successfully reported livestream",{mintId:e.mintId,reason:e.reason}),e.onSuccess(t)},onError:t=>{let s=t.message||"Unknown error during report livestream";r("livestream_report_failure",{error:s,mintId:e.mintId}),e8.error("[useReportLivestream] Failed to report livestream",{mintId:e.mintId,reason:e.reason,error:s}),e.onError?.(t)},onSettled:()=>{t.invalidateQueries({queryKey:[ac,e.mintId]})}})},am=((h=am||{}).SPAM="spam",h.ILLEGAL="illegal",h.UNSAFE="unsafe",h.OTHER="other",h),ap=()=>{let{isOpen:e,closeDialog:t}=s2(),{mintId:r}=r_(),[s,n]=(0,C.useState)("spam"),[i,a]=(0,C.useState)(""),{data:o}=ad({mintId:r}),{mutate:l,isPending:c}=au({mintId:r,reason:s,description:i,onSuccess:()=>{t()}}),d=(0,C.useMemo)(()=>Object.values(am).map(e=>({label:e,value:e})),[]);return o?.canReport===!1?(0,S.jsx)(iE,{title:"thank you for your report",open:e,closeDialog:t,closeProps:{showCloseButton:!0},children:(0,S.jsx)("p",{className:"pb-[40px] text-[12px] text-white",children:"our team is reviewing your previous report\nthank you for your patience"})}):(0,S.jsxs)(iE,{title:"Report this stream",open:e,closeDialog:t,footer:{element:(0,S.jsx)(ig,{label:"submit",onClick:l,className:"w-full",disabled:c}),sticky:!0},closeProps:{showCloseButton:!0,disableCloseOutside:!0},children:[(0,S.jsx)(ao,{options:d,selectedValue:s,onChange:n}),(0,S.jsx)(al,{className:"h-[100px]",placeholder:"share more details if you'd like...",value:i,onChange:a,maxLength:200})]})},ah=()=>{let{dialogType:e,isOpen:t}=s2();if(!t)return null;switch(e){case"end-stream":return(0,S.jsx)(iz,{});case"report-livestream":return(0,S.jsx)(ap,{});case"media-permissions":return(0,S.jsx)(i4,{});case"participants":return(0,S.jsx)(aa,{});case"host-takeover-screenshare":return(0,S.jsx)(i1,{});case"get-rtmp-keys":return(0,S.jsx)(iX,{});case"accept-invite-to-stage":return(0,S.jsx)(iq,{})}},ag=({raisedHandParticipant:e,onClickAction:t})=>{let{mintId:r}=r_(),s=s3(r),{addToStage:n,isAdding:i,lowerHand:a,isLowering:o}=ar({enrichedParticipant:e,livestreamId:s?.id??0,mintId:r}),l=(0,C.useCallback)(()=>{n(),t()},[n,t]),c=(0,C.useCallback)(()=>{a(),t()},[a,t]);return(0,S.jsxs)("div",{className:"flex items-center gap-1",children:[(0,S.jsx)(i3,{onClick:l,disabled:i}),(0,S.jsx)(i6,{onClick:c,disabled:o})]})},af=()=>{let{isHost:e}=sF(),{viewers:t}=sD(),[r,s]=(0,C.useState)(!1),{raisedHandCount:n,raisedHandParticipant:i}=(0,C.useMemo)(()=>{let r=t.filter(e=>e.metadataObject?.hand_raised),n=r.length,i=1===n?r[0]:null;return s(e&&n>0),{raisedHandCount:n,raisedHandParticipant:i}},[t,e]);return{showIndicator:r,setShowIndicator:s,raisedHandCount:n,raisedHandParticipant:i}},ax=(e,t)=>{if(!t||1!==e)return`${e} ${1===e?"hand":"hands"} raised`;{let e=rk(t.participant);return`user ${e} wants to speak`}},av=()=>{let{showIndicator:e,setShowIndicator:t,raisedHandCount:r,raisedHandParticipant:s}=af(),{openDialog:n}=s2();if(!e)return null;let i=ax(r,s);return(0,S.jsxs)("div",{className:F()("bg-black/50 px-3 py-1.5 text-xs text-white shadow-lg","flex items-center gap-2 rounded-full"),"aria-live":"polite",children:[(0,S.jsxs)("div",{className:"flex cursor-pointer items-center gap-2",onClick:()=>{n("participants"),t(!1)},children:[(0,S.jsx)(eg.Z,{className:"h-4 w-4 text-livestream-green"}),(0,S.jsx)("span",{children:i})]}),s&&(0,S.jsx)(ag,{raisedHandParticipant:s,onClickAction:()=>t(!1)})]})},ab=({livestreamId:e,mintId:t,identity:r,onSuccess:s,onError:n,onSettled:i})=>{let{trackEvent:a}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useRaiseHand] Attempting to raise hand via API",{livestreamId:e,mintId:t,identity:r})},mutationFn:async()=>ts.post("livestream/participant/raise-hand",{json:{livestreamId:e,mintId:t,identity:r}}).json(),onSuccess:n=>{a("livestream_hand_raise_state_changed",{raised:!0,mintId:t}),e8.debug("[useRaiseHand] Successfully raised hand",{livestreamId:e,identity:r}),s?.(n)},onError:t=>{e8.error("[useRaiseHand] Failed to raise hand",{livestreamId:e,identity:r,error:t.message}),n?.(t)},onSettled:i})},ay=()=>{let[e,t]=(0,C.useState)(null),{mintId:r}=r_(),s=s3(r),{localParticipant:n}=(0,Z.C)(),{metadataObject:i}=sF(),a=!!i?.hand_raised,o={livestreamId:s?.id??0,mintId:r,identity:n.identity,targetIdentity:n.identity,onError:e=>{e8.error("[useHandRaiseToggle] Mutation error, resetting optimistic state",{error:e}),t(null)},onSettled:()=>{t(null)}},{mutate:l,isPending:c}=ab({...o}),{mutate:d,isPending:u}=ae({...o}),m=c||u;return{isRaisePending:c,isLowerPending:u,displayRaised:e??a,toggleHand:()=>{if(m||!s?.id){e8.debug("[useHandRaiseToggle] Toggle hand skipped",{isPending:m,hasLivestreamId:!!s?.id});return}a?(e8.debug("[useHandRaiseToggle] Attempting to lower hand",{currentIsHandRaised:a}),t(!1),d()):(e8.debug("[useHandRaiseToggle] Attempting to raise hand",{currentIsHandRaised:a}),t(!0),l())}}},aw=({className:e})=>{let{isRaisePending:t,isLowerPending:r,displayRaised:s,toggleHand:n}=ay(),i=nq(),a=!i||t||r;return(0,S.jsx)(sL,{content:a?i?void 0:"login to request to join the stage":s?"cancel request":"request to join the stage",...sT,children:(0,S.jsxs)("div",{className:F()("flex flex-col justify-center gap-1 rounded-xl px-3 py-2",a&&"cursor-not-allowed opacity-50",!a&&"cursor-pointer hover:opacity-80",s?"text-livestream-green":"text-white","bg-[#1B1D27]/60",e),onClick:a?void 0:n,children:[(0,S.jsx)("div",{className:"flex w-full justify-center",children:(0,S.jsx)(nh,{})}),(0,S.jsx)("p",{className:"text-xs",children:t?"requesting...":r?"cancelling...":s?"request sent":"request"})]})})},aj=({isInvited:e,className:t,style:r})=>{let{localParticipant:s}=(0,Z.C)(),{openDialog:n}=s2();return(0,C.useEffect)(()=>{s.identity&&e&&n("accept-invite-to-stage")},[s.identity,e,n]),(0,S.jsx)("div",{className:F()(t),style:r,children:!e&&(0,S.jsx)(aw,{})})},ak=({isMuted:e,className:t})=>(0,S.jsx)("div",{className:F()("text-xs",t),style:{zIndex:s_.ParticipantVideoTile.gradientOverlay+1},children:e?(0,S.jsx)(np,{className:"h-full w-full text-white",size:16}):(0,S.jsx)(nh,{className:"h-full w-full text-white",size:16})}),aN=({participant:e,isScreensharing:t=!1,className:r,style:s})=>{let n=!e.isMicrophoneEnabled,i=rk(e,t);return(0,S.jsxs)("div",{className:F()("flex items-center gap-1 truncate px-1 py-0.5 text-xs font-bold text-white",r),style:s,children:[(0,S.jsx)(ak,{isMuted:n}),i]})},aC=({trackRef:e})=>{let{isHost:t,globalPins:r,addGlobalPin:s,removeGlobalPin:n,effectivePins:i,localPins:a,localUnpins:o,addLocalPin:l,removeLocalPin:c,addLocalUnpin:d,removeLocalUnpin:u}=sW(),m=(0,W.a1)(e)&&!!e.publication,p=m?e.publication.trackSid:null,h=(0,C.useMemo)(()=>!!p&&r.some(e=>e.trackSid===p),[r,p]),g=(0,C.useMemo)(()=>!!p&&!t&&a.some(e=>e.trackSid===p),[a,p,t]),f=(0,C.useMemo)(()=>!!p&&!t&&o.includes(p),[o,p,t]),x=(0,C.useMemo)(()=>!!m&&!!p&&(t?h:i.some(e=>e.publication?.trackSid===p)),[m,p,t,h,i]),v=!m,b=(0,C.useCallback)(()=>{if(v||!p||!m){e8.debug("[usePinAction] Pin toggle on disabled/unpinnable track",{isDisabled:v,currentTrackSid:p,canPinTrack:m});return}t?x?n(p):s(e):x?g?c(p):h&&!f&&d(p):(l(e),h&&f&&u(p))},[v,p,t,x,h,g,f,n,s,l,c,d,u,e,m]),y=(0,C.useMemo)(()=>t?x?"Unpin Globally":"Pin Globally":x?"Unpin for Me":"Pin for Me",[t,x]),w=(0,C.useMemo)(()=>m?y:"Cannot pin this item",[m,y]);return{canPin:m,isPinned:x,isDisabled:v,buttonLabel:y,tooltipContent:w,handlePinToggle:b}},aS=(0,C.forwardRef)(({className:e,width:t=24,height:r=24},s)=>(0,S.jsx)(ex.Z,{ref:s,className:e,width:t,height:r,strokeWidth:2}));aS.displayName="PinIcon";var aI=(0,C.forwardRef)(({className:e,width:t=24,height:r=24},s)=>(0,S.jsx)(ev.Z,{ref:s,className:e,width:t,height:r,strokeWidth:2}));aI.displayName="PinOffIcon";var aE=({trackRef:e,className:t,style:r})=>{let{canPin:s,isPinned:n,isDisabled:i,tooltipContent:a,handlePinToggle:o}=aC({trackRef:e});return s?(0,S.jsx)(sL,{content:a,...sT,children:(0,S.jsx)("div",{className:F()("text-white",i?"cursor-not-allowed opacity-50":"cursor-pointer",t),style:r,onClick:i?void 0:o,children:n?(0,S.jsx)(aI,{className:"h-4 w-4"}):(0,S.jsx)(aS,{className:"h-4 w-4"})})}):null},aM=()=>(0,S.jsx)("div",{className:"absolute bottom-1 right-1",style:{zIndex:s_.ParticipantVideoTile.gradientOverlay+1},children:(0,S.jsx)(eb.nI,{src:"/livestreams/speaking.lottie",className:"w-8",autoplay:!0,loop:!0})}),aT=()=>(0,S.jsx)(il,{width:60}),a_=({participant:e,size:t})=>{let r=rj(e).avatar_image,s=(0,Z.H)(e);return(0,S.jsx)("div",{className:F()("w-fit rounded-full border-4 p-1 transition-colors duration-300 ease-in-out",s&&"big"===t?"border-livestream-green/70":"border-transparent"),children:(0,S.jsx)(st,{src:r,alt:e.identity,size:"big"===t?70:42,className:"aspect-square overflow-hidden rounded-full border border-livestream-muted/30 bg-black"})})},aL=({className:e,participant:t,size:r="small"})=>(0,S.jsx)("div",{className:F()(e,"big"===r?"bg-black":"bg-[#2A2C36]","flex h-full w-full items-center justify-center text-white"),children:t?(0,S.jsx)(a_,{participant:t,size:r}):(0,S.jsx)(aT,{})}),aA=({isHovering:e})=>(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{className:F()("absolute inset-x-0 top-0 h-[33px] bg-gradient-to-b from-black to-transparent","transition-opacity duration-300 ease-in-out",e?"opacity-100":"opacity-0")}),(0,S.jsx)("div",{className:F()("absolute inset-x-0 bottom-0 h-[33px] bg-gradient-to-t from-black to-transparent","transition-opacity duration-300 ease-in-out",e?"opacity-100":"opacity-70")})]}),aP=(0,_.U)()((0,ey.tJ)(e=>({moderator:null,setModerator:t=>{e({moderator:t})}}),{name:"moderator-storage"})),aR=()=>!!aP(e=>e.moderator),aD=({participant:e})=>{let{mintId:t}=r_(),r=s3(t),s=aR(),{isHost:n}=sF(),i=(0,C.useMemo)(()=>{if(!e.metadata)return null;try{return JSON.parse(e.metadata)}catch{return null}},[e.metadata]),{mutate:a,isPending:o}=at({livestreamId:r?.id??0,mintId:t,targetIdentity:e.identity}),l=i?.role==="co-host";return{removeFromStage:a,isRemoving:o,canRemove:(n||s)&&l}},aF=({participant:e,trackRef:t,isCurrentlySharingScreen:r,isHostCameraOverlay:s=!1,showPinButton:n=!0,showGradient:i=!0,className:a})=>{let[o,l]=(0,C.useState)(!1),c=(0,Z.H)(e),{canRemove:d,isRemoving:u,removeFromStage:m}=aD({participant:e}),p=rN(t);return(0,S.jsx)("div",{onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),className:F()("rounded-[6px] outline-2 transition-[outline-color] duration-300 ease-in-out",c?"outline-livestream-green":"outline-transparent",a),children:(0,S.jsx)("div",{className:F()("relative aspect-video h-full overflow-hidden rounded-[4px] bg-neutral-700","max-h-full max-w-full"),children:(0,S.jsxs)("div",{className:"absolute inset-0",style:{zIndex:s_.ParticipantVideoTile.gradientOverlay},children:[p&&t?(0,S.jsx)(et.P,{trackRef:t,className:F()("!h-full !w-full [&_.lk-connection-quality]:hidden [&_.lk-participant-metadata]:hidden","[&_.lk-participant-placeholder]:z-20")}):(0,S.jsx)(aL,{participant:e}),(0,S.jsx)(aN,{participant:e,className:"absolute bottom-[6px] left-[6px]",style:{zIndex:s_.ParticipantVideoTile.gradientOverlay+1}}),t&&!s&&n&&(0,S.jsx)(aE,{trackRef:t,className:F()("absolute",r?"left-[9px] top-[28px]":"left-[6px] top-[6px]"),style:{zIndex:s_.ParticipantVideoTile.gradientOverlay+1}}),d&&o&&(0,S.jsx)(i8,{onClick:()=>m(),disabled:u,loading:u,className:"absolute right-[6px] top-[6px]",style:{zIndex:s_.ParticipantVideoTile.gradientOverlay+1}}),r&&(0,S.jsx)(nb,{className:"absolute left-[6px] top-[2px]",style:{zIndex:s_.ParticipantVideoTile.gradientOverlay+1}}),c&&(0,S.jsx)(aM,{}),i&&(0,S.jsx)(aA,{isHovering:o})]})})})},aU=({numTracks:e})=>({gridLayoutClasses:(0,C.useMemo)(()=>{let t="";if(1===e)t="grid-cols-1 grid-rows-1";else if(2===e)t="grid-cols-2 grid-rows-1";else if(3===e)t="grid-cols-3 grid-rows-1";else if(4===e)t="grid-cols-2 grid-rows-2";else if(5===e||6===e)t="grid-cols-3 grid-rows-2";else if(e>=7&&e<=9)t="grid-cols-3 grid-rows-3";else if(e>9){let r=Math.min(4,Math.ceil(Math.sqrt(e)));t=`grid-cols-${r}`,4===r&&e>9&&e<=12?t="grid-cols-4 grid-rows-3":4===r&&e>12&&e<=16&&(t="grid-cols-4 grid-rows-4")}else t="grid-cols-1 grid-rows-1";return t},[e])}),aB=({tracks:e})=>{let t=e.length,{gridLayoutClasses:r}=aU({numTracks:t});if(!e||0===t)return null;let s=t>1;return(0,S.jsx)("div",{className:F()("grid h-full w-full overflow-hidden","gap-1",r),children:e.map(e=>(0,S.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,S.jsx)(aF,{participant:e.participant,trackRef:e,isCurrentlySharingScreen:e.source===M.fQ.Source.ScreenShare,showPinButton:s,showGradient:!1,className:"h-full w-full"})},e.publication?.trackSid??`${e.participant.identity}-${e.source}`))})},aO=()=>{let e=(0,Z.O)();return e.length>0?e[0]:null},a$=({unorderedTracks:e,activeSpeaker:t})=>{let r;let s=(0,C.useRef)(null),n=(0,C.useRef)([]);if(t&&t.identity!==s.current)r=a8(n.current.length>0?n.current:e,t);else{let t=new Map(e.map(e=>[a6(e),e])),s=n.current.map(e=>t.get(a6(e))).filter(e=>void 0!==e),i=new Set(s.map(e=>a6(e)));e.forEach(e=>{i.has(a6(e))||s.push(e)}),r=s}return n.current=r,s.current=t?.identity??null,r},aV=(e,t)=>!!t&&e.participant?.identity===t&&e.source===M.fQ.Source.ScreenShare,aq=(e,t)=>t.has(e.participant?.identity||"")&&e.source===M.fQ.Source.ScreenShare,aH=(e,t)=>!!t&&e.participant?.identity===t&&e.source===M.fQ.Source.Camera&&e.publication&&!1===e.publication.isMuted,aQ=(e,t)=>!!t&&!!e&&!!e.participant&&e.participant.identity===t,az=(e,t,r)=>!!(t&&aQ(t,r))&&1===e.length&&e[0].publication?.trackSid===t.publication?.trackSid,aG=(e,t,r)=>!!e&&!!t&&!!r&&t.participant.identity===r.participant.identity&&t.source===M.fQ.Source.Camera&&!t.publication?.isMuted,aZ=(e,t,r)=>0===e.length&&!t&&!r,aW=(e,t,r)=>e.find(e=>aV(e,t))||e.find(e=>aq(e,r))||null,aK=(e,t,r,s)=>{if(!e||!e.participant)return null;let n=e.participant.identity;if(n===r&&s){let e=t.find(e=>aH(e,s));if(e)return e}return t.find(e=>aH(e,n))||null},aJ=(e,t,r)=>r.find(e=>aH(e,t))||r.find(t=>aH(t,e))||null,aY=(e,t,r,s)=>aQ(e,r)&&e?aK(e,t,r,s):null,aX=(e,t)=>[...e,...t].reduce((e,t)=>{let r=t.participant.identity,s=e.get(r)??{},n=t.source===M.fQ.Source.Camera?{...s,camera:t}:{...s,screenshare:t};return e.set(r,n)},new Map),a0=({participant:e,isHost:t,mainStageTracks:r,participantTracks:s,isHostCameraDesignatedOverlay:n})=>{let i=e.participant.identity,a=!1,o=!1;for(let e of r)if(e.participant.identity===i&&(e.source===M.fQ.Source.Camera?a=!0:e.source===M.fQ.Source.ScreenShare&&(o=!0)),a&&o)break;let l=[];if(!a&&(!t||!n)){let e=s.camera&&aH(s.camera,i)?s.camera:void 0;e&&l.push({track:e})}if(!o){let e=s.screenshare;e&&l.push({track:e})}return aZ(l,a,o)&&l.push({track:null,source:M.fQ.Source.Camera}),l},a1=({enrichedParticipant:e,track:t,source:r,currentAddedEntryKeys:s})=>{let n;let i=e.participant.identity;return(n=t&&t.publication?.trackSid?`${i}_${t.publication.trackSid}`:r?`${i}_null_${r}`:`${i}_null_participant`,s.has(n))?{shouldAdd:!1}:{shouldAdd:!0,entryKey:n,rowViewParticipant:{participant:e.participant,trackRefForRow:t,source:t?.source??r}}},a2=({effectivePins:e,allCameraTracks:t,host:r,ingressIdentity:s,activeScreenshareTrack:n,isScreensharingActive:i})=>{let a=[],o=!1,l=null,c=r?.participant.identity;if(e.length>0)az(a=e,n,c)&&(l=aY(n,t,c,s))&&(o=!0);else{let e=t.find(e=>aH(e,s));if(e)a=[e];else if(i&&n)a=[n],aQ(n,c)&&(l=aY(n,t,c,s))&&(o=!0);else{let e=aJ(c,void 0,t)??(r?{participant:r.participant,source:M.fQ.Source.Camera}:null);e&&(a=[e])}}return{mainStageTracks:a,shouldShowOverlay:o,overlayTrack:l}},a4=e=>{let t=e.shouldShowHostCameraOverlay,r=e.cameraTrackForScreenshareOverlay;return r&&r.publication?.isMuted&&(t=!1,r=null),r||(t=!1),{shouldShowHostCameraOverlay:t,cameraTrackForScreenshareOverlay:r}},a3=(e,t,r,s,n,i)=>{let a=[];return a0({participant:e,isHost:t,mainStageTracks:r,participantTracks:s.get(e.participant.identity)??{},isHostCameraDesignatedOverlay:n}).forEach(t=>{let r=a1({enrichedParticipant:e,track:t.track,source:t.source,currentAddedEntryKeys:i});r.shouldAdd&&r.entryKey&&r.rowViewParticipant&&(a.push(r.rowViewParticipant),i.add(r.entryKey))}),a},a5=(e,t,r,s,n,i,a)=>{if(!r&&0===n.length&&!s)return[];let o=new Set,l=[],c=n.flatMap(t=>a3(t,!1,e,i,a,o));if(l.push(...c),r){let t=a3(r,!0,e,i,a,o);if(s){let e=t.filter(e=>null!==e.trackRefForRow);l.push(...e)}else l.push(...t)}if(s){let e=s.participant.identity;if(!t.has(e)){let t=i.get(e)?.camera??void 0;if(t&&aH(t,e)){let e=a1({enrichedParticipant:s,track:t,currentAddedEntryKeys:o});e.shouldAdd&&e.entryKey&&e.rowViewParticipant&&(l.push(e.rowViewParticipant),o.add(e.entryKey))}}}return l.sort((e,t)=>e.participant.identity.localeCompare(t.participant.identity)),l},a6=e=>`${e.participant.identity}-${e.source??"placeholder"}`,a8=(e,t)=>{let r=[...e];if(t){let e=r.findIndex(e=>e.participant.identity===t.identity);if(e>0){let[t]=r.splice(e,1);r.unshift(t)}}return r},a7=e=>{let{allCameraTracks:t,allScreenshareTracks:r,effectivePins:s,host:n,ingress:i,coHosts:a}=e,o=aX(t,r),l=n?.participant.identity,c=i?.participant.identity,d=aW(r,l,new Set(a.map(e=>e.participant.identity))),u=!!d,{mainStageTracks:m,shouldShowOverlay:p,overlayTrack:h}=a2({effectivePins:s,allCameraTracks:t,host:n,ingressIdentity:c,activeScreenshareTrack:d,isScreensharingActive:u}),g=new Set(m.map(e=>e.participant?.identity).filter(e=>!!e)),f=aG(p,h,n),x=a5(m,g,n,i,a,o,f);return{mainStageTracks:m,rowViewTracks:x,...a4({shouldShowHostCameraOverlay:p,cameraTrackForScreenshareOverlay:h}),activeScreenshareTrack:d,isScreensharingActive:u}},a9=({host:e,ingress:t,coHosts:r})=>{let s=(0,Z.t)([{source:M.fQ.Source.Camera,withPlaceholder:!1},{source:M.fQ.Source.ScreenShare,withPlaceholder:!1}],{updateOnlyOn:[M.TQ.ActiveSpeakersChanged,M.TQ.TrackMuted,M.TQ.TrackUnmuted,M.TQ.TrackPublished,M.TQ.TrackUnpublished,M.TQ.LocalTrackPublished,M.TQ.LocalTrackUnpublished,M.TQ.ParticipantMetadataChanged,M.TQ.ParticipantDisconnected],onlySubscribed:!0}),{effectivePins:n}=sW(),i=aO(),a=(0,C.useMemo)(()=>s.filter(e=>e.source===M.fQ.Source.Camera),[s]),o=(0,C.useMemo)(()=>s.filter(e=>e.source===M.fQ.Source.ScreenShare),[s]),l=(0,C.useMemo)(()=>a7({allCameraTracks:a,allScreenshareTracks:o,effectivePins:n,host:e,ingress:t,coHosts:r}),[a,o,n,e,t,r]),c=a$({unorderedTracks:l.rowViewTracks,activeSpeaker:i});return{...l,rowViewTracks:c}},oe=()=>{let{showHostCameraOverlay:e}=sW(),{host:t,coHosts:r,ingress:s}=sD(),{mainStageTracks:n,rowViewTracks:i,cameraTrackForScreenshareOverlay:a,activeScreenshareTrack:o,isScreensharingActive:l,shouldShowHostCameraOverlay:c}=a9({host:t??null,coHosts:r,ingress:s??null});return{mainStageTracks:n,rowViewTracks:i,cameraTrackForScreenshareOverlay:a,activeScreenshareTrack:o,isScreensharingActive:l,shouldShowHostCameraOverlay:void 0!==e?e:c}},ot=({mainStageTracks:e,cameraOverlayTrack:t,isScreensharingActive:r})=>{let{isMobile:s,showControls:n,token:i}=r_(),{fullScreen:a,allowParticipantControls:o,showViewerParticipationControls:l,showHostRaiseHandIndicator:c}=sW(),{shouldShowHostCameraOverlay:d}=oe(),{isViewer:u,isInvited:m}=sF(),[p,h]=(0,C.useState)(!1),g=p&&!u,f=e.length>0?e[0]:null,x=rN(t);return(0,S.jsxs)("div",{className:"relative flex aspect-video w-full justify-center bg-black",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[0===e.length?(0,S.jsx)(aL,{size:"big",participant:void 0}):1===e.length&&f?(0,S.jsx)(aF,{participant:f.participant,trackRef:f,isCurrentlySharingScreen:f.source===M.fQ.Source.ScreenShare,showPinButton:!0,showGradient:!1,className:F()("h-full w-full",!a&&!s&&"rounded-[8px]",r&&f.source===M.fQ.Source.ScreenShare&&"border-2 border-livestream-green")}):e.length>1?(0,S.jsx)(aB,{tracks:e}):null,t&&d&&x&&(0,S.jsx)("div",{className:F()("absolute left-3","aspect-video h-20 w-auto sm:h-24","overflow-hidden rounded",{"bottom-12 sm:bottom-16":g||a,"bottom-3":!g}),style:{zIndex:s_.MainVideoView.screenshareVideoTile},children:(0,S.jsx)(aF,{participant:t.participant,trackRef:t,isCurrentlySharingScreen:!1,isHostCameraOverlay:d,showPinButton:!1,showGradient:!0,className:"h-full w-full"})}),n&&o&&(0,S.jsx)(io,{isBackstage:!i}),!n&&(0,S.jsx)("div",{className:"absolute right-[10px] top-[10px]",style:{zIndex:s_.LiveKitRoom.noControlsLiveIndicator},children:(0,S.jsx)(ii,{})}),u&&l&&(0,S.jsx)(aj,{isInvited:m,style:{zIndex:s_.Controls.bottom+1},className:F()("absolute left-2",{"bottom-2":!d,"bottom-28":d})}),c&&(0,S.jsx)("div",{className:F()("absolute left-3",{"bottom-4":!d&&!g,"bottom-16":!d&&g,"bottom-28":d&&!g,"bottom-40":d&&g}),style:{zIndex:s_.Controls.bottom+1},children:(0,S.jsx)(av,{})}),(0,S.jsx)(ah,{})]})},or=({displayedParticipants:e,hiddenTracksCount:t,className:r})=>(0,S.jsxs)("div",{className:F()("my-3 flex h-[100px] w-full flex-shrink-0 items-center gap-2","custom-scrollbar overflow-auto",r),children:[e.map(e=>(0,S.jsx)(aF,{participant:e.participant,trackRef:e.trackRefForRow,isCurrentlySharingScreen:e.trackRefForRow?.source===M.fQ.Source.ScreenShare,showPinButton:!0,showGradient:!0,className:"h-full w-fit"},a6(e))),t>0&&(0,S.jsxs)("div",{className:"flex h-full min-w-24 items-center justify-center rounded bg-neutral-700 text-center text-white",children:["+",t]})]}),os=()=>{let{mainStageTracks:e,rowViewTracks:t,cameraTrackForScreenshareOverlay:r,isScreensharingActive:s}=oe(),{isBanned:n,isDisconnected:i,isMobile:a}=r_(),{fullScreen:o,showParticipantRow:l}=sW(),c=t.length>0,d=!o&&!a,u=F()("relative flex w-full flex-col items-center justify-center","overflow-hidden",{"rounded-[8px]":d,"rounded-none":!d,"border border-gray-500":i&&!n,"2xl:px-64 xl:px-12 md:px-4 px-1":o&&!c,"2xl:px-72 xl:px-24 md:px-16 px-1":o&&c}),m=a?3:6,p=t.slice(0,m),h=Math.max(0,t.length-m);return(0,S.jsxs)("div",{className:u,children:[(0,S.jsx)(ot,{mainStageTracks:e,cameraOverlayTrack:r,isScreensharingActive:s}),l&&c&&(0,S.jsx)(or,{displayedParticipants:p,hiddenTracksCount:h})]})},on=3,oi=({containerHeight:e,containerWidth:t,initialXSeed:r,durationSeconds:s=on})=>{let n=Math.max(1,t),i=.1*n,a=i+r*Math.max(0,.8*n-60-i),o=Math.min(20,.03*n);return{animationProps:{initial:{y:0,x:a,opacity:0},animate:{y:-Math.max(1,e)+50,x:[a,a+o,a-o/2],opacity:[0,1,1,0]},transition:{duration:s,ease:"easeInOut",opacity:{duration:s,times:[0,.2,.75,.8],ease:"linear"},x:{duration:s,times:[0,.5,1],ease:"easeInOut"}}},style:{position:"absolute",bottom:"10px",height:"60px",width:"60px",pointerEvents:"none"}}},oa=e=>{let{host:t,coHosts:r,viewers:s}=sD(),n=(0,C.useMemo)(()=>t?.participant.identity===e?t:r.find(t=>t.participant.identity===e)||s.find(t=>t.participant.identity===e),[e,t,r,s]);return(0,C.useMemo)(()=>{let t=n?rk(n.participant):e.slice(0,6),r=n?.metadataObject?.avatar_image||"";return{participant:n,displayName:t,avatarUrl:r}},[n,e])},oo=({item:e,onAnimationComplete:t,containerHeight:r,containerWidth:s})=>{let n=n0(e.emojiId),{displayName:i,avatarUrl:a}=oa(e.senderIdentity),{animationProps:o,style:l}=oi({containerHeight:r,containerWidth:s,initialXSeed:e.initialXSeed}),{width:c,height:d,...u}=l;return n?(0,S.jsxs)(ej.E.div,{...o,style:u,onAnimationComplete:()=>t(e.id),className:"flex flex-col items-center gap-1",children:[(0,S.jsx)("div",{style:{width:c,height:d},children:(0,S.jsx)(eb.nI,{src:n,loop:!0,autoplay:!0,className:"h-full w-full"})}),(0,S.jsxs)("div",{className:"flex items-center gap-1 rounded-full bg-[#1B1D27]/20 px-3 py-1.5 text-sm text-white",children:[a&&(0,S.jsx)(st,{src:a,alt:i||"avatar",size:16}),(0,S.jsx)("span",{className:"font-bold",children:i}),e.message&&(0,S.jsx)("span",{children:e.message}),e.purchase&&(0,S.jsxs)("span",{className:"font-semibold text-livestream-green",children:[e.purchase.amount," ",e.purchase.currency]})]})]},e.id):null},ol=e=>{let[t,r]=(0,C.useState)(0),[s,n]=(0,C.useState)(0);return(0,C.useEffect)(()=>{let t=e.current;if(!t){r(0),n(0);return}r(t.offsetWidth),n(t.offsetHeight);let s=new ResizeObserver(e=>{e[0]?.contentRect&&(r(e[0].contentRect.width),n(e[0].contentRect.height))});return s.observe(t),()=>{s.unobserve(t),s.disconnect()}},[e]),{width:t,height:s}},oc=()=>{let{localParticipant:e}=(0,Z.C)(),{message:t}=(0,Z.E)("reactions-v1");(0,C.useEffect)(()=>{if(t&&t.from?.identity!==e?.identity)try{let e=new TextDecoder().decode(t.payload),r=JSON.parse(e);"reaction"===r.type&&n7.emit(r)}catch(e){e8.error("[useReactionDataChannel] Error parsing message:",{error:e instanceof Error?e.message:String(e)})}},[t,e])},od=e=>{(0,C.useEffect)(()=>{if(!e)return;let t=n7.subscribe(e);return()=>{t()}},[e])},ou=({children:e})=>{let[t,r]=(0,C.useState)([]),s=(0,C.useRef)(null),{width:n,height:i}=ol(s),a=(0,C.useCallback)(e=>{let t={...e,id:n2(e.emojiId)};r(e=>[...e,t])},[]);oc(),od(a);let o=(0,C.useCallback)(e=>{r(t=>t.filter(t=>t.id!==e))},[]);return(0,S.jsxs)("div",{ref:s,className:"relative h-full w-full overflow-hidden",children:[e,(0,S.jsx)("div",{className:"pointer-events-none absolute inset-0",style:{zIndex:s_.LiveKitRoom.reactionsViewer},children:(0,S.jsx)(ew.M,{children:t.map(e=>(0,S.jsx)(oo,{item:e,onAnimationComplete:o,containerHeight:i,containerWidth:n},e.id))})})]})},om=({overlay:e,isHost:t,forceMuted:r})=>{let{fullScreen:s,audioMuted:n,volume:i}=sW(),[a,o]=(0,C.useState)(!1),l=(0,C.useCallback)(()=>{o(e=>!e)},[]),c=e?(0,S.jsx)(iO,{onMaximize:l,allowContentInteraction:a,children:a?(0,S.jsx)(os,{}):e}):null,d=c&&a?(0,S.jsx)("div",{className:"aspect-video h-full",children:e}):(0,S.jsx)(os,{});return(0,S.jsxs)("div",{className:F()("w-full",!s&&"relative h-full overflow-hidden rounded-[8px]"),children:[(0,S.jsx)(ou,{children:d}),(0,S.jsx)(iP,{}),(0,S.jsx)(et.R,{muted:r||n,volume:i}),t&&(0,S.jsx)(iR,{}),c]})},op=({overlay:e=null,forceMuted:t})=>{let{token:r,isMobile:s,roomRef:n,mintId:i,setIsDisconnected:a,resetContext:o}=r_(),{userChoices:l}=(0,Z.x)();if(!r?.token)return e8.debug("[LiveKitRoom Wrapper] No token.token available, rendering null.",{mintId:i}),null;let c="host"===r.role;return e8.debug("[LiveKitRoom Wrapper] Rendering LiveKitRoomComponent from SDK.",{mintId:i,isHost:c}),(0,S.jsx)(ec.L,{ref:n,token:r.token,video:!!c&&{deviceId:l.videoDeviceId},audio:!!c&&{deviceId:l.audioDeviceId},serverUrl:te.livekitUrl,className:F()("flex h-fit w-full items-center",!s&&"group"),connect:!0,onConnected:()=>{e8.debug("[LiveKitRoom Wrapper] onConnected from LiveKitRoomComponent triggered.",{mintId:i}),a(!1)},onError:e=>{"Client initiated disconnect"!==e.message&&e8.error("[LiveKitRoom Wrapper] onError from LiveKitRoomComponent triggered.",{mintId:i,errorName:e.name,errorMessage:e.message})},onDisconnected:e=>{e8.warn("[LiveKitRoom Wrapper] onDisconnected from LiveKitRoomComponent triggered.",{mintId:i,reason:e?.toString()}),o(!0)},children:(0,S.jsx)(no,{children:(0,S.jsx)(sZ,{children:(0,S.jsx)(om,{overlay:e,isHost:c,forceMuted:t})})})})},oh=({overlay:e})=>{let{token:t}=r_();return t?(0,S.jsx)(op,{overlay:e}):(0,S.jsx)(iL,{})},og=({className:e})=>(0,S.jsxs)("div",{className:F()(e,"flex-row gap-2 bg-black text-white"),children:[(0,S.jsx)(sI,{}),(0,S.jsx)("div",{className:"text-center",children:"the creator has ended this stream"})]}),of=e=>{let t=(0,N.NL)(),{trackEvent:r}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useJoinLivestream] Attempting to join livestream via API",{mintId:e.mintId,viewer:e.viewer,hidden:e.hidden})},mutationFn:async()=>ts.post("livestream/join",{json:e}).json(),onSuccess:s=>{r("livestream_join_success",{mintId:e.mintId}),e8.debug("[useJoinLivestream] Successfully joined, invalidating query",{mintId:e.mintId}),t.invalidateQueries({queryKey:[td,e.mintId]}),e.onSuccess(s)},onError:t=>{let s=t.message||"Unknown error during join livestream";r("livestream_join_failure",{error:s,mintId:e.mintId}),e8.error("[useJoinLivestream] Failed to join livestream",{mintId:e.mintId,error:s}),e.onError?.()}})},ox=({mintId:e,viewer:t,onSuccess:r,hidden:s,enabled:n=!0})=>{let{token:i,setToken:a,isDisconnected:o}=r_(),l=s3(e),{mutate:c,isPending:d}=of({mintId:e,onSuccess:r,onError:()=>{a(null)},viewer:t,hidden:s}),u=(0,C.useRef)(!1);return(0,C.useEffect)(()=>{!n||!l||i?.token||o||d?(!n||i?.token||d||o)&&(u.current=!1):u.current||(e8.info("[useAutoJoinLivestream] Conditions met (enabled), attempting auto-join",{mintId:e,hasLivestream:!!l,hasToken:!!i?.token,isDisconnected:o,isJoining:d,enabled:n}),c(),u.current=!0)},[n,l,i?.token,o,d,c,e]),(0,C.useEffect)(()=>{u.current=!1},[e]),{isJoining:d}},ov=({viewer:e=!1,overlay:t,forceMuted:r})=>{let{mintId:s,setToken:n,token:i,isDisconnected:a}=r_(),o=s3(s),{isJoining:l}=ox({mintId:s,onSuccess:n,viewer:e});return o||a||!l?i?(0,S.jsx)(op,{overlay:t,forceMuted:r}):a?(0,S.jsx)(og,{className:"relative flex aspect-video items-center justify-center"}):null:(0,S.jsx)("div",{className:"flex aspect-video h-full items-center justify-center",children:(0,S.jsx)(B.Z,{className:"animate-spin"})})},ob=({className:e,maxWidth:t,overlay:r,role:s})=>{let{mintId:n,isBanned:i}=r_(),{data:a,isLoading:o}=sC({mintId:n}),l=s||(a?"host":"viewer"),[c,d]=(0,C.useState)(sx());return((0,C.useEffect)(()=>{let e=()=>{d(sx())};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]),o||void 0===a)?null:i?(0,S.jsx)(sE,{maxWidth:t,className:e}):tt.CLIPS_ENABLED&&c?(0,S.jsx)(sS,{className:e}):(0,S.jsxs)("div",{className:e,children:["host"===l&&(0,S.jsx)(oh,{}),"viewer"===l&&(0,S.jsx)(ov,{overlay:r,viewer:!0})]})},oy=({onClick:e,label:t="start livestream",className:r})=>{let{mintId:s,isBanned:n,showBackstage:i,setShowBackstage:a}=r_(),o=s3(s),l=(0,C.useCallback)(t=>{a(!0),e?.(t)},[e,a]),{data:c}=sC({mintId:s});return!c||i||o||n?null:(0,S.jsx)("div",{className:F()(r),children:(0,S.jsx)(ig,{onClick:l,label:t,icon:(0,S.jsx)(nk,{}),variant:"primary",size:"medium"})})},ow=e=>{let{trackEvent:t}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useResetLivestream] Attempting to reset livestream via API",{mintId:e.mintId})},mutationFn:async()=>ts.post("human-moderation/reset-livestream",{json:{mintId:e.mintId}}).json(),onSuccess:r=>{t("moderator_reset_livestream_success",{mintId:e.mintId}),e8.debug("[useResetLivestream] Successfully reset livestream",{mintId:e.mintId,success:r?.success}),r.success&&e.onSuccess?.(r)},onError:r=>{t("moderator_reset_livestream_failure",{error:r.message||"Unknown error during reset livestream",mintId:e.mintId}),e8.error("[useResetLivestream] Failed to reset livestream",{mintId:e.mintId,error:r.message}),e.onError?.(r)}})},oj=({children:e,icon:t,className:r=""})=>(0,S.jsxs)("div",{className:`flex justify-center items-center h-full text-sm text-gray-400 ${r}`,children:[t&&(0,S.jsx)("span",{className:"mr-2",children:t}),(0,S.jsx)("span",{children:e})]}),ok=({error:e,onRetry:t})=>{let r=e.includes("Authentication")||e.includes("log in");return(0,S.jsx)(oj,{className:"text-red-500",children:(0,S.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,S.jsx)("span",{className:"text-center",children:e}),!r&&t&&(0,S.jsxs)("button",{onClick:t,className:"flex items-center space-x-1 rounded bg-blue-600 px-3 py-1 text-xs text-white hover:bg-blue-700",type:"button",children:[(0,S.jsx)(eN.Z,{className:"h-3 w-3"}),(0,S.jsx)("span",{children:"Retry Connection"})]}),r&&(0,S.jsx)("span",{className:"text-xs text-gray-400",children:"Please refresh the page to log in again"})]})})},oN=({children:e,className:t})=>(0,S.jsx)("ul",{className:F()("w-40 rounded-md border border-gray-600 bg-gray-800 text-sm shadow-lg",t),children:e}),oC=({children:e,className:t,onClick:r,onMouseDown:s})=>(0,S.jsx)("li",{className:F()("cursor-pointer px-2 py-1 text-gray-200 hover:bg-gray-700",t),onClick:r,onMouseDown:s,children:e}),oS=/(?:^|\s)@([a-zA-Z0-9_]{0,32})$/,oI=/@[a-zA-Z0-9_]*$/,oE=e=>["get-chat-participants",e],oM=(e,t={})=>{let{enabled:r=!0}=t;return(0,I.a)({queryKey:oE(e),queryFn:async()=>{if(!e)return e8.debug("[useGetChatParticipants] Skipping fetch: roomId is missing"),[];e8.debug(`[useGetChatParticipants] Fetching participants for room: ${e}`);try{let t=await ti.get(`chat/moderation/rooms/${e}/participants`).json();return e8.debug(`[useGetChatParticipants] Fetched ${t.length} participants for room: ${e}`),t}catch(r){let t=r instanceof Error?r.message:String(r);throw e8.error(`[useGetChatParticipants] Failed to fetch participants for room: ${e}`,{error:t}),r}},enabled:!!e&&r,staleTime:6e4})},oT=(0,_.U)(e=>({replyTarget:null,setReplyTarget:t=>e({replyTarget:t}),clearReplyTarget:()=>e({replyTarget:null})})),o_=()=>({replyTarget:oT(e=>e.replyTarget),setReplyTarget:oT(e=>e.setReplyTarget),clearReplyTarget:oT(e=>e.clearReplyTarget)}),oL=()=>{let{sendMessage:e,isConnected:t,isJoined:r,isSendingMessage:s,readOnly:n,currentRoomId:i}=r8(),{data:a=[]}=oM(i,{enabled:!!i}),{replyTarget:o,clearReplyTarget:l}=o_(),[c,d]=(0,C.useState)(""),[u,m]=(0,C.useState)(null),[p,h]=(0,C.useState)(!1),g=(0,C.useRef)(null),f=t&&r&&!s,x=!c.trim(),v=t=>{t?.preventDefault(),f&&!x&&(e({messageText:o?`@${o.username} ${c.trim()}`:c.trim(),replyToId:o?.id,replyPreview:o?o.message.slice(0,80):void 0}),d(""),m(null),h(!1),l(),g.current?.focus())};return{inputRef:g,inputText:c,canSendMessage:f,isInputEmpty:x,showSuggestions:p,suggestions:(0,C.useMemo)(()=>{if(!u)return[];let e=u.toLowerCase();return a.filter(t=>t.username.toLowerCase().startsWith(e)).map(e=>e.username).slice(0,5)},[u,a]),isSendingMessage:s,isConnected:t,isJoined:r,readOnly:n,replyTarget:o,clearReplyTarget:l,handleInputChange:e=>{let t=e.target.value;d(t);let r=e.target.selectionStart??t.length,s=t.slice(0,r),n=new RegExp(oS),i=s.match(n);i?(m(i[1]),h(!0)):(m(null),h(!1))},handleSubmit:v,handleKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),v())},handleSelectSuggestion:e=>{d(t=>{let r=new RegExp(oS),s=new RegExp(oI);return t.replace(r,t=>t.replace(s,`@${e} `))}),m(null),h(!1),setTimeout(()=>g.current?.focus(),0)}}},oA=e=>e?e.length>12?e.slice(0,6):e:"",oP=()=>{let{inputRef:e,inputText:t,canSendMessage:r,isInputEmpty:s,showSuggestions:n,suggestions:i,isSendingMessage:a,isConnected:o,isJoined:l,readOnly:c,replyTarget:d,clearReplyTarget:u,handleInputChange:m,handleSubmit:p,handleKeyDown:h,handleSelectSuggestion:g}=oL(),{isAuthenticated:f}=r8(),x=!o||!l||!f,v=o&&l&&f;return c?null:(0,S.jsxs)("form",{onSubmit:p,className:F()("relative","flex","border-t","border-gray-700","bg-gray-900/50","p-2"),children:[d&&v&&(0,S.jsxs)("div",{className:F()("mb-1","flex","items-center","gap-1","rounded","bg-gray-800","px-2","py-1","text-xs","border-l-2","border-blue-500"),children:[(0,S.jsxs)("span",{className:"truncate text-gray-200",children:["Replying to"," ",(0,S.jsxs)("span",{className:"font-semibold text-blue-300",children:["@",oA(d.username)]})]}),(0,S.jsx)("button",{type:"button",onClick:u,className:"ml-auto text-gray-400 hover:text-gray-200",children:"\xd7"})]}),(0,S.jsxs)("div",{className:"relative flex flex-1 items-center",children:[(0,S.jsx)("input",{ref:e,type:"text",value:t,onChange:m,onKeyDown:h,placeholder:o?l?f?"Type a message...":"Log in to send messages":"Joining room...":"Connecting...",disabled:x,className:F()("mr-2","min-w-0","flex-1","rounded","border","border-gray-600","bg-gray-700","px-3","py-1.5","text-sm","text-white","placeholder-gray-400","focus:border-blue-500","focus:outline-none","focus:ring-1","focus:ring-blue-500","disabled:cursor-not-allowed","disabled:opacity-50",{"pr-8":!f})}),!f&&(0,S.jsx)(ek.Z,{size:14,className:"pointer-events-none absolute right-4 text-gray-400"})]}),(0,S.jsx)("button",{type:"submit","aria-label":"Send message",disabled:!r||s||!f,className:F()("relative","flex","h-[34px]","w-[34px]","items-center","justify-center","rounded","bg-blue-600","p-2","text-white","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-opacity-50","disabled:cursor-not-allowed","disabled:opacity-50","disabled:hover:bg-blue-600"),title:f?"Send message":"Log in to send messages",children:f?a?(0,S.jsx)(en.Z,{size:18,className:"animate-spin"}):(0,S.jsx)(eC.Z,{size:18}):(0,S.jsx)(ek.Z,{size:16})}),n&&i.length>0&&v&&(0,S.jsx)(oN,{className:"absolute bottom-12 left-2 z-20 w-40",children:i.map(e=>(0,S.jsx)(oC,{onMouseDown:t=>{t.preventDefault(),g(e)},children:e},e))})]})},oR=()=>{let e=(0,N.NL)();return(0,P.D)({mutationFn:async({roomId:e,messageId:t,reason:r})=>{e8.debug("[useDeleteChatMessage] Sending delete request",{roomId:e,messageId:t,reason:r}),await ti.post(`chat/moderation/rooms/${e}/messages/${t}/delete`,{json:{reason:r}})},onSuccess:(t,{roomId:r,messageId:s})=>{e8.debug("[useDeleteChatMessage] Delete request successful",{roomId:r,messageId:s}),e.invalidateQueries({queryKey:r2(r),exact:!0})},onError:(t,{roomId:r,messageId:s})=>{e8.error("[useDeleteChatMessage] Delete request failed",{roomId:r,messageId:s,error:t.message}),e.invalidateQueries({queryKey:r2(r),exact:!0})}})},oD=()=>{let e=rY(e=>e.banUser),t=(0,N.NL)();return(0,P.D)({mutationFn:async({roomId:e,userAddress:t,username:r,reason:s})=>{e8.debug("[useBanChatUser] Sending ban request",{roomId:e,userAddress:t,username:r,reason:s}),await ti.post(`chat/moderation/rooms/${e}/bans`,{json:{userAddress:t,username:r,reason:s}})},onSuccess:(r,{roomId:s,userAddress:n})=>{e8.debug("[useBanChatUser] Ban request successful",{roomId:s,userAddress:n}),e(n,s),t.invalidateQueries({queryKey:[rL,s]});let i=r2(s);t.setQueryData(i,e=>{if(!e)return{pages:[],pageParams:[]};let t={...e,pages:e.pages.map(e=>({...e,messages:e.messages.filter(e=>e.userAddress!==n)}))},r=e.pages.reduce((e,t)=>e+t.messages.length,0),s=t.pages.reduce((e,t)=>e+t.messages.length,0);return e8.debug(`[useBanChatUser] Optimistically removed ${r-s} messages from banned user ${n}`),t})},onError:(e,{roomId:t,userAddress:r})=>{e8.error("[useBanChatUser] Ban request failed",{roomId:t,userAddress:r,error:e.message})}})},oF=()=>{let e=rY(e=>e.unbanUser),t=(0,N.NL)();return(0,P.D)({mutationFn:async({roomId:e,userAddress:t})=>{e8.debug("[useUnbanChatUser] Sending unban request",{roomId:e,userAddress:t}),await ti.delete(`chat/moderation/rooms/${e}/bans/${t}`)},onSuccess:(r,{roomId:s,userAddress:n})=>{e8.debug("[useUnbanChatUser] Unban request successful",{roomId:s,userAddress:n}),e(n,s),t.invalidateQueries({queryKey:[rL,s]})},onError:(e,{roomId:t,userAddress:r})=>{e8.error("[useUnbanChatUser] Unban request failed",{roomId:t,userAddress:r,error:e.message})}})},oU=()=>{let e=(0,N.NL)();return(0,P.D)({mutationFn:async({roomId:e,userAddress:t})=>{e8.debug("[useAssignModerator] Sending assign moderator request",{roomId:e,userAddress:t}),await ti.post(`chat/moderation/rooms/${e}/moderators`,{json:{userAddress:t}})},onSuccess:(t,{roomId:r,userAddress:s})=>{e8.debug("[useAssignModerator] Assign moderator request successful",{roomId:r,userAddress:s}),e.invalidateQueries({queryKey:[rR,r]})},onError:(e,{roomId:t,userAddress:r})=>{e8.error("[useAssignModerator] Assign moderator request failed",{roomId:t,userAddress:r,error:e.message})}})},oB=()=>{let e=(0,N.NL)();return(0,P.D)({mutationFn:async({roomId:e,userAddress:t})=>{e8.debug("[useUnassignModerator] Sending unassign moderator request",{roomId:e,userAddress:t}),await ti.delete(`chat/moderation/rooms/${e}/moderators/${t}`)},onSuccess:(t,{roomId:r,userAddress:s})=>{e8.debug("[useUnassignModerator] Unassign moderator request successful",{roomId:r,userAddress:s}),e.invalidateQueries({queryKey:[rR,r]})},onError:(e,{roomId:t,userAddress:r})=>{e8.error("[useUnassignModerator] Unassign moderator request failed",{roomId:t,userAddress:r,error:e.message})}})},oO=({onDelete:e,onUnban:t,isBanned:r=!1,userAddress:s,roomId:n})=>{let[i,a]=(0,C.useState)(!1),[o,l]=(0,C.useState)(!1),{mutate:c}=oD(),[d,u]=(0,C.useState)({openUpward:!0,openLeftward:!1}),[m,p]=(0,C.useState)(!1),h=(0,C.useRef)(null),g=(0,C.useRef)(null);(0,C.useEffect)(()=>{if(!i||!h.current||!g.current){p(!1);return}let e=()=>{if(!h.current||!g.current)return;let e=h.current.getBoundingClientRect(),t=g.current.getBoundingClientRect(),r=window.innerHeight,s=window.innerWidth,n=r-e.bottom,i=e.top,a=t.height||100;u({openUpward:i>=a+20||!(n>=a+20),openLeftward:s-e.right<(t.width||160)+20}),p(!0)};requestAnimationFrame(e);let t=()=>requestAnimationFrame(e);return window.addEventListener("scroll",t,{passive:!0}),window.addEventListener("resize",t,{passive:!0}),()=>{window.removeEventListener("scroll",t),window.removeEventListener("resize",t)}},[i]),(0,C.useEffect)(()=>{if(!i)return;let e=e=>{h.current&&!h.current.contains(e.target)&&(a(!1),l(!1))};return window.addEventListener("mousedown",e),()=>window.removeEventListener("mousedown",e)},[i]),(0,C.useEffect)(()=>{i||(p(!1),l(!1),u({openUpward:!0,openLeftward:!1}))},[i]);let f=e=>{e8.debug("[ModeratorMessageMenu] handleBan called",{userAddress:s,roomId:n,reason:e}),s&&n?c({userAddress:s,roomId:n,reason:e}):e8.warn("[ModeratorMessageMenu] Ban skipped: userAddress or roomId is missing",{userAddress:s,roomId:n}),a(!1),l(!1)};return(0,S.jsxs)("div",{className:"relative inline-block",ref:h,children:[(0,S.jsx)("button",{type:"button","aria-label":"Moderation actions",onClick:()=>a(e=>!e),className:"rounded p-1 text-gray-400 hover:bg-gray-700/60 hover:text-gray-200",children:(0,S.jsx)(G.Z,{size:14})}),i&&(0,S.jsx)("div",{ref:g,className:(()=>{let e="absolute z-[9999] w-40 rounded-md bg-gray-800 py-1 shadow-lg ring-1 ring-black/5 border border-gray-700";if(!m)return`${e} opacity-0 pointer-events-none right-0 bottom-full mb-2`;let t="opacity-100 ";return d.openUpward?t+="bottom-full mb-2 ":t+="top-full mt-2 ",t+="right-0",`${e} ${t}`})(),children:o?(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{className:"px-3 py-1.5 text-xs font-semibold text-gray-400",children:"Select Ban Reason:"}),(0,S.jsxs)("button",{type:"button",onClick:()=>f("TOXIC"),className:"flex w-full items-center gap-2 whitespace-nowrap px-4 py-2 text-sm text-gray-200 hover:bg-gray-700",children:[(0,S.jsx)(eE.Z,{size:14})," Toxic"]}),(0,S.jsxs)("button",{type:"button",onClick:()=>f("SPAM"),className:"flex w-full items-center gap-2 whitespace-nowrap px-4 py-2 text-sm text-gray-200 hover:bg-gray-700",children:[(0,S.jsx)(eM.Z,{size:14})," Spam"]})]}):(0,S.jsxs)(S.Fragment,{children:[e&&(0,S.jsxs)("button",{type:"button",onClick:()=>{a(!1),e()},className:"flex w-full items-center gap-2 whitespace-nowrap px-4 py-2 text-sm text-gray-200 hover:bg-gray-700",children:[(0,S.jsx)(eT.Z,{size:14})," Delete message"]}),r?t&&(0,S.jsxs)("button",{type:"button",onClick:()=>{a(!1),t()},className:"flex w-full items-center gap-2 whitespace-nowrap px-4 py-2 text-sm text-gray-200 hover:bg-gray-700",children:[(0,S.jsx)(e_.Z,{size:14})," Unban user"]}):(0,S.jsxs)("button",{type:"button",onClick:()=>l(!0),className:"flex w-full items-center gap-2 whitespace-nowrap px-4 py-2 text-sm text-red-400 hover:bg-gray-700",children:[(0,S.jsx)(e_.Z,{size:14})," Ban user"]})]})})]})},o$=({slug:e,className:t,children:r,style:s})=>{let n=`https://pump.fun/profile/${encodeURIComponent(e)}`;return(0,S.jsx)("a",{href:n,className:F()(t,"hover:underline"),style:s,target:"_blank",rel:"noopener noreferrer",children:r})},oV=e=>{let t=aP(e=>e.setModerator),{trackEvent:r}=e7();return(0,I.a)({queryKey:["get-moderator"],queryFn:async()=>{r("fetch_moderator_attempt"),e8.debug("[useGetModerator] Attempting to fetch moderator details");try{let s=await ts.get("human-moderation/get-moderator").json();return e8.debug("[useGetModerator] Fetch successful",{moderatorId:s?.id}),t(s),e.onSuccess?.(s),r("fetch_moderator_success"),s}catch(s){let e=s instanceof Error?s.message:String(s);throw e8.error("[useGetModerator] Fetch failed",{error:e}),r("fetch_moderator_failure",{error:e}),t(null),s}},enabled:e.enabled})},oq=(0,C.createContext)(void 0),oH=({children:e})=>{let t=aP(e=>e.moderator);oV({enabled:!0});let{isCreator:r,isRoomModerator:s}=rQ(),n=!!t||r,i=n||s,a=(0,C.useMemo)(()=>({canModerateChat:i,canManageRoomModerators:n,isRoomModerator:s}),[i,n,s]);return(0,S.jsx)(oq.Provider,{value:a,children:e})},oQ=()=>{let e=(0,C.useContext)(oq);if(void 0===e)throw Error("useChatModerationContext must be used within a ChatModerationProvider");return e},oz=(e,t="P p")=>{try{let r;if("string"==typeof e)r=(0,eL.D)(e);else if("number"==typeof e)r=new Date(e);else{if(!(e instanceof Date))return"Invalid Input Type";r=e}if(isNaN(r.getTime()))return"Invalid Date";return(0,eA.WU)(r,t)}catch(e){return"Invalid Date"}},oG=e=>oz(e,"HH:mm"),oZ=e=>{let t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)+((t<<5)-t);let r=(2147483647&t)%360;return`hsl(${r}, 70%, 60%)`},oW=e=>{let t=/(@[a-zA-Z0-9_]+)/g;return e.split(t).map((e,r)=>{if(e.match(t)){let t=e.slice(1);return(0,S.jsxs)(o$,{slug:t,className:"font-semibold text-blue-300",children:["@",oA(t)]},r)}return(0,S.jsx)(C.Fragment,{children:e},r)})},oK=({message:e,className:t})=>{let{username:r,userAddress:s,message:n,timestamp:i,isOwnMessage:a,isPending:o,roomId:l,id:c,messageType:d}=e;e8.debug("[UserMessageBubble] Rendering message",{message:e});let{setReplyTarget:u}=o_(),{messages:m}=r8(),{canModerateChat:p}=oQ(),{mutateAsync:h}=oR(),{mutateAsync:g}=oF(),{data:f}=rA(l,{enabled:p}),x=f?.some(e=>e.userAddress===s)??!1,v=oZ(r),b="pr-3";n.length<8?b="pr-6":n.length<20&&(b="pr-4");let y="\xa0".repeat(6),w=e.profile_image||rx,j=e.replyPreview??(e.replyToId?m.find(t=>t.id===e.replyToId)?.message:void 0),k=F()("relative","inline-flex","flex-col","min-w-[64px]","w-fit","max-w-[80%]",a?"bg-blue-600":"bg-gray-600","text-white",a?"rounded-lg rounded-br-none":"rounded-lg rounded-bl-none","pb-2","pl-[9px]",b,"pt-1.5","text-sm","transition-opacity","duration-200","ease-in-out",{"opacity-60":o,"opacity-100":!o}),N=async()=>{let t=e.timestamp?e.timestamp.getTime():c??"";t&&await h({messageId:t,roomId:l,reason:"TOXIC"})},C=async()=>{s&&await g({userAddress:s,roomId:l})};return(0,S.jsxs)("div",{className:F()("mb-2","flex","w-full",a?"justify-end":"justify-start",t),children:[!a&&(0,S.jsx)("div",{className:"mr-2 flex-shrink-0 self-end",children:(0,S.jsx)(st,{src:w,alt:`${r}'s profile picture`,size:30})}),(0,S.jsxs)("div",{className:k,children:[j&&(0,S.jsxs)("div",{className:F()("flex","gap-1","items-start","mb-1","mt-0.5","pl-1.5","pr-2","py-0.5","rounded-sm","border-l-2","border-gray-400/30","bg-gray-700/30","text-xs","text-gray-300"),children:[(0,S.jsx)(eI.Z,{size:12,className:"mt-0.5 shrink-0"}),(0,S.jsx)("span",{className:F()("max-w-[200px]","truncate","leading-snug"),children:j})]}),!a&&(0,S.jsx)(o$,{slug:r,className:F()("font-semibold","mb-0.5","text-xs"),style:{color:v},children:oA(r)}),(0,S.jsxs)("p",{className:"break-words",children:[oW(n),(0,S.jsx)("span",{className:F()("whitespace-pre","pointer-events-none","select-none","opacity-0"),"aria-hidden":"true",children:y})]}),(0,S.jsx)("div",{className:F()("absolute","right-1","bottom-1","flex","gap-1","items-center"),children:(0,S.jsx)("span",{className:"text-[10px] leading-tight text-gray-300/80",children:oG(i)})}),p&&!a&&"regular"===d?(0,S.jsx)("div",{className:"absolute right-1 top-1",children:(0,S.jsx)(oO,{onDelete:N,onUnban:C,isBanned:x,userAddress:s,roomId:l})}):(0,S.jsx)("button",{type:"button","aria-label":"Reply",onClick:()=>u(e),className:F()("absolute","top-1","right-1","text-gray-400","hover:text-gray-200"),children:(0,S.jsx)(eI.Z,{size:14})})]})]})},oJ=({message:e,className:t})=>(0,S.jsx)(oK,{message:e,className:t}),oY=({message:e})=>(0,S.jsx)("div",{className:"py-1 text-center text-sm text-gray-500",children:e.message}),oX=({messages:e,listRef:t,isTopVisible:r,hasMoreHistory:s,isLoadingHistory:n,loadOlderMessages:i})=>{let a=(0,C.useRef)(!0),o=(0,C.useRef)(!1),l=(0,C.useRef)(null),c=(0,C.useRef)(!1),d=(0,C.useRef)(0);(0,C.useLayoutEffect)(()=>{let r=t.current;if(!r||n){e8.debug("[useMessageListScroll] LayoutEffect skipped (no listEl or isLoadingHistory)",{hasListEl:!!r,isLoadingHistory:n});return}if(c.current&&l.current){let t=l.current;e8.debug("[useMessageListScroll] Attempting history restoration",{targetMessageId:t});let s=r.querySelector(`div[data-message-id="${t}"]`);s?(r.scrollTop=s.offsetTop-r.offsetTop,a.current=!1,o.current=!0,e8.debug("[useMessageListScroll] History restored successfully",{scrollTop:r.scrollTop})):(a.current=!1,o.current=!0,e8.warn("[useMessageListScroll] History restoration failed, target element not found",{targetMessageId:t})),l.current=null,c.current=!1,d.current=e.length;return}if(e.length>0&&0===d.current){e8.debug("[useMessageListScroll] Initial load, scrolling to bottom"),r.scrollTop=r.scrollHeight,a.current=!0,o.current=!1,d.current=e.length;return}if(e.length>d.current){let t=e[e.length-1],s="isOwnMessage"in t&&t.isOwnMessage;e8.debug("[useMessageListScroll] Message added",{didUserSendLastMessage:s,isNearBottom:a.current,hasUserScrolledUp:o.current}),s?(r.scrollTop=r.scrollHeight,a.current=!0,o.current=!1):(!o.current||a.current)&&(r.scrollTop=r.scrollHeight,a.current=!0,o.current=!1)}d.current=e.length},[e,t,n]),(0,C.useEffect)(()=>{let e=t.current;if(!e)return;let r=e.scrollTop,s=()=>{if(c.current||n){e8.debug("[useMessageListScroll] Scroll handler skipped (restoring/loading history)");return}let{scrollTop:t,scrollHeight:s,clientHeight:i}=e,l=s-t-i<=50;t<r&&!l&&s>i?o.current=!0:l&&(o.current=!1),a.current=l,r=t<=0?0:t};return e.addEventListener("scroll",s,{passive:!0}),s(),()=>{e.removeEventListener("scroll",s)}},[t,n]),(0,C.useEffect)(()=>{let a=t.current;if(r&&s&&!n&&!c.current&&a&&e.length>0){e8.debug("[useMessageListScroll] Conditions met to check for loading older messages",{isTopVisible:r,hasMoreHistory:s,isLoadingHistory:n});let e=null,t=a.getBoundingClientRect().top;for(let r of a.querySelectorAll("div[data-message-id]"))if(r.getBoundingClientRect().top>=t){e=r.dataset.messageId||null;break}e?(l.current=e,c.current=!0,e8.debug("[useMessageListScroll] Triggering loadOlderMessages (with restoration point)",{topVisibleMessageId:e})):e8.warn("[useMessageListScroll] Triggering loadOlderMessages (no restoration point found, fallback)"),i()}},[r,s,n,i,e,t])},o0=e=>"system"===e.messageType,o1=({className:e})=>{let{messages:t,hasMoreHistory:r,isLoadingHistory:s,loadOlderMessages:n}=r8(),i=(0,C.useRef)(null),{ref:a,inView:o}=(0,eS.YD)({threshold:0,rootMargin:"0px 0px 200px 0px"});return oX({messages:t,listRef:i,isTopVisible:o,hasMoreHistory:r,isLoadingHistory:s,loadOlderMessages:n}),(0,S.jsxs)("div",{ref:i,className:F()("flex flex-1 flex-col-reverse p-2","custom-scrollbar overflow-y-auto",e),children:[(0,S.jsx)("div",{className:"flex flex-grow flex-col space-y-2",children:t.map(e=>{let t=e.id;return o0(e)?(0,S.jsx)(oY,{message:e},t):(0,S.jsx)("div",{"data-message-id":e.id,children:(0,S.jsx)(oJ,{message:e})},t)})}),(0,S.jsx)("div",{ref:a,className:"relative min-h-[1px] py-4",children:s?(0,S.jsxs)("div",{className:"absolute inset-x-0 top-0 flex items-center justify-center pt-2 text-xs text-gray-400",children:[(0,S.jsx)(en.Z,{className:"mr-1 h-4 w-4 animate-spin"}),(0,S.jsx)("span",{children:"loading older messages..."})]}):r?null:(0,S.jsx)("div",{className:"-mt-4 text-center",children:(0,S.jsx)("span",{className:"text-xs text-gray-500",children:"beginning of chat history"})})})]})},o2=()=>{let{isConnected:e,isConnecting:t,connectionError:r,isJoined:s,isJoining:n,retryCount:i,forceReconnect:a,isAuthenticated:o}=r8();return t?(0,S.jsx)(oj,{icon:(0,S.jsx)(iG,{className:"h-4 w-4 animate-spin"}),children:i>0?`Reconnecting... (attempt ${i+1})`:"Connecting..."}):r?(0,S.jsx)(ok,{error:r,onRetry:a}):e?n?(0,S.jsx)(oj,{icon:(0,S.jsx)(en.Z,{className:"h-4 w-4 animate-spin"}),children:"Joining room..."}):s?(0,S.jsxs)("div",{className:"flex flex-1 flex-col overflow-hidden",children:[(0,S.jsx)(o1,{}),!o&&(0,S.jsx)("div",{className:"border-t border-gray-700 bg-gray-800/60 px-3 py-2",children:(0,S.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-xs text-gray-400",children:[(0,S.jsx)($.Z,{className:"h-3 w-3"}),(0,S.jsx)("span",{children:"Read-only mode - Log in to send messages"})]})}),o?(0,S.jsx)(oP,{}):(0,S.jsx)("div",{className:"border-t border-gray-700 bg-gray-800/60 p-3",children:(0,S.jsxs)("div",{className:"flex items-center justify-center space-x-2 rounded border border-gray-600 bg-gray-700/50 px-3 py-2 text-gray-400",children:[(0,S.jsx)(ek.Z,{className:"h-4 w-4"}),(0,S.jsx)("span",{className:"text-sm",children:"Log in to send messages"})]})})]}):(0,S.jsx)(oj,{children:"Connected, waiting to join room..."}):(0,S.jsx)(oj,{children:(0,S.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,S.jsx)("span",{children:"Disconnected. Trying to reconnect..."}),i>0&&(0,S.jsx)("span",{className:"text-xs text-gray-400",children:"Connecting..."})]})})},o4=({className:e,children:t})=>{let{isCollapsed:r,toggleCollapse:s}=r8();return(0,S.jsxs)("div",{className:F()("flex cursor-pointer items-center justify-between border-b","border-gray-700 bg-gray-900/50 p-2",e),onClick:s,children:[(0,S.jsx)("div",{className:"flex items-center gap-2",children:(0,S.jsx)("p",{className:"truncate text-sm font-bold text-white",children:"live chat"})}),(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[t,(0,S.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),s()},className:"p-1 text-gray-400 hover:text-white","aria-label":r?"Expand chat":"Collapse chat",children:r?(0,S.jsx)(eP.Z,{size:18}):(0,S.jsx)(eR.Z,{size:18})})]})]})},o3=({bannedUser:e,roomId:t,participants:r})=>{let{mutate:s,isPending:n}=oF();if(!e||!e.userAddress||!e.bannedAt)return null;let i=e.bannedUserUsername||e.userAddress,a=r.find(t=>t.userAddress===e.bannedByAddress)?.username||e.bannedByAddress,o=new Date(e.bannedAt),l=isNaN(o.getTime())?"N/A":o.toLocaleDateString();return(0,S.jsxs)("div",{className:"flex items-center justify-between rounded-md p-2 hover:bg-gray-700/50",children:[(0,S.jsxs)("div",{className:"flex flex-col",children:[(0,S.jsx)(o$,{slug:i,className:"text-sm font-medium",children:oA(i)}),(0,S.jsxs)("span",{className:"text-xs text-gray-400",children:["Banned by:"," ",(0,S.jsx)(o$,{slug:a,className:"hover:underline",children:oA(a)})," ","on ",l]})]}),(0,S.jsxs)("button",{onClick:()=>{s({roomId:t,userAddress:e.userAddress})},disabled:n,className:"flex items-center gap-2 rounded-md bg-green-600 px-2 py-1 text-xs hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50",children:[(0,S.jsx)(eM.Z,{size:14}),"Unban"]})]})},o5=({users:e,roomId:t})=>{let{data:r=[]}=oM(t);return 0===e.length?(0,S.jsx)("div",{className:"py-4 text-center text-sm text-gray-500",children:"No users are currently banned from this chat."}):(0,S.jsx)("div",{className:"flex flex-col gap-1",children:e.map(e=>(0,S.jsx)(o3,{bannedUser:e,roomId:t,participants:r},e.userAddress))})},o6=({userAddress:e,username:t,roomId:r,isBanned:s,isRoomModerator:n})=>{let[i,a]=(0,C.useState)(!1),[o,l]=(0,C.useState)(!1),c=(0,C.useRef)(null),d=(0,N.NL)(),{mutate:u,isPending:m}=oU(),{mutate:p,isPending:h}=oB(),{mutate:g,isPending:f}=oD(),{mutate:x,isPending:v}=oF(),b=s=>{g({roomId:r,userAddress:e,username:t,reason:s},{onSuccess:()=>{d.invalidateQueries({queryKey:["bannedUsers",r]})}}),a(!1),l(!1)};(0,C.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&(a(!1),l(!1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let y=f||m||h||v;return(0,S.jsxs)("div",{className:"relative",ref:c,children:[(0,S.jsx)("button",{onClick:()=>a(!i),className:"rounded-md p-1 hover:bg-gray-600",children:(0,S.jsx)(G.Z,{size:16})}),i&&(0,S.jsx)("div",{className:"absolute right-0 top-full z-10 mt-1 w-48 rounded-md border border-gray-700 bg-gray-800 py-1 shadow-lg",children:o?(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{className:"px-3 py-1.5 text-xs font-semibold text-gray-400",children:"Select Ban Reason:"}),(0,S.jsxs)("button",{onClick:()=>b("TOXIC"),className:"flex w-full items-center px-3 py-1.5 text-left text-sm hover:bg-gray-700 disabled:opacity-50",children:[(0,S.jsx)(eE.Z,{size:14,className:"mr-2"})," Toxic"]}),(0,S.jsxs)("button",{onClick:()=>b("SPAM"),className:"flex w-full items-center px-3 py-1.5 text-left text-sm hover:bg-gray-700 disabled:opacity-50",children:[(0,S.jsx)(eM.Z,{size:14,className:"mr-2"})," Spam"]})]}):(0,S.jsxs)(S.Fragment,{children:[s?(0,S.jsxs)("button",{onClick:()=>{x({roomId:r,userAddress:e},{onSuccess:()=>{d.invalidateQueries({queryKey:["bannedUsers",r]})}}),a(!1)},disabled:y,className:"flex w-full items-center px-3 py-1.5 text-left text-sm hover:bg-gray-700 disabled:opacity-50",children:[(0,S.jsx)(eM.Z,{size:14,className:"mr-2"}),"Unban User"]}):(0,S.jsxs)("button",{onClick:()=>l(!0),disabled:y,className:"flex w-full items-center px-3 py-1.5 text-left text-sm text-red-400 hover:bg-gray-700 disabled:opacity-50",children:[(0,S.jsx)(e_.Z,{size:14,className:"mr-2"}),"Ban User"]}),(0,S.jsx)(S.Fragment,{children:n?(0,S.jsxs)("button",{onClick:()=>{p({roomId:r,userAddress:e},{onSuccess:()=>{d.invalidateQueries({queryKey:["roomModerators",r]}),d.invalidateQueries({queryKey:["bannedUsers",r]})}}),a(!1)},disabled:y,className:"flex w-full items-center px-3 py-1.5 text-left text-sm hover:bg-gray-700 disabled:opacity-50",children:[(0,S.jsx)(e$.Z,{size:14,className:"mr-2"}),"Unassign Moderator"]}):(0,S.jsxs)("button",{onClick:()=>{u({roomId:r,userAddress:e},{onSuccess:()=>{d.invalidateQueries({queryKey:["roomModerators",r]}),d.invalidateQueries({queryKey:["bannedUsers",r]})}}),a(!1)},disabled:y,className:"flex w-full items-center px-3 py-1.5 text-left text-sm hover:bg-gray-700 disabled:opacity-50",children:[(0,S.jsx)(eV.Z,{size:14,className:"mr-2"}),"Assign as Moderator"]})})]})})]})},o8=({participant:e,roomId:t})=>{let{data:r}=rA(t),{userAddress:s}=r8(),n=rP(e=>e.roomModeratorsByRoom[t]);rD(t);let i=!!n&&n.has(e.userAddress.toLowerCase()),a=r?.some(t=>t.userAddress===e.userAddress)??!1,o=!!s&&e.userAddress.toLowerCase()===s.toLowerCase();return(0,S.jsxs)("div",{className:"flex items-center justify-between rounded-md p-2 hover:bg-gray-700/50",children:[(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[(0,S.jsx)(eF.Z,{size:16,className:"text-gray-400"}),(0,S.jsx)(o$,{slug:e.username,className:"text-sm font-medium",children:oA(e.username)}),o&&(0,S.jsx)("span",{title:"Livestream Creator",children:(0,S.jsx)(eU.Z,{size:14,className:"text-yellow-400"})}),i&&!o&&(0,S.jsx)("span",{title:"Room Moderator",children:(0,S.jsx)(eB.Z,{size:14,className:"text-blue-400"})}),a&&(0,S.jsx)("span",{title:"Banned",children:(0,S.jsx)(eO.Z,{size:14,className:"text-red-500"})})]}),(0,S.jsx)(o6,{userAddress:e.userAddress,username:e.username,roomId:t,isBanned:a,isRoomModerator:i||o})]})},o7=({participants:e,roomId:t})=>{let r=e.filter(e=>e&&e.userAddress&&e.username);return 0===r.length?(0,S.jsx)("div",{className:"py-4 text-center text-sm text-gray-500",children:"No participants found."}):(0,S.jsx)("div",{className:"flex flex-col gap-1",children:r.map(e=>(0,S.jsx)(o8,{participant:e,roomId:t},`${e.userAddress}-${e.username}`))})},o9=({roomId:e})=>{let[t,r]=(0,C.useState)(""),{messages:s}=r8(),n=(0,N.NL)(),{data:i,isLoading:a}=oM(e),{data:o,isLoading:l}=rA(e);(0,C.useEffect)(()=>{let t=s[s.length-1];t&&"regular"===t.messageType&&!i?.some(e=>e.userAddress===t.userAddress)&&n.invalidateQueries({queryKey:oE(e)})},[s,i,n,e]);let c=rJ(e=>e.closeModerationView),d=t&&i?i.filter(e=>e.username.toLowerCase().includes(t.toLowerCase())):i||[];return(0,S.jsxs)("div",{className:"flex h-full flex-col bg-gray-800 text-white",children:[(0,S.jsxs)("header",{className:"flex items-center justify-between border-b border-gray-700 p-2",children:[(0,S.jsx)("h2",{className:"text-sm font-semibold",children:"Chat Moderation"}),(0,S.jsx)("button",{onClick:c,className:"rounded-full p-1 hover:bg-gray-700",children:(0,S.jsx)(q.Z,{size:18})})]}),(0,S.jsx)("div",{className:"p-2",children:(0,S.jsxs)("div",{className:"relative",children:[(0,S.jsx)(eD.Z,{size:16,className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-400"}),(0,S.jsx)("input",{type:"text",placeholder:"Search users...",value:t,onChange:e=>r(e.target.value),className:"w-full rounded-md border border-gray-700 bg-gray-900 py-1.5 pl-8 pr-2 text-sm focus:border-blue-500 focus:ring-blue-500"})]})}),a||l?(0,S.jsx)(iG,{}):(0,S.jsxs)("div",{className:"flex-1 overflow-y-auto p-2",children:[(0,S.jsxs)("section",{className:"mb-4",children:[(0,S.jsxs)("h3",{className:"mb-2 px-1 text-xs font-bold uppercase text-gray-400",children:["Chat Participants (",d.length,")"]}),(0,S.jsx)(o7,{participants:d,roomId:e})]}),(0,S.jsxs)("section",{children:[(0,S.jsxs)("h3",{className:"mb-2 px-1 text-xs font-bold uppercase text-gray-400",children:["Banned Users (",o?.length||0,")"]}),(0,S.jsx)(o5,{users:o||[],roomId:e})]})]})]})},le=({roomId:e})=>{let t=rJ(e=>e.isModerationViewActive),r=rJ(e=>e.openModerationView),s=rJ(e=>e.closeModerationView),n=t?eq.Z:eB.Z;return(0,S.jsxs)("button",{onClick:n=>{n.stopPropagation(),t?s():r(e)},className:"flex items-center gap-1.5 rounded-md p-2 text-xs font-semibold text-gray-300 hover:bg-gray-700/50 hover:text-white",title:t?"Return to chat":"Chat Moderation",children:[(0,S.jsx)(n,{size:16}),(0,S.jsx)("span",{children:t?"Chat":"Moderation"})]})},lt=({roomId:e})=>{let{canModerateChat:t}=oQ(),{isModerationViewActive:r,activeModerationRoomId:s}=rJ(),{isCollapsed:n}=r8(),i=r&&s===e;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(o4,{children:t&&(0,S.jsx)(le,{roomId:e})}),!n&&(0,S.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden",children:i?(0,S.jsx)(o9,{roomId:e}):(0,S.jsx)(o2,{})})]})},lr=({roomId:e,user:t,className:r})=>{let{isConnected:s,isJoined:n,isJoining:i,isCollapsed:a,joinRoom:o,leaveRoom:l}=r8(),c=t?.username?.trim()||t?.address?.trim()||null,d=t?.profile_image||rx;return(0,C.useEffect)(()=>(s&&e&&!n&&!i&&o(e,{username:c,profile_image:d}),()=>{n&&l()}),[s,e,c,d,n,i,o,l]),(0,S.jsx)("div",{className:F()("flex","flex-col","overflow-hidden","rounded-lg","border","border-gray-700","bg-gray-800/80","shadow-lg","backdrop-blur-md","transition-[height]","duration-200","ease-in-out",{"h-[40px]":a,"h-full max-h-[500px]":!a},r),children:(0,S.jsx)(oH,{children:(0,S.jsx)(lt,{roomId:e})})})},ls=({roomId:e,user:t,className:r,readOnly:s=!1,onTrackEvent:n})=>{let{livestream:i,isLoading:a}=rE({mintId:e,enabled:!!e});return a||!i?.isLive?null:(0,S.jsx)(r6,{readOnly:s,onTrackEvent:n,children:(0,S.jsx)(lr,{roomId:e,user:t,className:r})})},ln=({muted:e})=>{let{mainStageTracks:t,cameraTrackForScreenshareOverlay:r,isScreensharingActive:s}=oe(),{setQuality:n}=nO();return(0,C.useEffect)(()=>{n("low (180p)")},[n]),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(et.R,{muted:e}),(0,S.jsx)(ot,{mainStageTracks:t,cameraOverlayTrack:r,isScreensharingActive:s})]})},li=({tokenValue:e,isMobile:t,roomRef:r,muted:s})=>(0,S.jsx)(ec.L,{ref:r,token:e,video:!1,audio:!1,serverUrl:te.livekitUrl,className:F()("flex h-full w-full items-center",!t&&"group"),connect:!0,children:(0,S.jsx)(no,{children:(0,S.jsx)(sZ,{showParticipantRow:!1,showMainNameOverlay:!1,allowParticipantControls:!1,showViewerParticipationControls:!1,showHostRaiseHandIndicator:!1,showHostCameraOverlay:!0,children:(0,S.jsx)(ln,{muted:s})})})}),la=(e,t)=>{let[r,s]=(0,C.useState)(!1);return(0,C.useEffect)(()=>{let r=new IntersectionObserver(([e])=>{s(e.isIntersecting)},t),n=e.current;return n&&r.observe(n),()=>{n&&r.unobserve(n)}},[e,t]),r},lo=({mintId:e,playOnHover:t=!1,hoverPlaceholder:r,muted:s=!0,playWhenVisible:n=!0})=>{let{token:i,setToken:a,isMobile:o,roomRef:l}=r_(),{value:c,setTrue:d,setFalse:u}=su(!1),m=(0,C.useRef)(null),p=la(m,{threshold:.5,rootMargin:"100% 0px 100% 0px"}),h=(!n||p)&&(!t||c);return ox({mintId:e,onSuccess:a,viewer:!0,hidden:!0,enabled:h}),(0,C.useEffect)(()=>{!h&&i?.token&&(e8.info("[LivestreamPreviewPlayer] Auto-join no longer active with an existing token, clearing token.",{mintId:e,autoJoinEnabled:h,hasToken:!!i?.token}),a(null))},[h,i,a,e]),(0,S.jsx)("div",{ref:m,onMouseEnter:()=>{t&&d()},onMouseLeave:()=>{t&&u()},className:"relative h-full w-full",children:h?i?.token?(0,S.jsx)(li,{tokenValue:i.token,isMobile:o,roomRef:l,muted:s}):r?(0,S.jsx)(S.Fragment,{children:r}):(0,S.jsx)("div",{className:"h-full w-full animate-pulse bg-gray-700"}):r?(0,S.jsx)(S.Fragment,{children:r}):(0,S.jsx)("div",{className:"h-full w-full bg-gray-600"})})},ll=e=>{let{trackEvent:t}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useClockIn] Attempting to clock in via API")},mutationFn:async()=>ts.post("human-moderation/clock-in",{json:e}).json(),onSuccess:r=>{t("moderator_clock_in_success"),e8.debug("[useClockIn] Successfully clocked in",{moderatorId:r?.id}),e.onSuccess(r)},onError:e=>{t("moderator_clock_in_failure",{error:e.message||"Unknown error during clock in"}),e8.error("[useClockIn] Failed to clock in",{error:e.message})}})},lc=e=>{let{trackEvent:t}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useClockOut] Attempting to clock out via API")},mutationFn:async()=>ts.post("human-moderation/clock-out",{}).json(),onSuccess:r=>{t("moderator_clock_out_success"),e8.debug("[useClockOut] Successfully clocked out",{success:r?.success}),e.onSuccess(r)},onError:e=>{t("moderator_clock_out_failure",{error:e.message||"Unknown error during clock out"}),e8.error("[useClockOut] Failed to clock out",{error:e.message})}})},ld=(0,C.createContext)(void 0),lu=({children:e,initialModerator:t,isMobile:r=!1,onTrackEvent:s})=>{let n=aP(e=>e.moderator),i=aP(e=>e.setModerator);(0,C.useEffect)(()=>{t&&!n&&i(t)},[t,n,i]),oV({enabled:!n,onSuccess:e=>{e||i(e)}});let{mutateAsync:a}=ll({onSuccess:e=>{i(e)}}),{mutateAsync:o}=lc({onSuccess:e=>{e.success&&i(null)}}),l=(0,C.useMemo)(()=>({moderator:n,clockIn:a,clockOut:o,isOnline:n?.status==="online",isMobile:r}),[n,a,o,r]);return(0,C.useEffect)(()=>{e8.debug("[ModeratorProvider] context update",{hasModerator:!!n,moderatorId:n?.id,moderatorStatus:n?.status,isOnline:n?.status==="online",isMobile:r})},[n,r]),(0,S.jsx)(e5,{onTrackEvent:s,children:(0,S.jsx)(ld.Provider,{value:l,children:e})})};function lm(){let e=(0,C.useContext)(ld);if(void 0===e)throw Error("useModeratorContext must be used within a ModeratorProvider");return e}function lp(){let{moderator:e}=lm();if(!e)throw Error("Moderator is not set");return{moderator:e}}var lh={info:"bg-blue-500 text-white",warning:"bg-yellow-600 text-white",danger:"bg-red-500 text-white",success:"bg-green-500 text-white",muted:"bg-gray-500 text-white"},lg=(0,C.forwardRef)(({label:e,variant:t,className:r,onClick:s,...n},i)=>(0,S.jsx)("button",{ref:i,className:F()(lh[t||"info"],r,"rounded-[4px] px-[8px] py-[5px]","transition-opacity duration-200 hover:opacity-90"),onClick:s,...n,children:e}));lg.displayName="Button";var lf=({children:e,open:t,onOpenChange:r,title:s,description:n,trigger:i,disableClose:a=!1})=>(0,S.jsxs)(eh.fC,{open:t,onOpenChange:e=>{(!a||e)&&r?.(e)},children:[i&&(0,S.jsx)(eh.xz,{asChild:!0,children:i}),(0,S.jsxs)(eh.h_,{children:[(0,S.jsx)(eh.aV,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",style:{zIndex:s_.ModerationDialog.overlay}}),(0,S.jsxs)(eh.VY,{className:"fixed left-1/2 top-1/2 w-full max-w-md -translate-x-1/2 -translate-y-1/2 rounded-lg bg-gray-800 p-6 shadow-lg",style:{zIndex:s_.ModerationDialog.content},children:[s&&(0,S.jsx)(eh.Dx,{className:"mb-2 text-lg font-semibold text-white",children:s}),n&&(0,S.jsx)(eh.dk,{className:"mb-4 text-white",children:n}),e,!a&&(0,S.jsxs)(eh.x8,{className:"absolute right-4 top-4 rounded-full p-1 hover:opacity-50",onClick:e=>{e.stopPropagation()},children:[(0,S.jsx)("span",{className:"sr-only",children:"Close"}),(0,S.jsx)("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",children:(0,S.jsx)("path",{d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"white"})})]})]})]})]}),lx=({onClockOut:e})=>{let{clockIn:t,clockOut:r,isOnline:s}=lm(),[n,i]=(0,C.useState)(!1),[a,o]=(0,C.useState)(30),l=(0,C.useRef)(null),c=(0,C.useRef)(null),d=(0,C.useCallback)(()=>{r(),e?.()},[e,r]),u=(0,C.useCallback)(()=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{i(!0)},18e4)},[]),m=(0,C.useCallback)(()=>{i(!1),t(),u()},[t,u]);return(0,C.useEffect)(()=>()=>{l.current&&clearTimeout(l.current),c.current&&clearInterval(c.current)},[]),(0,C.useEffect)(()=>(n?(o(30),c.current=setInterval(()=>{o(e=>e<=1?(c.current&&clearInterval(c.current),i(!1),d(),0):e-1)},1e3)):c.current&&(clearInterval(c.current),c.current=null),()=>{c.current&&clearInterval(c.current)}),[n,d]),(0,C.useEffect)(()=>(s?u():l.current&&clearTimeout(l.current),()=>{l.current&&clearTimeout(l.current)}),[s,u]),{countdown:a,handleConfirmActivity:m,showActivityModal:n,setShowActivityModal:i}},lv=({onClockOut:e})=>{let{clockIn:t}=lm(),{countdown:r,showActivityModal:s,handleConfirmActivity:n,setShowActivityModal:i}=lx({onClockOut:e});return(0,C.useEffect)(()=>{let e=setInterval(()=>{t()},4e4);return()=>clearInterval(e)},[t]),(0,S.jsxs)(lf,{open:s,onOpenChange:i,title:"Are you there?",disableClose:!0,children:[(0,S.jsxs)("p",{className:"text-white",children:["please confirm your presence to continue moderating. you will be automatically clocked out in"," ",(0,S.jsx)("span",{className:"text-red-500",children:r})," seconds."]}),(0,S.jsx)(lg,{onClick:n,variant:"info",label:"I'm here",className:"mt-[20px] w-full"})]})},lb=({onPrevious:e,onNext:t,onJumpToPage:r,canGoPrevious:s,canGoNext:n,currentPage:i,totalPages:a,className:o})=>{let[l,c]=(0,C.useState)(i.toString());(0,C.useEffect)(()=>{c(i.toString())},[i]);let d=()=>{let e=parseInt(l,10);!isNaN(e)&&e>=1&&e<=a?r(e):c(i.toString())};return(0,S.jsxs)("div",{className:F()("flex items-center justify-center gap-4",o),children:[(0,S.jsx)(ig,{label:"previous",onClick:e,className:F()("w-28",!s&&"invisible"),disabled:!s,"aria-hidden":!s}),(0,S.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[(0,S.jsx)("span",{children:"Page"}),(0,S.jsx)("input",{type:"number",value:l,onChange:e=>{c(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&d()},onBlur:d,min:"1",max:a,className:"w-14 rounded border border-gray-600 bg-gray-800 px-2 py-1 text-center text-white focus:border-blue-500 focus:outline-none","aria-label":"Current page number, edit to jump to page"}),(0,S.jsxs)("span",{children:["of ",a]})]}),(0,S.jsx)(ig,{label:"next",onClick:t,className:F()("w-28",!n&&"invisible"),disabled:!n,"aria-hidden":!n})]})},ly="get-moderation-queue-page",lw=({page:e,pageSize:t,reported:r,moderatorId:s,mint:n,creator:i,isLive:a,enabled:o,banned:l,downranked:c,groupBy:d,onSuccess:u,refetchOnMount:m,refetchOnWindowFocus:p})=>{let{isOnline:h}=lm(),{trackEvent:g}=e7();return(0,I.a)({queryKey:[ly,{page:e,pageSize:t,reported:r,mint:n,creator:i,isLive:a,banned:l,moderatorId:s,groupBy:d,downranked:c}],queryFn:async()=>{g("moderator_fetch_mod_page_attempt",{page:e,pageSize:t,filters:{mintId:n,creatorId:i,moderatorId:s?String(s):void 0}});let o={page:e,pageSize:t,reported:r,mint:n,creator:i,isLive:a,banned:l,moderatorId:s,groupBy:d,downranked:c};e8.debug("[useGetModerationQueuePage] Attempting to fetch moderation queue page",o);let m=new URLSearchParams;m.set("page",e.toString()),void 0!==t&&m.set("pageSize",t.toString()),void 0!==s&&m.set("moderatorId",s?s.toString():"null"),void 0!==n&&m.set("mint",n),void 0!==i&&m.set("creator",i),void 0===a||l||m.set("isLive",a.toString()),void 0!==r&&m.set("reported",r.toString()),void 0!==l&&m.set("banned",l.toString()),void 0!==d&&m.set("groupBy",d),void 0!==c&&m.set("downranked",c.toString());try{let r=await ts.get(`human-moderation/moderation-queue?${m.toString()}`).json();return e8.debug("[useGetModerationQueuePage] Fetch successful",{...o,itemCount:r?.items?.length}),u?.(r),g("moderator_fetch_mod_page_success",{count:r?.items?.length??0,page:e,pageSize:t,filters:{mintId:n,creatorId:i,moderatorId:s?String(s):void 0}}),r}catch(t){let e=t instanceof Error?t.message:String(t);throw e8.error("[useGetModerationQueuePage] Fetch failed",{...o,error:e}),g("moderator_fetch_mod_page_failure",{error:e,filters:{mintId:n,creatorId:i,moderatorId:s?String(s):void 0}}),t}},enabled:!1!==o&&h,staleTime:1e4,refetchInterval:1e4,refetchOnMount:m,refetchOnWindowFocus:p})},lj=({livestreamId:e,moderatorId:t,mintId:r,onSuccess:s,onError:n})=>{let i=(0,N.NL)(),{trackEvent:a}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useUnban] Attempting to unban via API",{livestreamId:e,mintId:r,moderatorId:t}),a("moderator_user_ban_state_change_attempt",{mintId:r,action:"unban"})},mutationFn:async()=>ts.post("human-moderation/unban",{json:{livestreamId:e,moderatorId:t,mintId:r}}).json(),onSuccess:n=>{a("moderator_user_ban_state_change_success",{mintId:r,action:"unban"}),e8.debug("[useUnban] Successfully unbanned, invalidating queue",{livestreamId:e,mintId:r,moderatorId:t,success:n?.success}),i.invalidateQueries({queryKey:[ly]}),s?.(n)},onError:s=>{a("moderator_user_ban_state_change_failure",{error:s.message||"Unknown error during unban",mintId:r,action:"unban"}),e8.error("[useUnban] Failed to unban",{livestreamId:e,mintId:r,moderatorId:t,error:s.message}),n?.(s)}})},lk=e=>{let{moderator:t}=lp(),{mutateAsync:r}=lj({livestreamId:e.livestreamId,moderatorId:t.id,mintId:e.mintId,onSuccess:e.onSuccess}),s=async t=>{t.stopPropagation();let s=await r();e.onSuccess?.(s)};return(0,S.jsxs)(lf,{trigger:(0,S.jsx)(lg,{label:"unban",variant:"success",className:F()(e.className),onClick:e=>{e.stopPropagation()}}),title:"dismiss ban",children:[(0,S.jsx)("div",{className:"mb-[40px] text-white",children:"Do you want to dismiss the ban for this livestream? Doing so will allow the creator to start a new livestream now"}),(0,S.jsx)(eh.x8,{asChild:!0,children:(0,S.jsx)(lg,{className:F()(e.className,"w-full"),onClick:s,label:"dismiss ban",variant:"info"})})]})},lN=({livestreamId:e,moderatorId:t,type:r,mintId:s,onSuccess:n,onError:i})=>{let a=(0,N.NL)(),{trackEvent:o}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useUpdateDownrankStatus] Attempting to update downrank status via API",{livestreamId:e,mintId:s,type:r,moderatorId:t})},mutationFn:async()=>ts.post("human-moderation/update_downrank_status",{json:{livestreamId:e,moderatorId:t,type:r,mintId:s}}).json(),onSuccess:i=>{o("moderator_update_downrank_status_success",{userId:s,actualStatus:"downrank"===r}),e8.debug("[useUpdateDownrankStatus] Successfully updated downrank status, invalidating queue",{livestreamId:e,mintId:s,type:r,moderatorId:t,success:i?.success}),a.invalidateQueries({queryKey:[ly]}),n?.(i)},onError:n=>{o("moderator_update_downrank_status_failure",{error:n.message||"Unknown error updating downrank status",userId:s}),e8.error("[useUpdateDownrankStatus] Failed to update downrank status",{livestreamId:e,mintId:s,type:r,moderatorId:t,error:n.message}),i?.(n)}})},lC=({livestreamId:e,onSuccess:t,mintId:r})=>{let{moderator:s}=lp(),{mutate:n,isPending:i}=lN({livestreamId:e,type:"downrank",moderatorId:s.id,mintId:r,onSuccess:()=>{t?.()}}),a=async e=>{e.stopPropagation(),n()};return(0,S.jsxs)(lf,{trigger:(0,S.jsx)(lg,{label:"Downrank",variant:"muted",onClick:e=>{e.stopPropagation()}}),title:"Downrank",children:[(0,S.jsx)("div",{className:"mb-[40px] text-white",children:"Do you want to downrank this livestream?"}),(0,S.jsx)(eh.x8,{asChild:!0,children:(0,S.jsx)(lg,{label:"Downrank",variant:"muted",className:"w-full",onClick:a,disabled:i})})]})},lS=({livestreamId:e,moderatorId:t,banType:r,mintId:s,onSuccess:n,onError:i})=>{let a=(0,N.NL)(),{trackEvent:o}=e7();return(0,P.D)({onMutate:()=>{e8.debug("[useBan] Attempting to ban via API",{livestreamId:e,mintId:s,banType:r,moderatorId:t}),o("moderator_user_ban_state_change_attempt",{mintId:s,action:"ban"})},mutationFn:async()=>ts.post("human-moderation/ban",{json:{livestreamId:e,moderatorId:t,banType:r,mintId:s}}).json(),onSuccess:i=>{o("moderator_user_ban_state_change_success",{mintId:s,action:"ban"}),e8.debug("[useBan] Successfully banned, invalidating queue",{livestreamId:e,mintId:s,banType:r,moderatorId:t,success:i?.success}),a.invalidateQueries({queryKey:[ly]}),n?.(i)},onError:n=>{o("moderator_user_ban_state_change_failure",{error:n.message||"Unknown error during ban",mintId:s,action:"ban"}),e8.error("[useBan] Failed to ban",{livestreamId:e,mintId:s,banType:r,moderatorId:t,error:n.message}),i?.(n)}})},lI=e=>{let{moderator:t}=lp(),{mutateAsync:r}=lS({livestreamId:e.livestreamId,moderatorId:t.id,banType:"15min",mintId:e.mintId,onSuccess:e.onSuccess}),s=async t=>{t.stopPropagation(),await r(),e.onSuccess?.()};return(0,S.jsxs)(lf,{trigger:(0,S.jsx)(lg,{label:"15min ban",variant:"warning",onClick:e=>{e.stopPropagation()}}),title:"15min ban",children:[(0,S.jsx)("div",{className:"mb-[40px] text-white",children:"Do you want to ban this livestream for 15 minutes?"}),(0,S.jsx)(eh.x8,{asChild:!0,children:(0,S.jsx)(lg,{label:"ban for 15 minutes",variant:"info",className:"w-full",onClick:s})})]})},lE=({onSuccess:e,onError:t}={})=>{let r=(0,N.NL)(),{trackEvent:s}=e7();return(0,P.D)({onMutate:e=>{e8.debug("[useMarkSafe] Attempting to mark safe via API",{args:e})},mutationFn:async e=>ts.post("human-moderation/mark-safe",{json:e}).json(),onSuccess:(t,n)=>{s("moderator_mark_content_safe_success",{contentId:String(n.livestreamId),contentType:"livestream"}),e8.debug("[useMarkSafe] Successfully marked safe, invalidating queue",{args:n,success:t?.success}),r.invalidateQueries({queryKey:[ly]}),e?.(t)},onError:(e,r)=>{let n=e.message||"Unknown error marking safe";s("moderator_mark_content_safe_failure",{contentId:String(r.livestreamId),error:n}),e8.error("[useMarkSafe] Failed to mark safe",{args:r,error:e.message}),t?.(e)}})},lM=({livestreamId:e,onSuccess:t,className:r})=>{let{moderator:s}=lm(),{mutate:n,isPending:i}=lE({onSuccess:()=>{t?.()}});return(0,S.jsx)(lg,{label:"content is safe",variant:"success",onClick:t=>{t.stopPropagation(),s&&n({livestreamId:e,moderatorId:s.id})},disabled:i||!s,className:r})},lT=e=>{let{moderator:t}=lp(),{mutateAsync:r}=lS({livestreamId:e.livestreamId,moderatorId:t.id,banType:"permaban",mintId:e.mintId,onSuccess:e.onSuccess}),s=async t=>{t.stopPropagation(),await r(),e.onSuccess?.()};return(0,S.jsxs)(lf,{trigger:(0,S.jsx)(lg,{label:"permaban",variant:"danger",onClick:e=>{e.stopPropagation()}}),title:"permaban",children:[(0,S.jsx)("div",{className:"mb-[40px] text-white",children:"Do you want to permaban this livestream? Doing so will prevent the creator from starting a new livestream for this coin ever again"}),(0,S.jsx)(eh.x8,{asChild:!0,children:(0,S.jsx)(lg,{label:"permaban",variant:"info",className:"w-full",onClick:s})})]})},l_=({livestreamId:e,onSuccess:t,mintId:r})=>{let{moderator:s}=lp(),{mutate:n,isPending:i}=lN({livestreamId:e,type:"remove_downrank",moderatorId:s.id,mintId:r,onSuccess:()=>{t?.()}}),a=async e=>{e.stopPropagation(),n()};return(0,S.jsxs)(lf,{trigger:(0,S.jsx)(lg,{label:"Remove Downrank",variant:"success",onClick:e=>{e.stopPropagation()}}),title:"Remove Downrank",children:[(0,S.jsx)("div",{className:"mb-[40px] text-white",children:"Do you want to remove the downrank from this livestream?"}),(0,S.jsx)(eh.x8,{asChild:!0,children:(0,S.jsx)(lg,{label:"Remove Downrank",variant:"success",className:"w-full",onClick:a,disabled:i})})]})},lL=({mintId:e,onSuccess:t,className:r})=>{let{mutate:s,isPending:n}=ow({mintId:e}),i=async e=>{e.stopPropagation(),s(void 0,{onSuccess:()=>{t?.()}})};return(0,S.jsxs)(lf,{trigger:(0,S.jsx)(lg,{label:"reset livestream",variant:"muted",onClick:e=>{e.stopPropagation()},className:r,disabled:n}),title:"reset livestream",children:[(0,S.jsx)("div",{className:"mb-[40px] text-white",children:"are you sure you want to reset the livestream? this action will end the current livestream and remove all participants. the host will be able to start a new one."}),(0,S.jsx)(eh.x8,{asChild:!0,children:(0,S.jsx)(lg,{label:n?"resetting...":"confirm reset",variant:"warning",className:"w-full",onClick:i,disabled:n})})]})},lA=((g=lA||{}).MY_QUEUE="my_queue",g.ALL_LIVE_LIVESTREAMS="all_live_livestreams",g.ALL_REPORTED="all_reported",g.UNASSIGNED="unassigned",g.BANNED="banned",g.DOWNRANKED="downranked",g),lP={all_live_livestreams:"active livestreams",all_reported:"all reported",my_queue:"my queue",unassigned:"unassigned",banned:"banned",downranked:"downranked"},lR=(e,t)=>{switch(e){case"all_live_livestreams":return{isLive:!0};case"all_reported":return{reported:!0};case"my_queue":return{moderatorId:t};case"unassigned":return{moderatorId:null};case"banned":return{banned:!0};case"downranked":return{downranked:!0,isLive:!0}}},lD=e=>{window.open(e,"_blank")},lF=e=>e&&Object.values(lA).includes(e)?e:"my_queue",lU=e=>{let t=e?parseInt(e,10):1;return!isNaN(t)&&t>0?t:1},lB=({livestreamId:e,mint:t,isBanned:r,hasReports:s,onSuccess:n,className:i,showMarkingAsSafe:a,showResetButton:o=!1,downrankScore:l=0})=>(0,S.jsxs)("div",{className:F()(i),onClick:e=>e.stopPropagation(),children:[(0,S.jsxs)("div",{className:"mt-[20px] flex flex-wrap items-center gap-2 xl:text-[14px]",children:[(0,S.jsx)(lg,{label:"view",variant:"info",onClick:e=>{e.stopPropagation(),lD(`${te.mainFrontendUrl}/coin/${t}`)}}),r?(0,S.jsx)(lk,{livestreamId:e,mintId:t,onSuccess:n}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(lI,{livestreamId:e,mintId:t,onSuccess:n}),(0,S.jsx)(lT,{livestreamId:e,mintId:t,onSuccess:n}),l>0?(0,S.jsx)(l_,{livestreamId:e,mintId:t,onSuccess:n}):(0,S.jsx)(lC,{livestreamId:e,mintId:t,onSuccess:n})]}),o&&(0,S.jsx)(lL,{mintId:t,onSuccess:n}),s&&!r&&a&&(0,S.jsx)(lM,{livestreamId:e,onSuccess:n})]}),(0,S.jsx)("div",{onClick:e=>{e.stopPropagation(),e.preventDefault()}})]}),lO=({item:e,lastEventMedia:t,showControls:r,muted:s,coinData:n})=>{let{isLive:i,thumbnail:a,mintId:o}=e;return i?(0,S.jsx)("div",{className:"relative h-fit w-full",children:(0,S.jsxs)(rT,{mint:o,showControls:r,enableCoinQuery:!1,initialCoinData:n,children:[!r&&(0,S.jsx)("div",{className:"pointer-events-none absolute left-[10px] top-[10px]",style:{zIndex:s_.ModerationQueueMedia.content},children:(0,S.jsx)(sr,{showMarketCap:!0})}),(0,S.jsx)("div",{className:"h-full w-full",children:r?(0,S.jsx)(ov,{viewer:!0,forceMuted:s}):(0,S.jsx)(lo,{mintId:o,playOnHover:!1,playWhenVisible:!0,muted:s})})]})}):t?.imageUrl?(0,S.jsx)("img",{src:t.imageUrl,className:"h-full w-full object-cover",alt:"Moderation Queue Item"}):t?.audioUrl?(0,S.jsxs)("div",{className:"w-[80%]",children:[(0,S.jsx)("audio",{src:t.audioUrl,controls:!0,className:"w-full",controlsList:"nodownload nofullscreen noremoteplayback noplaybackrate"}),(0,S.jsx)("p",{className:"mt-[10px] text-center text-[12px] text-gray-300",children:t.transcript})]}):a?(0,S.jsx)(se,{src:a,alt:"Livestream thumbnail",width:800,height:450,className:"h-full w-full object-cover"}):(0,S.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,S.jsx)("div",{className:"text-gray-500",children:"no preview available"})})},l$=e=>(0,S.jsx)("div",{className:"w-fit cursor-pointer rounded-full bg-black p-2",onClick:t=>{t.stopPropagation(),e.setMuted(!e.muted)},children:e.muted?(0,S.jsx)(sJ,{}):(0,S.jsx)(sY,{})}),lV={danger:"bg-red-500 text-white",warning:"bg-yellow-500",success:"bg-green-500",info:"bg-blue-500 text-white",muted:"bg-gray-600 text-white",neutral:"bg-white text-black"},lq=({color:e,label:t,variant:r,className:s})=>(0,S.jsx)("div",{className:F()("inline-block rounded px-1 text-black",!e&&lV[r||"info"],s),style:{backgroundColor:e},children:t}),lH=({muted:e,setMuted:t,userReportsCount:r})=>(0,S.jsxs)("div",{className:"absolute bottom-[10px] left-[10px] right-[10px] flex items-center justify-between",style:{zIndex:s_.ModerationQueueMedia.bottomOverlay},children:[(0,S.jsx)(l$,{muted:e,setMuted:t}),!!r&&r>0&&(0,S.jsx)(lq,{label:`${r} report${r>1?"s":""}`,variant:"warning",className:"text-[12px]"})]}),lQ=({isGrouped:e,groupedItemsCount:t})=>(0,S.jsx)("div",{className:"absolute right-[10px] top-[10px] flex items-center gap-1",style:{zIndex:s_.ModerationQueueMedia.topOverlay},children:e&&t&&t>1&&(0,S.jsx)(lq,{label:`${t}x grouped`,variant:"info",className:"text-[12px]"})}),lz=({item:e,lastEventMedia:t,isGrouped:r,groupedItemsCount:s,overrideUserReportsCount:n,showControls:i=!1,initialAudioMuted:a=!1,coinData:o})=>{let l=n??e.userReportsCount,[c,d]=(0,C.useState)(a),u=lm(),m=F()("relative flex aspect-video w-full items-center justify-center gap-2",{"rounded-[8px]":!u.isMobile,"rounded-none":u.isMobile});return(0,S.jsxs)("div",{className:m,onClick:e=>{e.preventDefault()},children:[(0,S.jsx)(lO,{item:e,lastEventMedia:t,showControls:i,muted:c,coinData:o}),(0,S.jsx)(lQ,{isGrouped:r,groupedItemsCount:s}),!i&&(0,S.jsx)(lH,{muted:c,setMuted:d,userReportsCount:l})]})},lG=({label:e,value:t,className:r,labelClassName:s,valueClassName:n})=>{let[i,a]=(0,C.useState)(!1);return(0,S.jsxs)("div",{className:F()("flex items-center justify-between gap-2",r),children:[(0,S.jsx)("p",{className:F()("text-sm text-gray-500",s),children:e}),(0,S.jsx)("div",{className:"flex items-center gap-1",children:(0,S.jsxs)("button",{onClick:e=>{e.stopPropagation(),a(!0),navigator.clipboard.writeText(t),setTimeout(()=>{a(!1)},1500)},className:"flex items-center gap-2 text-gray-400 transition-colors hover:text-white",title:`Copy ${e}`,children:[i?(0,S.jsx)(eH.Z,{className:"h-4 w-4 text-green-500"}):(0,S.jsx)(eQ.Z,{className:"h-4 w-4"}),(0,S.jsxs)("span",{className:F()("font-mono text-sm text-gray-400",n),children:[t.slice(0,6),"...",t.slice(-6)]})]})})]})},lZ=({mintId:e,creatorAddress:t})=>(0,S.jsxs)("div",{className:"mt-[10px]",children:[(0,S.jsx)(lG,{label:"mint",value:e}),(0,S.jsx)(lG,{label:"creator",value:t})]}),lW=({automaticReportsLowConfidenceAudioCount:e,automaticReportsLowConfidenceVideoCount:t,className:r})=>(0,S.jsx)("div",{className:F()(r,"mt-[20px] font-bold"),children:(0,S.jsxs)("div",{className:"flex items-center gap-2",children:[e>0&&(0,S.jsx)(lq,{label:`${e} AI audio report${e>1?"s":""}`,variant:"warning",className:"text-[12px]"}),t>0&&(0,S.jsx)(lq,{label:`${t} AI video report${t>1?"s":""}`,variant:"warning",className:"text-[12px]"})]})}),lK=e=>{let t=e.recentEvents||[],r=[];return t.forEach(e=>{e.reasons&&r.push(...e.reasons.map(t=>`${lJ(e.event)}: ${t}`))}),[...new Set(r)]},lJ=e=>{switch(e){case"automated_audio_ban":case"automated_audio_flagged":return"audio";case"automated_video_ban":case"automated_video_flagged":return"video";default:return}},lY=e=>void 0!==e.livestreamId,lX=e=>void 0!==e.latestItem,l0=({group:e,onNavigate:t})=>{let r=e.latestItem,s=!!r.bannedAt,n=e.totalAutomaticReportsLowConfidenceAudioCount>0||e.totalAutomaticReportsLowConfidenceVideoCount>0,i=e.totalUserReportsCount>0,a=(0,C.useMemo)(()=>{if(!r.recentEvents?.length)return e8.debug("[useGroupedModerationQueueItemLogic] No recent events for lastEventMedia calculation",{mintId:e.mintId,latestItemId:r.id}),null;let t=r.recentEvents[r.recentEvents.length-1],s=lJ(t.event);return(e8.debug("[useGroupedModerationQueueItemLogic] Calculating lastEventMedia",{mintId:e.mintId,latestItemId:r.id,lastEventType:t.event,mediaSource:s,mediaUrl:t.mediaUrl}),"video"===s&&t.mediaUrl)?{imageUrl:t.mediaUrl}:"audio"===s&&t.mediaUrl?{audioUrl:t.mediaUrl,transcript:t.mediaTranscript}:null},[r.recentEvents,r.id,e.mintId]);return{latestItem:r,handleClick:()=>{e8.debug("[useGroupedModerationQueueItemLogic] handleClick called",{mintId:e.mintId,latestLivestreamId:r.livestreamId}),t(`/moderation/livestream/${r.livestreamId}`)},isBanned:s,hasReports:n||i,showAggregatedAiReports:!s&&n,lastEventMedia:a}},l1=({group:e,onNavigate:t,coinData:r})=>{let{latestItem:s,handleClick:n,isBanned:i,hasReports:a,showAggregatedAiReports:o,lastEventMedia:l}=l0({group:e,onNavigate:t});return(0,S.jsxs)("div",{className:F()("relative cursor-pointer overflow-hidden rounded-[8px] border-[2px] bg-gray-800 transition-all duration-300 hover:scale-[1.004]",i?"border-red-400":"border-gray-800"),onClick:n,children:[(0,S.jsx)(lz,{item:s,lastEventMedia:l,isGrouped:!0,overrideUserReportsCount:e.totalUserReportsCount,initialAudioMuted:!0,coinData:r}),(0,S.jsxs)("div",{className:"px-[20px] pb-[20px] pt-[10px]",children:[(0,S.jsx)(lZ,{mintId:e.mintId,creatorAddress:s.creatorAddress}),(0,S.jsx)(lB,{mint:e.mintId,isBanned:i,livestreamId:s.livestreamId,hasReports:a,showMarkingAsSafe:!1}),o&&(0,S.jsx)(lW,{className:"mt-[10px] gap-[10px]",automaticReportsLowConfidenceAudioCount:e.totalAutomaticReportsLowConfidenceAudioCount,automaticReportsLowConfidenceVideoCount:e.totalAutomaticReportsLowConfidenceVideoCount})]})]})},l2=({item:e,onNavigate:t,onSelectItem:r})=>{let s=!!e.bannedAt,n=(e.automaticReportsLowConfidenceAudioCount??0)>0||(e.automaticReportsLowConfidenceVideoCount??0)>0,i=(e.userReportsCount??0)>0;return{handleClick:()=>{e8.debug("[useModerationQueueItemLogic] handleClick called",{itemId:e.id,livestreamId:e.livestreamId,hasOnSelectItem:!!r,hasOnNavigate:!!t}),r?r(e):t&&t(`/moderation/livestream/${e.livestreamId}`)},isBanned:s,hasReports:n||i,showAiReports:!s&&n,lastEventMedia:(0,C.useMemo)(()=>{if(!e.recentEvents?.length)return e8.debug("[useModerationQueueItemLogic] No recent events for lastEventMedia calculation",{itemId:e.id}),null;let t=e.recentEvents[e.recentEvents.length-1],r=lJ(t.event);return(e8.debug("[useModerationQueueItemLogic] Calculating lastEventMedia",{itemId:e.id,lastEventType:t.event,mediaSource:r,mediaUrl:t.mediaUrl}),"video"===r&&t.mediaUrl)?{imageUrl:t.mediaUrl}:"audio"===r&&t.mediaUrl?{audioUrl:t.mediaUrl,transcript:t.mediaTranscript}:null},[e.recentEvents,e.id]),canClick:!!r||!!t}},l4=({showMarkingAsSafe:e=!0,item:t,onNavigate:r,onSelectItem:s,coinData:n})=>{let{handleClick:i,isBanned:a,hasReports:o,showAiReports:l,lastEventMedia:c,canClick:d}=l2({item:t,onNavigate:r,onSelectItem:s});return(0,S.jsxs)("div",{className:F()("relative overflow-hidden rounded-[8px] border-[2px] bg-gray-800 transition-all duration-300",a?"border-red-400":"border-gray-800",d&&"cursor-pointer hover:scale-[1.004]"),onClick:d?i:void 0,children:[(0,S.jsx)(lz,{item:t,lastEventMedia:c,initialAudioMuted:!0,coinData:n}),(0,S.jsxs)("div",{className:"px-[20px] pb-[20px] pt-[10px]",children:[(0,S.jsx)(lZ,{mintId:t.mintId,creatorAddress:t.creatorAddress}),(0,S.jsx)(lB,{showMarkingAsSafe:e,mint:t.mintId,isBanned:a,livestreamId:t.livestreamId,hasReports:o,downrankScore:t.downrankScore}),l&&(0,S.jsx)(lW,{className:"mt-[10px] gap-[10px]",automaticReportsLowConfidenceAudioCount:t.automaticReportsLowConfidenceAudioCount,automaticReportsLowConfidenceVideoCount:t.automaticReportsLowConfidenceVideoCount})]})]})},l3=({mintIds:e})=>{let{trackEvent:t}=e7(),r=(0,C.useMemo)(()=>[...e].sort(),[e]),s=(0,C.useMemo)(()=>["get-multiple-coins",r.join(",")],[r]);return(0,I.a)({queryKey:s,queryFn:async()=>{if(t("common_fetch_coin_data_attempt"),0===r.length)return e8.debug("[useGetMultipleCoins] Fetch skipped, no mintIds provided"),t("common_fetch_coin_data_success",{single:!1,mints:[],count:0}),new Map;e8.debug("[useGetMultipleCoins] Attempting to fetch multiple coin data",{mintIdCount:r.length,firstFewMints:r.slice(0,5)});try{let e=await tn.post("coins/mints",{json:{mints:r}}).json(),s=new Map;return e.forEach(e=>{e?.mint&&s.set(e.mint,e)}),e8.debug("[useGetMultipleCoins] Fetch multiple coin data successful",{fetchedCount:s.size,requestedCount:r.length}),t("common_fetch_coin_data_success",{single:!1,mints:r,count:s.size}),s}catch(s){let e=s instanceof Error?s.message:String(s);throw e8.error("[useGetMultipleCoins] Fetch multiple coin data failed",{mintIdCount:r.length,error:e}),t("common_fetch_coin_data_failure",{error:e,mints:r}),s}},enabled:r.length>0,staleTime:6e4})},l5=({data:e,activeTab:t,onNavigate:r,filterByMintId:s})=>{let n=e?.currentPage??1,i=e?.totalPages??0,a=(0,C.useCallback)(()=>{e?.prevPage&&!s&&r&&r(`?tab=${t}&page=${e.prevPage}`)},[e,t,r,s]),o=(0,C.useCallback)(()=>{e?.nextPage&&!s&&r&&r(`?tab=${t}&page=${e.nextPage}`)},[e,t,r,s]),l=(0,C.useCallback)(e=>{if(0===i||!r||s)return;let n=Math.max(1,Math.min(e,i));r(`?tab=${t}&page=${n}`)},[i,r,s,t]);return{handlePrevious:a,handleNext:o,handleJumpToPage:l,canGoPrevious:!s&&!!e?.prevPage,canGoNext:!s&&!!e?.nextPage,showPagination:!s&&i>1,currentPage:n,totalPages:i}},l6=({activeTab:e,page:t,onNavigate:r,filterByMintId:s,isGrouped:n})=>{let{moderator:i}=lp(),a=n&&!s,o=!s&&"banned"!==e,l=s?1:t,c=s?void 0:a?25:void 0,{data:d,isLoading:u,isFetching:m,refetch:p}=lw({page:l,mint:s,pageSize:c,...lR(e,i?.id),isLive:!!o||void 0,enabled:!!i,groupBy:a?"mintId":void 0});e8.debug("[useModerationQueueListLogic] Moderation queue page data fetched",{isLoading:u,isFetching:m,hasData:!!d,itemCount:d?.items?.length,pageFromHook:l,activeTab:e,filterByMintId:s,isGroupingEnabled:a});let h=(0,C.useMemo)(()=>d?.items??[],[d?.items]),{handlePrevious:g,handleNext:f,handleJumpToPage:x,canGoPrevious:v,canGoNext:b,showPagination:y,currentPage:w,totalPages:j}=l5({data:d,activeTab:e,onNavigate:r,filterByMintId:s}),k=!i||(u||m)&&!d,N=!u&&0===h.length,S=h.length;(0,C.useEffect)(()=>{i&&p()},[e,s,p,i,n,t]);let{data:I}=l3({mintIds:(0,C.useMemo)(()=>h.map(e=>e.mintId),[h])});return{moderator:i,data:d,isLoading:k,isFetching:m,displayItems:h,isDisplayingGroupedItems:a,handlePrevious:g,handleNext:f,handleJumpToPage:x,showPagination:y,canGoPrevious:v,canGoNext:b,showNoData:N,totalItems:S,currentPage:w,totalPages:j,coinDataMap:I}},l8=({activeTab:e,page:t,onNavigate:r,isGrouped:s})=>{let{isLoading:n,displayItems:i,handlePrevious:a,handleNext:o,handleJumpToPage:l,showPagination:c,canGoPrevious:d,canGoNext:u,showNoData:m,currentPage:p,totalPages:h,coinDataMap:g}=l6({activeTab:e,page:t,onNavigate:r,isGrouped:s});return n?(0,S.jsx)(iG,{}):m?(0,S.jsx)("div",{className:"flex h-[200px] items-center justify-center text-gray-400",children:"no items found"}):(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5",children:i.map(t=>{let s=g?.get(t.mintId);return lX(t)?(0,S.jsx)(l1,{group:t,onNavigate:r,coinData:s},t.mintId):(0,S.jsx)(l4,{item:t,onNavigate:r,showMarkingAsSafe:"banned"!==e,coinData:s},t.livestreamId)})}),c&&(0,S.jsx)(lb,{onPrevious:a,onNext:o,onJumpToPage:l,currentPage:p,totalPages:h,canGoPrevious:d,canGoNext:u,className:"mt-[40px]"})]})},l7=({activeTab:e,setActiveTab:t})=>(0,S.jsx)("div",{className:"mb-[40px] flex gap-[20px]",children:Object.values(lA).map((r,s)=>(0,S.jsx)("button",{onClick:()=>t(r),className:F()("rounded-[4px] px-[10px] py-[4px] transition-colors duration-200","text-[14px]",e===r?"bg-blue-600":"bg-gray-600"),children:lP[r]},s))}),l9=({onNavigate:e,tabParam:t,pageParam:r})=>{let{isOnline:s,clockIn:n,clockOut:i}=lm(),a=lF(t??null),o=lU(r??null),l=(0,C.useCallback)(t=>{let r=new URLSearchParams;r.set("tab",t),r.set("page","1"),e(`?${r.toString()}`)},[e]);return s?(0,S.jsxs)("div",{className:"p-[40px] text-white",children:[(0,S.jsx)("div",{className:"absolute right-[20px] top-[20px]",children:(0,S.jsx)("button",{onClick:i,className:"rounded-md bg-red-500 px-4 py-2 text-white",children:"clock out"})}),(0,S.jsx)("div",{className:"flex items-center justify-between",children:(0,S.jsx)(l7,{activeTab:a,setActiveTab:l})}),(0,S.jsx)(l8,{activeTab:a,page:o,onNavigate:e,isGrouped:!1}),(0,S.jsx)(lv,{})]}):(0,S.jsx)("div",{className:"flex h-screen w-full items-center justify-center text-white",children:(0,S.jsx)("button",{className:"text-2xl font-bold",onClick:n,children:"clock in"})})},ce=({userReportsCount:e,className:t})=>0===e?null:(0,S.jsx)("div",{className:F()("flex items-center gap-1 text-[12px]",t),children:(0,S.jsx)(lq,{label:`${e} user report${1!==e?"s":""}`,variant:e>50?"danger":e>10?"warning":e>0?"muted":"danger"})}),ct=({item:e,className:t,totalUserReportsForMint:r})=>{let s=!!e.bannedAt,n=(e.automaticReportsLowConfidenceAudioCount??0)>0||(e.automaticReportsLowConfidenceVideoCount??0)>0,i=void 0!==r&&r>0?r:e.userReportsCount;return(0,S.jsxs)("div",{className:F()("rounded-lg bg-gray-800 text-white shadow",t),children:[(0,S.jsx)("div",{className:"mb-3 flex items-center justify-between",children:(0,S.jsx)(lq,{label:e.isLive?"Live":"Offline",variant:e.isLive?"success":"muted"})}),(0,S.jsxs)("div",{className:"mb-2 flex max-w-xs flex-col gap-2",children:[(0,S.jsx)(lG,{label:"creator",value:e.creatorAddress,labelClassName:"text-gray-200 font-medium",valueClassName:"text-gray-400 font-medium"}),(0,S.jsx)(lG,{label:"mint",value:e.mintId,labelClassName:"text-gray-200 font-medium",valueClassName:"text-gray-400 font-medium"})]}),(0,S.jsxs)("div",{className:"mb-2",children:[(0,S.jsx)("span",{className:"font-medium",children:"started:"})," ",oz(e.streamStartTimestamp)]}),e.streamEndTimestamp&&(0,S.jsxs)("div",{className:"mb-2",children:[(0,S.jsx)("span",{className:"font-medium",children:"ended:"})," ",oz(e.streamEndTimestamp)]}),!!e.numParticipants&&(0,S.jsxs)("div",{className:"mb-3",children:[(0,S.jsx)("span",{className:"font-medium",children:"participants:"})," ",e.numParticipants]}),(0,S.jsxs)("div",{className:"mt-4 flex items-center gap-2 border-t border-gray-700 pt-4",children:[(0,S.jsx)("h4",{className:"font-semibold",children:"reports:"}),i>0&&(0,S.jsx)(ce,{userReportsCount:i}),n&&(0,S.jsx)(lW,{automaticReportsLowConfidenceAudioCount:e.automaticReportsLowConfidenceAudioCount,automaticReportsLowConfidenceVideoCount:e.automaticReportsLowConfidenceVideoCount}),!n&&0===i&&(0,S.jsx)("span",{className:"text-gray-400",children:"no reports"})]}),(0,S.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,S.jsx)("span",{className:"font-medium",children:"status:"}),s?(0,S.jsx)(lq,{label:"banned",variant:"danger"}):0===e.userReportsCount?(0,S.jsx)(lq,{label:"reviewed",variant:"success"}):(0,S.jsx)(lq,{label:"needs review",variant:"warning"})]})]})},cr=({open:e,onOpenChange:t,item:r})=>(0,S.jsx)(lf,{open:e,onOpenChange:t,title:`Livestream ID: ${r?.livestreamId??"N/A"}`,children:r?(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{className:"break-words",children:(0,S.jsx)(ct,{item:r,className:"mb-4"})}),(0,S.jsx)("div",{className:"mt-4 flex justify-end",children:(0,S.jsx)(ig,{label:"Close",onClick:()=>t(!1)})})]}):(0,S.jsx)(iG,{})}),cs=({reasons:e,variant:t="muted",className:r})=>(0,S.jsx)("div",{className:F()(r,"flex items-center gap-[20px]"),children:e.map(e=>(0,S.jsx)(lq,{label:e,variant:t,className:"!px-[8px] py-[4px] font-bold"},e))}),cn={automated_video_ban:{title:"AI banned for 15 minutes because of inappropriate video content"},automated_audio_ban:{title:"AI banned for 15 minutes because of inappropriate audio"},automated_video_flagged:{title:"Automated Video Flagged"},automated_audio_flagged:{title:"Automated Audio Flagged"},moderator_ban:{title:"Moderator Ban"},moderator_ban_dismissed:{title:"Moderator Ban Dismissed"},moderator_marked_safe:{title:"Moderator Marked Safe"},downrank:{title:"Downrank"},remove_downrank:{title:"Remove Downrank"}},ci=({event:e,idx:t})=>{let{title:r}=cn[e.event],s=e.mediaUrl,n=e.mediaUrl,i=lJ(e.event),a=e.moderatorName?e.moderatorName:e.moderatorId?`(ID: ${e.moderatorId})`:null,o=(0,C.useMemo)(()=>e.reasons?.map(e=>`${i}: ${e}`)||[],[e.reasons,i]);return(0,S.jsxs)("div",{className:"mb-[40px]",children:[(0,S.jsxs)("div",{className:"relative left-[-30px] mb-[10px] flex flex-wrap items-center gap-x-[20px] gap-y-1",children:[(0,S.jsx)("p",{className:"text-[20px] font-bold text-gray-500",children:t+1}),(0,S.jsx)("p",{className:"whitespace-nowrap text-gray-500",children:oz(e.timestamp)}),(0,S.jsx)("p",{className:"max-w-[300px] font-bold",children:r}),a&&(0,S.jsxs)("p",{className:"text-sm text-gray-400",children:["by ",a]})]}),(0,S.jsx)(cs,{reasons:o,className:"mb-[20px] !gap-[4px] text-[12px]",variant:"warning"}),"video"===i&&(s?(0,S.jsx)("img",{className:"aspect-video h-[200px]",src:s}):(0,S.jsx)("div",{className:"flex aspect-video h-[200px] items-center justify-center !bg-gray-800 text-gray-300",children:(0,S.jsx)("p",{children:"No image"})})),"audio"===i&&(0,S.jsxs)("div",{children:[n?(0,S.jsx)("audio",{src:n,controls:!0,controlsList:"nofullscreen noremoteplayback noplaybackrate"}):(0,S.jsx)("div",{className:"flex h-[80px] w-[360px] items-center justify-center !bg-gray-800 text-gray-300",children:(0,S.jsx)("p",{children:"No audio"})}),(0,S.jsxs)("div",{className:"mt-[10px] flex w-[360px] items-start gap-[10px]",children:[(0,S.jsx)("p",{className:"font-bold text-white",children:"Transcript:"}),(0,S.jsx)("p",{className:"font-bold text-gray-300",children:e.mediaTranscript})]})]})]})},ca=({recentEvents:e})=>{let t=(0,C.useMemo)(()=>e??[],[e]);return(0,S.jsxs)("div",{className:F()("flex flex-col gap-[10px] rounded-md bg-black/70","border-[2px] border-gray-700 px-[60px] py-[40px]"),children:[(0,S.jsx)("p",{className:"text-[30px] font-bold",children:"moderation history for mint"}),t.map((e,t)=>(0,S.jsx)(ci,{event:e,idx:t},`${e.timestamp}-${t}`)),0===t.length&&(0,S.jsx)("p",{className:"text-gray-400",children:"there are no moderation events for this mint"})]})},co=e=>{let t=e/6e4;return t>60?`${(t/60).toFixed(0)}h ${(t%60).toFixed(0)}min`:t>1?`${t.toFixed(0)}min`:"< 1min"},cl=({mintHistoryItems:e})=>{let t=(0,C.useMemo)(()=>e?e.filter(lY).slice().sort((e,t)=>t.streamStartTimestamp-e.streamStartTimestamp):[],[e]);return 0===t.length?(0,S.jsx)("div",{className:"flex h-[100px] items-center justify-center rounded-md bg-black/70 text-gray-400",children:"no past reported livestreams found for this mint"}):(0,S.jsxs)("div",{className:F()("flex flex-col rounded-md bg-black/70","border-[2px] border-gray-700 px-[60px] py-[40px]","custom-scrollbar overflow-auto"),children:[(0,S.jsx)("p",{className:"text-[30px] font-bold",children:"reported livestreams for mint "}),(0,S.jsxs)("div",{className:F()("flex items-center bg-white px-[5px] font-bold text-black","sticky top-[0px]"),children:[(0,S.jsx)("p",{className:"w-[60px]"}),(0,S.jsx)("p",{className:"w-[200px] border-x py-[14px] text-center",children:"started at"}),(0,S.jsx)("p",{className:"w-[120px] border-r py-[14px] text-center",children:"duration"}),(0,S.jsx)("p",{className:"w-[200px] border-r py-[14px] text-center",children:"end reason"}),(0,S.jsx)("p",{className:"w-[400px] py-[14px] text-center",children:"reports"})]}),t.map((e,t)=>(0,S.jsxs)("div",{className:F()("flex flex-row items-center px-[5px] py-[14px]",t%2==0&&"bg-gray-700",t%2==1&&"bg-gray-800"),children:[(0,S.jsxs)("div",{className:"flex w-[60px] items-center justify-center gap-[5px]",children:[(0,S.jsx)("p",{className:"text-[14px] font-bold",children:e.numParticipants}),(0,S.jsx)(ez.Z,{className:"h-[14px] w-[14px]"})]}),(0,S.jsx)("p",{className:"w-[200px] text-center",children:oz(e.streamStartTimestamp,"dd/MM/yyyy, HH:mm")}),(0,S.jsx)("p",{className:"w-[120px] text-center",children:e.streamEndTimestamp?co(e.streamEndTimestamp-e.streamStartTimestamp):"Ongoing"}),(0,S.jsx)("p",{className:"w-[200px] text-center",children:e.streamEndTimestamp?e.bannedAt?"Banned":"Ended by creator":"N/A"}),(0,S.jsxs)("div",{className:"flex w-[400px] justify-center gap-[10px] text-[12px]",children:[(0,S.jsx)(ce,{userReportsCount:e.userReportsCount,className:"text-[12px]"}),(0,S.jsx)(lW,{automaticReportsLowConfidenceAudioCount:e.automaticReportsLowConfidenceAudioCount,automaticReportsLowConfidenceVideoCount:e.automaticReportsLowConfidenceVideoCount,className:"mt-0 text-[12px]"})]})]},e.livestreamId))]})},cc={history:"history",past_livestreams_mint:"past livestreams mint",reports:"user reports"},cd=["history","past_livestreams_mint","reports"],cu={illegal:"danger",unsafe:"warning",spam:"info",other:"muted"},cm=({text:e,charsStart:t=6,charsEnd:r=6,className:s})=>{let[n,i]=(0,C.useState)(!1),a=`${e.slice(0,t)}...${e.slice(-r)}`,o=(0,C.useCallback)(async()=>{try{await navigator.clipboard.writeText(e),i(!0),setTimeout(()=>i(!1),1500)}catch{}},[e]);return(0,S.jsxs)("div",{className:F()("inline-flex items-center gap-1",s),children:[(0,S.jsx)("span",{className:"font-mono text-sm text-gray-400",title:e,children:a}),(0,S.jsx)("button",{onClick:o,className:"text-gray-500 transition-colors duration-150 hover:text-gray-300",title:"Copy full value","aria-label":"Copy full value",children:n?(0,S.jsx)(eH.Z,{className:"h-3 w-3 text-green-500"}):(0,S.jsx)(eG.Z,{className:"h-3 w-3"})})]})},cp=({reports:e})=>e&&0!==e.length?(0,S.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,S.jsx)("h3",{className:"text-xl font-semibold lowercase",children:"user reports"}),(0,S.jsx)("div",{className:"custom-scrollbar overflow-x-auto",children:(0,S.jsxs)("table",{className:"min-w-full divide-y divide-gray-700",children:[(0,S.jsx)("thead",{className:"bg-white text-black",children:(0,S.jsxs)("tr",{children:[(0,S.jsx)("th",{scope:"col",className:"px-4 py-4 text-left text-xs font-medium tracking-wider",children:"date"}),(0,S.jsx)("th",{scope:"col",className:"px-4 py-4 text-left text-xs font-medium tracking-wider",children:"reason"}),(0,S.jsx)("th",{scope:"col",className:"px-4 py-4 text-left text-xs font-medium tracking-wider",children:"description"}),(0,S.jsx)("th",{scope:"col",className:"px-4 py-4 text-left text-xs font-medium tracking-wider",children:"reporter address"})]})}),(0,S.jsx)("tbody",{className:"divide-y divide-gray-700",children:e.map((e,t)=>(0,S.jsxs)("tr",{className:F()(t%2==0&&"bg-gray-700",t%2==1&&"bg-gray-800"),children:[(0,S.jsx)("td",{className:"whitespace-nowrap px-4 py-4 text-sm text-gray-300",children:oz(e.createdAt)}),(0,S.jsx)("td",{className:"whitespace-nowrap px-4 py-4 text-sm",children:(0,S.jsx)(lq,{label:e.reason,variant:cu[e.reason]??"muted"})}),(0,S.jsx)("td",{className:"px-4 py-4 text-sm text-gray-300",children:e.description||"--"}),(0,S.jsx)("td",{className:"whitespace-nowrap px-4 py-4 text-sm",children:(0,S.jsx)(cm,{text:e.userAddress,charsEnd:4})})]},e.id))})]})})]}):(0,S.jsx)("p",{children:"No user reports found for this mint."}),ch={base:["moderation"],queueItem:e=>[...ch.base,"item",e],queuePage:e=>[...ch.base,"page",e],reportsByMint:e=>[...ch.base,"reportsByMint",e],events:e=>[...ch.base,"events",e],moderator:e=>[...ch.base,"moderator",e]},cg=({mintId:e,enabled:t=!0})=>{let{trackEvent:r}=e7();return(0,I.a)({queryKey:ch.reportsByMint(e??""),queryFn:async()=>{if(r("moderator_fetch_mod_user_reports_attempt",{filters:{mintId:e}}),!e)return e8.warn("[useGetLivestreamUserReportsByMint] Fetch skipped, no mintId"),null;e8.debug("[useGetLivestreamUserReportsByMint] Attempting to fetch user reports by mint",{mintId:e});try{let t=await ts.get("livestream-reports/get-reports-by-mint",{searchParams:{mint:e}}).json();return e8.debug("[useGetLivestreamUserReportsByMint] Fetch successful",{mintId:e,reportCount:t?.length}),r("moderator_fetch_mod_user_reports_success",{count:t?.length??0,filters:{mintId:e}}),t??null}catch(s){let t=s instanceof Error?s.message:String(s);throw e8.error("[useGetLivestreamUserReportsByMint] Fetch failed",{mintId:e,error:t}),r("moderator_fetch_mod_user_reports_failure",{error:t,filters:{mintId:e}}),s}},enabled:t&&!!e})},cf=({mintId:e})=>{let{data:t,isLoading:r,isError:s,error:n}=cg({mintId:e,enabled:!!e});return r?(0,S.jsx)(iG,{}):s?(0,S.jsx)("div",{className:F()("flex flex-col rounded-md bg-black/70","border-[2px] border-gray-700 px-[60px] py-[40px]","text-red-500"),children:(0,S.jsxs)("p",{children:["Error loading reports: ",n?.message||"Please try again later."]})}):(0,S.jsx)("div",{className:F()("flex flex-col rounded-md bg-black/70","border-[2px] border-gray-700 px-[60px] py-[40px]"),children:(0,S.jsx)(cp,{reports:t??[]})})},cx=({item:e,mintHistoryItems:t,recentEvents:r})=>{let[s,n]=(0,C.useState)("history"),i=(0,C.useMemo)(()=>{switch(s){case"history":return(0,S.jsx)(ca,{recentEvents:r});case"past_livestreams_mint":return(0,S.jsx)(cl,{mintHistoryItems:t});case"reports":return(0,S.jsx)(cf,{mintId:e.mintId});default:return null}},[s,e,t,r]);return(0,S.jsxs)("div",{className:"mt-[40px] flex gap-[40px]",children:[(0,S.jsx)("div",{className:"flex flex-col gap-[20px]",children:cd.map(e=>(0,S.jsx)("div",{className:F()("w-[180px] cursor-pointer rounded-sm border-l-4 p-[10px] transition-all duration-300 hover:bg-gray-800 hover:text-white",{"border-livestream-green bg-gray-800 font-bold text-white":s===e,"border-transparent bg-gray-900 text-livestream-muted":s!==e}),onClick:()=>n(e),children:cc[e]},e))}),(0,S.jsx)("div",{className:"max-w-[75%]",children:i})]})},cv=({mintId:e,page:t,limit:r,types:s,enabled:n,onSuccess:i,refetchOnMount:a,refetchOnWindowFocus:o})=>{let{trackEvent:l}=e7();return(0,I.a)({queryKey:["get-moderation-events",e,t,r,s],queryFn:async()=>{if(l("moderator_fetch_mod_events_log_attempt",{page:t,limit:r,filters:{mintId:e,eventTypes:s}}),!e)return e8.warn("[useGetModerationEvents] Fetch skipped, no mintId"),null;e8.debug("[useGetModerationEvents] Attempting to fetch moderation events",{mintId:e,page:t,limit:r,types:s});let n=new URLSearchParams;n.set("mintId",e),n.set("page",t.toString()),n.set("limit",r.toString()),s&&n.set("types",s.join(","));try{let a=await ts.get(`human-moderation/get-moderation-events?${n.toString()}`).json();return e8.debug("[useGetModerationEvents] Fetch successful",{mintId:e,page:t,limit:r,types:s,itemCount:a?.items?.length}),i?.(a),l("moderator_fetch_mod_events_log_success",{count:a?.items?.length??0,page:t,limit:r,filters:{mintId:e,eventTypes:s}}),a}catch(i){let n=i instanceof Error?i.message:String(i);throw e8.error("[useGetModerationEvents] Fetch failed",{mintId:e,page:t,limit:r,types:s,error:n}),l("moderator_fetch_mod_events_log_failure",{error:n,page:t,limit:r,filters:{mintId:e,eventTypes:s}}),i}},enabled:!!e&&n,refetchOnMount:a,refetchOnWindowFocus:o})},cb=({livestreamId:e,enabled:t,onSuccess:r,refetchOnMount:s,refetchOnWindowFocus:n})=>{let{trackEvent:i}=e7();return(0,I.a)({queryKey:["get-moderation-queue-item",e],queryFn:async()=>{i("moderator_fetch_mod_queue_item_attempt",{livestreamId:String(e)}),e8.debug("[useGetModerationQueueItem] Attempting to fetch moderation queue item",{livestreamId:e});let t=new URLSearchParams;t.set("livestreamId",e.toString());try{let s=await ts.get(`human-moderation/moderation-queue-item?${t.toString()}`).json();return e8.debug("[useGetModerationQueueItem] Fetch successful",{livestreamId:e,hasItem:!!s,itemId:s?.id,isLiveDataInResponse:s?.isLive}),r?.(s),i("moderator_fetch_mod_queue_item_success",{itemId:s?.id,mintId:s?.mintId,creatorId:s?.creatorAddress,livestreamId:String(s?.livestreamId)}),s}catch(r){let t=r instanceof Error?r.message:String(r);throw e8.error("[useGetModerationQueueItem] Fetch failed",{livestreamId:e,error:t}),i("moderator_fetch_mod_queue_item_failure",{error:t,livestreamId:String(e)}),r}},enabled:t,refetchOnMount:s,refetchOnWindowFocus:n})},cy=({initialLivestreamIdProp:e,onNavigate:t,livestreamPath:r="/moderation/livestream"})=>{let{isOnline:s}=lm(),[n,i]=(0,C.useState)(void 0),[a,o]=(0,C.useState)(!1),[l,c]=(0,C.useState)(null);(0,C.useEffect)(()=>{let t=Number(e);!isNaN(t)&&t>0?(e8.debug("[useModerationPanelItemDetailLogic] Setting selectedLivestreamId from prop",{initialId:t}),i(t)):(e8.debug("[useModerationPanelItemDetailLogic] initialLivestreamIdProp is invalid or not provided, clearing selectedLivestreamId",{initialLivestreamIdProp:e}),i(void 0))},[e]);let{data:d,isLoading:u,isError:m,isFetching:p}=cb({livestreamId:n??0,enabled:!!n&&!isNaN(n),refetchOnMount:!1,refetchOnWindowFocus:!1}),{data:h,isLoading:g}=lw({page:1,pageSize:100,mint:d?.mintId,enabled:!!d?.mintId,refetchOnMount:!1,refetchOnWindowFocus:!1}),{data:f,isLoading:x,isFetching:v}=cv({mintId:d?.mintId,page:1,limit:20,enabled:!!d?.mintId,refetchOnMount:!1,refetchOnWindowFocus:!1}),b=(0,C.useMemo)(()=>{if(h?.items)return h.items.reduce((e,t)=>"latestItem"in t?e:e+(t.userReportsCount??0),0)},[h?.items]),y=u||p&&!d||!!d?.mintId&&g||!!d?.id&&(x||v),w=!n||!u&&(m||!d),{isBanned:j,hasReports:k,isReportedByAI:N,moderationReasons:S}=(0,C.useMemo)(()=>{if(!d)return{isBanned:!1,hasAiReports:!1,hasUserReports:!1,hasReports:!1,isReportedByAI:!1,moderationReasons:[]};let e=!!d.bannedAt,t=(d.automaticReportsLowConfidenceAudioCount??0)>0||(d.automaticReportsLowConfidenceVideoCount??0)>0,r=(d.userReportsCount??0)>0;return{isBanned:e,hasAiReports:t,hasUserReports:r,hasReports:t||r,isReportedByAI:!e&&t,moderationReasons:lK(d)}},[d]),I=(0,C.useMemo)(()=>l?lK(l):[],[l]);return{isOnline:s,selectedLivestreamId:n,itemData:d,isLoading:y,showNotFound:w,isDialogOpen:a,selectedItemForDialog:l,handleSelectItemInList:e=>{c(e),o(!0)},handleGoBack:()=>{t(r)},handleActionSuccess:()=>{t(r)},handleCloseDialog:()=>{o(!1)},isBanned:j,hasReports:k,isReportedByAI:N,moderationReasons:S,dialogModerationReasons:I,lastEventMedia:(0,C.useMemo)(()=>{let e=f?.items;if(!e?.length)return null;let t=e[0];if(!t)return null;let r=lJ(t.event);return"video"===r&&t.mediaUrl?{imageUrl:t.mediaUrl}:"audio"===r&&t.mediaUrl?{audioUrl:t.mediaUrl,transcript:t.mediaTranscript}:null},[f?.items]),totalUserReportsForMint:b,mintItemsData:h,recentEvents:f?.items}},cw=({livestreamId:e,onNavigate:t,livestreamPath:r="/moderation/livestream"})=>{let{itemData:s,isLoading:n,showNotFound:i,isDialogOpen:a,selectedItemForDialog:o,handleGoBack:l,handleActionSuccess:c,handleCloseDialog:d,isBanned:u,hasReports:m,lastEventMedia:p,totalUserReportsForMint:h,mintItemsData:g,recentEvents:f}=cy({initialLivestreamIdProp:e,onNavigate:t,livestreamPath:r}),x=(0,C.useMemo)(()=>g?.items?.filter(lY),[g?.items]);return n?(0,S.jsx)(iG,{}):i||!s?(0,S.jsxs)("div",{className:"p-8 text-center text-white",children:[(0,S.jsx)("div",{className:"mb-6 text-left",children:(0,S.jsx)(ig,{label:"back",appearance:"outline",onClick:l})}),(0,S.jsx)("h2",{className:"mb-4 text-2xl font-bold",children:"Livestream Not Found"}),(0,S.jsxs)("p",{className:"mb-6",children:["The requested livestream (ID: ",e??"N/A",") could not be found."]})]}):(0,S.jsxs)("div",{className:"p-4 text-white md:p-8",children:[(0,S.jsx)("div",{className:"mb-4",children:(0,S.jsx)(ig,{label:"back",appearance:"outline",onClick:l})}),(0,S.jsxs)("h1",{className:"mb-4 text-2xl font-bold",children:["moderation details for livestream id: ",s.livestreamId]}),(0,S.jsxs)("div",{className:"mb-8 rounded-lg bg-gray-800 p-4 shadow",children:[(0,S.jsx)(ct,{item:s,className:"mb-[20px]",totalUserReportsForMint:h}),(0,S.jsx)(lB,{mint:s.mintId,isBanned:u,livestreamId:s.livestreamId,hasReports:m,onSuccess:c,className:"mb-[20px] gap-4 text-[20px] xl:text-[20px]",showMarkingAsSafe:!0,showResetButton:!0}),(0,S.jsx)("div",{className:"mx-auto max-w-[800px]",children:(0,S.jsx)(lz,{item:s,lastEventMedia:p,showControls:!0})})]}),(0,S.jsx)("div",{className:"mb-8",children:(0,S.jsx)(cx,{item:s,mintHistoryItems:x,recentEvents:f})}),(0,S.jsx)(cr,{open:a,onOpenChange:d,item:o}),(0,S.jsx)(lv,{onClockOut:()=>t(r)})]})},cj=({className:e})=>{let{mintId:t}=r_(),[r,s]=(0,C.useState)(sv());(0,C.useEffect)(()=>{let e=()=>{s(sv())};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]);let{data:n,isLoading:i,error:a}=so({roomName:t,limit:20,enabled:r.valueOf()});if(!r)return null;if(i)return(0,S.jsx)(B.Z,{className:"animate-spin"});if(a||!n?.pages?.[0]?.clips?.length)return null;let o=n.pages[0].clips;return(0,S.jsxs)("div",{className:`mt-6 w-full max-w-[1000px] ${e}`,children:[(0,S.jsx)("div",{className:"mb-2 flex items-center justify-between",children:(0,S.jsxs)("div",{className:"flex items-center gap-3",children:[(0,S.jsx)("span",{className:"text-base font-semibold text-white",children:"archived videos"}),(0,S.jsx)("button",{onClick:()=>sg(""),className:"cursor-pointer text-sm font-medium text-green-400 hover:text-green-300",children:"see all"})]})}),(0,S.jsx)("div",{className:"w-full overflow-x-auto",children:(0,S.jsx)("div",{className:"flex w-full gap-4 whitespace-nowrap pb-2",children:o.map(e=>(0,S.jsx)("div",{className:"flex-none",children:(0,S.jsx)(sb,{clip:e})},e.clipId))})})]})}}}]);